// ==UserScript==
// @name         Gota.io Skin Gallery
// @namespace    https://github.com/Tnsh1/gota-skin-gallery
// @version      0.9
// @description  In-game skins gallery manager for Gota.io — easily browse and manage your favorite skins; add skins and profiles, search, favorite, apply, and more.
// @author       Tenshi
// @match        *://*.gota.io/*
// @grant        GM_getValue
// @grant        GM_setValue
// @grant        GM_addValueChangeListener
// @grant        GM_registerMenuCommand
// @connect      raw.githubusercontent.com
// @connect      api.github.com
// @downloadURL  https://raw.githubusercontent.com/Tnsh1/gota-skin-gallery/main/gallery.user.js
// @updateURL    https://raw.githubusercontent.com/Tnsh1/gota-skin-gallery/main/gallery.user.js
// ==/UserScript==
!function(){const e=(()=>{let e=!1;return{setLowPower:function(t){e=!!t},getMargins:function(){return e?{rootMargin:"50% 0px",threshold:.01,buffer:600,fallbackMargin:350}:{rootMargin:"25% 0px",threshold:.02,buffer:400,fallbackMargin:300}}}})(),t="gotaio.broken_skins_v1";let n=null,o=null;function r(){if(null!==n)return n;try{const e=JSON.parse(localStorage.getItem(t)||"{}")||{},o=Date.now(),r={};for(const[t,n]of Object.entries(e))!n||!n.expiry||o>n.expiry||(r[t]={expiry:n.expiry,lastSeen:n.lastSeen||o});const a=Object.entries(r).sort((e,t)=>(t[1].lastSeen||0)-(e[1].lastSeen||0)),l={};for(let e=0;e<Math.min(75,a.length);e++)l[a[e][0]]=a[e][1];n=l,i(n)}catch(e){n={}}return n}function i(e){try{n=Object.assign({},e||{}),o&&clearTimeout(o),o=setTimeout(()=>{try{localStorage.setItem(t,JSON.stringify(n))}catch(e){}o=null},800)}catch(e){}}function a(e,t=72e5){if(!e)return;const n=r(),o=Date.now()+(t||0);n[e]={expiry:o,lastSeen:Date.now()},i(n)}function l(e){if(!e)return!1;const t=r(),n=t[e];if(!n||!n.expiry)return!1;if(Date.now()>n.expiry)return delete t[e],i(t),!1;try{n.lastSeen=Date.now(),t[e]=n,i(t)}catch(e){}return!0}function s(e){if(!e)return;const t=r();t[e]&&(delete t[e],i(t))}try{window.addEventListener("pagehide",()=>{o&&(clearTimeout(o),o=null);try{null!==n&&localStorage.setItem(t,JSON.stringify(n))}catch(e){}},{once:!0}),window.addEventListener("beforeunload",()=>{o&&(clearTimeout(o),o=null);try{null!==n&&localStorage.setItem(t,JSON.stringify(n))}catch(e){}},{once:!0})}catch(No){}!function(){if(document.getElementById("gotaio-broken-skin-style"))return;const e=document.createElement("style");e.id="gotaio-broken-skin-style",e.textContent="\n        .skin-slot.broken { opacity: 0.95; }\n        .skin-slot.broken img { display: none !important; }\n\n        .skin-slot.broken .circle-slot {\n          border-radius: 50%;\n          position: relative;\n          overflow: hidden;\n          background-color: rgba(20,20,20,0.9);\n          background-image: linear-gradient(135deg, rgba(200,40,40,0.06), rgba(0,0,0,0.06)),\n                            linear-gradient(45deg, rgba(255,255,255,0.02) 1px, transparent 1px);\n          background-size: auto, 8px 8px;\n          display: flex;\n          align-items: center;\n          justify-content: center;\n        }\n\n        .skin-slot.broken .circle-slot::after {\n          content: 'not found';\n          position: absolute;\n          inset: 0;\n          display: flex;\n          align-items: center;\n          justify-content: center;\n          color: #ffd6d6;\n          font-weight: 700;\n          font-size: 12px;\n          pointer-events: none;\n          text-transform: uppercase;\n          letter-spacing: 0.6px;\n          text-shadow: 0 1px 2px rgba(0,0,0,0.6);\n          background: transparent;\n        }\n      ",document.head.appendChild(e)}();const c=(()=>{const t="data-skin-src";let n,o=null,r="",i=0,c=[],d=0,p=null,u=null,f=null,y=null;function m(e){for(const t of e)if(t.isIntersecting||t.intersectionRatio>0){try{n&&n.unobserve(t.target)}catch(e){}x(t.target)}}function g(){if(!("IntersectionObserver"in window))return null;const t=function(){try{return document.querySelector(".circle-grid-container")}catch(e){return null}}();if(!t)return null;const a=e.getMargins();if(!n||o!==t||r!==a.rootMargin||i!==a.threshold){if(n)try{n.disconnect()}catch(e){}o=t,r=a.rootMargin,i=a.threshold,n=new IntersectionObserver(m,{root:t,rootMargin:a.rootMargin,threshold:a.threshold})}return n}function h(e){const n=e.currentSrc||e.getAttribute("src");if(n&&!e.hasAttribute(t)){e.setAttribute(t,n),e.removeAttribute("src"),e.style&&"none"===e.style.display&&e.style.removeProperty("display");const o=g();if(o)try{o.observe(e)}catch(e){}}}function b(){d=0;const e=c;c=[];for(const n of e){const e=n.getAttribute(t);if(!e)continue;try{const e=n.closest(".skin-slot"),o=e&&e.dataset&&e.dataset.uuid;if(o&&l(o)){e&&e.classList.add("broken"),n.removeAttribute(t);continue}}catch(e){}n.style&&"none"===n.style.display&&n.style.removeProperty("display");const o=function(){try{const e=n.closest(".skin-slot"),t=e&&e.dataset&&e.dataset.uuid;t&&a(t),e&&e.classList.add("broken");try{n.removeAttribute("src")}catch(e){}}catch(e){}};n.addEventListener("error",o,{once:!0});const r=function(){try{const o=n.closest(".skin-slot"),r=o&&o.dataset&&o.dataset.uuid;r&&(s(r),o.classList.remove("broken"),n.setAttribute(t,e),x(n))}catch(e){}};try{const e=n.closest(".skin-slot");e&&e.addEventListener("click",r,{once:!0})}catch(e){}n.src=e,n.removeAttribute(t);try{const e=n.closest(".skin-slot");e&&e.classList.remove("skeleton")}catch(e){}}}function x(e){c.push(e),d||(d=requestAnimationFrame(b))}function v(n){const o=n.slice(),r=e.getMargins().fallbackMargin,i=document.querySelector(".circle-grid-container")||window;function a(){let e;i!==window&&(e=i.getBoundingClientRect());for(let n=o.length-1;n>=0;n--){const a=o[n];if(!a.hasAttribute(t)){o.splice(n,1);continue}const l=a.getBoundingClientRect();let s=!1;if(i===window){const e=window.innerHeight,t=window.innerWidth;s=l.bottom>=-r&&l.top<=e+r&&l.right>=0&&l.left<=t}else s=l.bottom>=e.top-r&&l.top<=e.bottom+r&&l.right>=e.left&&l.left<=e.right;s&&(x(a),o.splice(n,1))}o.length||function(){i===window?(window.removeEventListener("scroll",l,!0),window.removeEventListener("resize",l,!0)):i.removeEventListener("scroll",l,!0);document.removeEventListener("visibilitychange",s,!0)}()}const l=function(e,t){let n=0,o=null;return function(){const r=Date.now(),i=t-(r-n);i<=0?(n=r,e()):o||(o=setTimeout(()=>{o=null,n=Date.now(),e()},i))}}(a,120);function s(){"visible"===document.visibilityState&&l()}i===window?(window.addEventListener("scroll",l,!0),window.addEventListener("resize",l,!0)):i.addEventListener("scroll",l,!0),document.addEventListener("visibilitychange",s,!0),a()}function w(e=document){const n=Array.from(e.querySelectorAll("img["+t+"]"));return n.length?(function(e){if(!("IntersectionObserver"in window))return!1;const t=g();return!!t&&(e.forEach(e=>{try{t.observe(e)}catch(e){}}),!0)}(n)||v(n),n.length):0}function k(){p||"MutationObserver"in window&&(p=new MutationObserver(e=>{let n=!1;for(const o of e)"childList"===o.type?o.addedNodes.forEach(e=>{1===e.nodeType&&(e.matches&&e.matches("img["+t+"]")||e.querySelector&&e.querySelector("img["+t+"]"))&&(n=!0)}):"attributes"===o.type&&o.target.matches&&o.target.matches("img["+t+"]")&&(n=!0);n&&w(document)}),p.observe(document.documentElement,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["data-skin-src"]}))}return k(),{init:w,ensureMutationObserver:k,initUnloading:function(e){y=function(e,t=120){let n;return function(...o){clearTimeout(n),n=setTimeout(()=>e.apply(this,o),t)}}(()=>function(e){clearTimeout(u),clearInterval(f),u=setTimeout(()=>{const n=e.querySelector(".circle-grid");if(!n)return;const o=Array.from(n.querySelectorAll("img")),r=o.filter(e=>e.src&&!e.hasAttribute(t));if(r.length<10)return;const i=e.scrollTop+e.clientHeight/2,a=r.map(e=>{const t=e.closest(".skin-slot");return{img:e,distance:Math.abs(t.offsetTop+t.offsetHeight/2-i)}});a.sort((e,t)=>t.distance-e.distance);const l=Math.floor(.5*a.length);if(l<1)return;const s=a.slice(0,l).map(e=>e.img),c=Math.ceil(.1*o.length),d=[];for(let e=0;e<s.length;e+=c)d.push(s.slice(e,e+c));let p=0;const u=()=>{if(p>=d.length)return clearInterval(f),void(f=null);d[p].forEach(h),p++;try{w(document)}catch(e){}};u(),p<d.length&&(f=setInterval(u,3e4))},3e4)}(e),1e3),e.addEventListener("scroll",()=>{clearTimeout(u),clearInterval(f),y()},{passive:!0})}}})();!function(){document;let t=!1;window.addEventListener("scroll",()=>{t||(t=!0,function(){let n=0,o=performance.now();requestAnimationFrame(function r(){n++;const i=performance.now();if(i-o<2e3)requestAnimationFrame(r);else{const r=n/((i-o)/1e3)<40;e.setLowPower(r);try{const e=document.getElementById("skinBox");e&&(e.dataset.lowPower=r?"1":"0")}catch(e){}t=!1}})}())},{passive:!0,capture:!0})}();const d=(()=>{let t=null,n=!1,o=null,r=e.getMargins().buffer;function i(e){const t=e.querySelectorAll("img");let n=!1;if(t.forEach(t=>{if(!t.getAttribute("src")&&!t.getAttribute("data-skin-src")){const o=t.getAttribute("data-vsrc");if(o){t.setAttribute("data-skin-src",o),n=!0;try{e.classList.remove("skeleton")}catch(e){}const r=()=>{try{e.classList.remove("skeleton")}catch(e){}};t.addEventListener("load",r,{once:!0}),t.addEventListener("error",r,{once:!0})}}}),n)try{c.init(e)}catch(e){}}function a(e){for(const t of e)(t.isIntersecting||t.intersectionRatio>0)&&i(t.target)}const l=(()=>{let e=null;return()=>{e||(e=setTimeout(()=>{e=null,function(){if(!o)return;const e=o.getBoundingClientRect();o.querySelectorAll(".skin-slot").forEach(t=>{const n=t.getBoundingClientRect();n.bottom>=e.top-r&&n.top<=e.bottom+r&&i(t)})}()},120))}})();return function(){if(document.getElementById("gotaio-name-fade-style"))return;const e=document.createElement("style");e.id="gotaio-name-fade-style",e.textContent="\n          .menu-header .profile-name,\n          .gotaio-profile-button .name,\n          .gotaio-profile-list-panel .name {\n            text-overflow: clip !important;\n            -webkit-mask-image: linear-gradient(to right, rgba(0,0,0,1) 90%, rgba(0,0,0,0));\n            mask-image: linear-gradient(to right, rgba(0,0,0,1) 90%, rgba(0,0,0,0));\n          }\n        ",document.head.appendChild(e)}(),{init:function(i){n||(n=!0,o=i,"IntersectionObserver"in window?(r=e.getMargins().buffer,t=new IntersectionObserver(a,{root:o,rootMargin:r+"px 0px",threshold:e.getMargins().threshold})):(o.addEventListener("scroll",l,{passive:!0}),window.addEventListener("resize",l,{passive:!0})))},observe:function(e){if(!o)return;const n=e.querySelectorAll(".skin-slot");t?n.forEach(e=>t.observe(e)):l()}}})(),p=document.createElement("style");p.textContent="\n        #skinBox, .gotaio-hotkeys-modal, .skin-list, .profile-list, .skin-name {\n          scroll-behavior: smooth !important;\n          overscroll-behavior: contain;\n          will-change: transform;\n        }\n        #skinBox, .skin-list, .profile-list, .gotaio-hotkeys-modal {\n          scrollbar-width: thin;\n      scrollbar-color: #2196f3 #23272e;\n        }\n        #skinBox::-webkit-scrollbar, .skin-list::-webkit-scrollbar, .profile-list::-webkit-scrollbar, .gotaio-hotkeys-modal::-webkit-scrollbar {\n          width: 8px;\n          background: #23272e;\n          border-radius: 8px;\n        }\n        #skinBox::-webkit-scrollbar-thumb, .skin-list::-webkit-scrollbar-thumb, .profile-list::-webkit-scrollbar-thumb, .gotaio-hotkeys-modal::-webkit-scrollbar-thumb {\n      background: #2196f3;\n          border-radius: 8px;\n        }\n      ",document.head.appendChild(p);let u=null,f=new Map,y=[],m=new Map,g=null;const h=[];function b(e){"function"==typeof e&&h.push(e)}let x=!1;function v(){if(!x){x=!0;for(let e=h.length-1;e>=0;e--)try{h[e]()}catch(e){}h.length=0}}window.addEventListener("pagehide",v,{once:!0}),window.addEventListener("beforeunload",v,{once:!0});const w="gotaio_hotkeys",k="gotaio.feature.random.enabled";function C(){try{return"1"===localStorage.getItem(k)}catch(e){return!1}}function E(){const e=[{action:"Toggle gallery",key:"Shift+G"},{action:"Reset gallery position",key:"Shift+0"},{action:"Open skin page",key:"X"},{action:"Apply skin",key:"E"},{action:"Add skin",key:""},{action:"Ring Color",key:"B"},{action:"Toggle favorite",key:"F"},{action:"Delete skin",key:"Delete"}];return e.push({action:"Add to random list",key:"Shift+F"}),e}function _(){try{const e=localStorage.getItem(w);if(e){const t=JSON.parse(e),n=E();for(const e of n)t.some(t=>t.action===e.action)||t.push(e);if(!C())for(let e=t.length-1;e>=0;e--)t[e]&&"Add to random list"===t[e].action&&t.splice(e,1);return localStorage.setItem(w,JSON.stringify(t)),t}}catch(e){}const e=E();return C()?e:e.filter(e=>"Add to random list"!==e.action)}function S(e){const t=_().find(t=>t.action===e);return("Add to random list"!==e||C())&&t?t.key:null}function L(e,t){if(!t)return!1;const n=t.split("+");let o=n.pop(),r=n.includes("Shift"),i=n.includes("Ctrl"),a=n.includes("Alt"),l=n.includes("Meta");if(r!==!!e.shiftKey)return!1;if(i!==!!e.ctrlKey)return!1;if(a!==!!e.altKey)return!1;if(l!==!!e.metaKey)return!1;let s=e.key;return 1===s.length&&(s=s.toUpperCase()),1===o.length&&(o=o.toUpperCase()),1===o.length&&s===o||(!(!/^\d$/.test(o)||s!==o&&e.code!=="Digit"+o)||s===o)}function A(e,t){return t&&e?e===t?0:e.startsWith(t)?1:e.includes(t)?2:3:3}function I(){var e=document.getElementById("main-rb");e&&e.parentNode&&e.remove();var t=document.getElementById("GOT_gota-io_336x280");t&&t.parentNode&&t.remove()}!function(){const e="undefined"!=typeof unsafeWindow?unsafeWindow:window;e.__Gallery=e.__Gallery||{},e.__Gallery.unlockRandom=function(){try{localStorage.setItem(k,"1"),console.log("[Gallery] Random hotkey unlocked")}catch(e){}},e.__Gallery.lockRandom=function(){try{localStorage.removeItem(k),console.log("[Gallery] Random hotkey locked")}catch(e){}},e.__Gallery.isRandomEnabled=function(){return C()},window.__Gallery=e.__Gallery}(),"loading"===document.readyState?document.addEventListener("DOMContentLoaded",I):I();const M=document.createElement("style");M.textContent="\n        #main-rb, #GOT_gota-io_336x280, .main-bottom-links, .policyLinks {\n          display: none !important;\n          visibility: hidden !important;\n          height: 0 !important;\n          min-height: 0 !important;\n          max-height: 0 !important;\n          padding: 0 !important;\n          margin: 0 !important;\n          border: none !important;\n        }\n        .main-content.main-divider.main-panel:empty {\n          display: none !important;\n          width: 0 !important;\n          min-width: 0 !important;\n        }\n      ",document.head.appendChild(M);const T=document.createElement("style");T.textContent="\n      .skin-slot.skeleton .circle-slot::before {\n        content: '';\n        position: absolute;\n        inset: 0;\n        border-radius: 50%;\n        background: linear-gradient(90deg, rgba(120,120,120,0.25), rgba(180,180,180,0.18), rgba(120,120,120,0.25));\n        background-size: 200% 100%;\n        animation: gota-skel-shimmer 1.2s ease-in-out infinite;\n        pointer-events: none;\n      }\n      #skinBox[data-low-power=\"1\"] .skin-slot.skeleton .circle-slot::before {\n        background: linear-gradient(90deg, rgba(110,110,110,0.3), rgba(210,210,210,0.22), rgba(110,110,110,0.3));\n        animation-duration: 1.6s;\n      }\n      .skin-slot.skeleton .skin-name {\n        color: transparent;\n        background: rgba(255,255,255,0.06);\n      }\n      @keyframes gota-skel-shimmer {\n        0% { background-position: 200% 0; }\n        100% { background-position: -200% 0; }\n      }\n    ",document.head.appendChild(T);const B=document.createElement("style");B.textContent='\n        #skinBox {\n          position: absolute;\n          top: 11px;\n          left: 181px;\n          width: 600px;\n          height: 355px;\n          max-width: 100vw;\n          max-height: 100vh;\n          min-width: 320px;\n          min-height: 200px;\n          background-color: rgba(100, 100, 100, 0.3);\n          border: 2px solid gray;\n          box-sizing: border-box;\n          z-index: 9999;\n          display: flex;\n          flex-direction: column;\n          border-radius: 12px;\n          box-shadow: 0 4px 24px rgba(0,0,0,0.18);\n          overflow: hidden;\n        }\n\n        .circle-grid-container {\n          flex: 1;\n          overflow-y: auto;\n          padding: 10px;\n          box-sizing: border-box;\n          scrollbar-gutter: stable; /* prevent layout shift when scrollbar appears */\n          /* Help the browser isolate layout/paint work to this container */\n          contain: layout paint;\n        }\n\n        .circle-grid {\n          display: grid;\n    grid-template-columns: repeat(auto-fill, var(--cell, 122px));\n    grid-auto-rows: calc(var(--cell, 122px) + var(--rowExtra, 44px));\n    column-gap: var(--gap, 14px);\n    row-gap: calc(var(--gap, 14px) * 0.8);\n          width: 100%;\n    justify-content: start; /* flush left; avoids odd centering/stretching */\n        }\n\n        .skin-slot {\n          display: flex;\n          flex-direction: column;\n          align-items: center;\n          user-select: none;\n          /* CSS-driven virtualization: offscreen children are skipped by rendering engine */\n          content-visibility: auto;\n          /* Provide a reasonable placeholder size so layout can be computed without rendering content */\n          contain-intrinsic-size: 166px 122px;\n          /* Stronger isolation for paint/layout costs per item */\n          contain: content;\n        }\n\n    .circle-slot {\n      --ring-compensation: 1px;\n      /* Stable, responsive circle sized by grid column */\n      width: 100%;\n      aspect-ratio: 1 / 1;\n      display: flex;\n      align-items: center;\n      justify-content: center;\n      overflow: visible; /* Allow image to slightly overflow and cover gap */\n      box-sizing: border-box; /* keep content inside to avoid clipping */\n      position: relative; /* anchor overlays */\n      border-radius: 50%;\n      background: linear-gradient(135deg, #ff3b3b, #3bff3b, #3b3bff, #ffe53b, #ff993b, #b13bff, #ff3b3b);\n      /* single main ring; thickness and color are customizable */\n      border: calc(var(--ring-size, 3px) + var(--ring-compensation, 1px))\n        solid var(--ring-color, #fff);\n      /* keep gradient inside the ring */\n      background-clip: padding-box;\n      margin-bottom: 7px;\n      flex-shrink: 0;\n      /* Remove animation from base class for perf */\n      background-size: 400% 400%;\n      background-position: 100% 50%;\n      transition: transform .14s ease, box-shadow .14s ease;\n    }\n    /* When favorite rings are hidden via UI, force favorites to use inherited/default ring color */\n    #skinBox[data-favring="0"] .circle-slot.favorite { --ring-color: unset !important; }\n        .circle-slot.animated-bg {\n          animation: cell-rgb-breath 18s ease infinite;\n          background: linear-gradient(90deg, red, orange, yellow, green, blue, indigo, violet);\n          background-size: 1800% 1800%;\n          border-radius: 50%;\n        }\n        /* Ensure images inside circle fill the area consistently */\n        /* Slightly overflow to cover the 1px gap between border and image */\n        .circle-slot img {\n          position: absolute;\n          top: 50%;\n          left: 50%;\n          transform: translate(-50%, -50%);\n          width: calc(100% + 2px);\n          height: calc(100% + 2px);\n          object-fit: cover;\n          display: block;\n          user-select: none;\n          -webkit-user-drag: none;\n          border-radius: 50%;\n        }\n        @keyframes cell-rgb-breath {\n          0% {\n        background-position: 0 85%;\n        }\n        50% {\n        background-position: 100% 20%;\n        }\n        100% {\n        background-position: 0 85%;\n          }\n        }\n        /* Favorite badge overlays (heart/star) scale and position with circle size */\n        /* Use percent-based size/offset with safe clamps, and account for ring thickness */\n        #skinBox .circle-slot .favorite-star,\n        #skinBox .circle-slot .favorite-heart {\n          /* Derive responsive placement from --cell; safe clamps for tiny/huge cells */\n          --badge-offset: clamp(4px, calc(var(--cell, 122px) * 0.06), 12px);\n          --badge-size: clamp(18px, calc(var(--cell, 122px) * 0.22), 34px);\n          position: absolute;\n          top: calc(\n            var(--ring-size, 3px) + var(--ring-compensation, 1px) +\n            var(--badge-offset)\n          );\n          right: calc(\n            var(--ring-size, 3px) + var(--ring-compensation, 1px) +\n            var(--badge-offset)\n          );\n          width: var(--badge-size);\n          height: var(--badge-size);\n          pointer-events: none;\n          z-index: 10;\n          display: block !important;\n        }\n        #skinBox .circle-slot .favorite-star svg,\n        #skinBox .circle-slot .favorite-heart svg {\n          width: 100%;\n          height: 100%;\n          display: block;\n          filter: drop-shadow(0 0 2px #fffbe6);\n        }\n    /* Hide the front favorite badge while the card is flipped to reduce clutter */\n    #skinBox .flip-open .favorite-heart { display: none !important; }\n    #skinBox .flip-open .favorite-star { display: none !important; }\n\n        /* Back-panel layout: ownership dots, profile list, divider, and actions */\n        #skinBox .flip-back {\n          box-shadow: inset 0 0 18px rgba(0,0,0,0.28);\n          display: flex;\n          flex-direction: column;\n          align-items: center;\n          justify-content: space-between;\n          gap: 6px;\n          padding: 10px;\n          box-sizing: border-box;\n        }\n        #skinBox .flip-back .flip-back-dots {\n          width: 100%;\n          min-height: 6px;\n          display: flex;\n          flex-wrap: wrap;\n          justify-content: center;\n          gap: 4px;\n        }\n        #skinBox .flip-back .flip-back-dot {\n          width: 6px;\n          height: 6px;\n          border-radius: 50%;\n          background: rgba(255,255,255,0.58);\n        }\n        #skinBox .flip-back .flip-back-dot-more {\n          padding: 0 4px;\n          border-radius: 999px;\n          font-size: 10px;\n          line-height: 12px;\n          color: rgba(255,255,255,0.78);\n          background: rgba(255,255,255,0.2);\n        }\n        #skinBox .flip-back .flip-back-profiles {\n          flex: 1;\n          width: 100%;\n          max-height: 72px;\n          display: flex;\n          flex-direction: column;\n          align-items: center;\n          gap: 3px;\n          overflow-y: auto;\n          scrollbar-width: none;\n        }\n        /* When a skin belongs to a single profile, center that name vertically\n           and remove the scrollbar — there\'s no need to scroll for one item. */\n        #skinBox .flip-back .flip-back-profiles.single {\n          justify-content: center;\n          padding-top: 6px; /* tiny nudge down for visual balance */\n          max-height: 100%;\n          overflow: visible;\n        }\n        #skinBox .flip-back .flip-back-profiles::-webkit-scrollbar { display: none; }\n        #skinBox .flip-back .flip-back-profiles span {\n          font-family: "Segoe UI", "Helvetica Neue", Arial, sans-serif;\n          font-size: 11.5px;\n          line-height: 1.3;\n          font-weight: 620;\n          letter-spacing: 0.8px;\n          color: rgba(255,255,255,0.88);\n          text-align: center;\n          padding: 0 6px;\n          word-break: break-word;\n          text-shadow: none;\n        }\n        #skinBox .flip-back .flip-back-profiles span.current {\n          color: #ffffff;\n          font-weight: 640;\n          text-shadow: none;\n        }\n        #skinBox .flip-back .flip-back-divider {\n          width: 100%;\n          height: 1px;\n          background: linear-gradient(90deg, rgba(255,255,255,0), rgba(255,255,255,0.72), rgba(255,255,255,0));\n          opacity: 0.9;\n        }\n        #skinBox .flip-back .flip-back-actions {\n          width: 100%;\n          display: flex;\n          justify-content: center;\n          gap: 12px;\n        }\n        #skinBox .flip-back .flip-back-actions button {\n          width: 36px;\n          height: 36px;\n          border-radius: 50%;\n          border: none;\n          display: flex;\n          align-items: center;\n          justify-content: center;\n          cursor: pointer;\n          background: rgba(255,255,255,0.16);\n          box-shadow: 0 4px 12px rgba(0,0,0,0.24);\n          transition: background 0.2s ease, transform 0.2s ease, box-shadow 0.2s ease;\n          outline: none;\n        }\n        #skinBox .flip-back .flip-back-actions button:hover {\n          transform: translateY(-1px);\n        }\n        #skinBox .flip-back .flip-back-actions button:active {\n          transform: scale(0.97);\n        }\n        #skinBox .flip-back .flip-back-actions button svg {\n          width: 20px;\n          height: 20px;\n          display: block;\n        }\n        #skinBox .flip-back .flip-back-actions button.delete {\n          background: rgba(229,57,53,0.2);\n        }\n        #skinBox .flip-back .flip-back-actions button.delete:hover {\n          background: rgba(229,57,53,0.32);\n        }\n        #skinBox .flip-back .flip-back-actions button.favorite {\n          background: rgba(229,57,53,0.2);\n        }\n        #skinBox .flip-back .flip-back-actions button.favorite:hover,\n        #skinBox .flip-back .flip-back-actions button.favorite.active:hover {\n          background: rgba(229,57,53,0.32);\n        }\n        #skinBox .flip-back .flip-back-actions button.favorite.active {\n          background: rgba(229,57,53,0.2);\n        }\n        #skinBox .flip-back .flip-back-actions button svg path {\n          transition: fill 0.18s ease, stroke 0.18s ease;\n        }\n\n        .skin-name {\n          max-width: calc(var(--cell, 122px) - 24px);\n          text-align: left;\n          font-size: 12px;\n          color: white;\n          background: rgba(0,0,0,0.4);\n          border-radius: 4px;\n          padding: 2px 4px;\n          overflow: hidden;\n          text-overflow: ellipsis;\n          white-space: nowrap;\n          flex-shrink: 0;\n          cursor: pointer;\n          transition: background 0.15s, color 0.15s;\n        }\n        .skin-name.copied {\n          background: #1976d2;\n          color: #fff;\n        }\n\n        /* Info row and hover/focus accents */\n        #skinBox .info-row { width: 100%; display: flex; align-items: center; justify-content: center; gap: 6px; min-height: 20px; }\n        #skinBox .skin-slot:hover .circle-slot { transform: scale(1.02); box-shadow: 0 4px 14px rgba(0,0,0,0.25); }\n        #skinBox .skin-slot:focus-visible .circle-slot { box-shadow: 0 0 0 3px rgba(33,150,243,0.65), 0 6px 18px rgba(0,0,0,0.35); transform: scale(1.02); }\n\n        /* Make the front favorite badge and back-panel heart pop slightly */\n        #skinBox .favorite-heart svg,\n        #skinBox .flip-back .flip-back-actions button svg {\n          filter: drop-shadow(0 2px 4px rgba(0,0,0,0.6));\n        }\n\n        /* Keep flip faces circular so the back face shadow doesn\'t show corners */\n        #skinBox .flip-front,\n        #skinBox .flip-back {\n          border-radius: 50%;\n        }\n\n        /* Hide gallery if it would overlap a critical menu (example: #hud) */\n        #skinBox.overlap-warning {\n          border: 2px solid #e53935;\n          box-shadow: 0 0 16px #e53935;\n        }\n\n        /* Resize handle */\n        #skinBox .resize-handle {\n          position: absolute;\n          right: 0;\n          bottom: 0;\n          width: 18px;\n          height: 18px;\n          background: rgba(255,255,255,0.2);\n          border-radius: 0 0 8px 0;\n          cursor: se-resize;\n          z-index: 10002;\n          display: flex;\n          align-items: flex-end;\n          justify-content: flex-end;\n        }\n        #skinBox .resize-handle:after {\n          content: \'\';\n          display: block;\n          width: 12px;\n          height: 12px;\n          border-right: 2px solid #aaa;\n          border-bottom: 2px solid #aaa;\n          margin: 2px;\n          border-radius: 0 0 4px 0;\n        }\n      ',document.head.appendChild(B);const N=document.createElement("style");N.textContent="\n    #skinBox { --cell: 122px; --rowExtra: 44px; --gap: calc(max(10px, var(--cell) * 0.115)); }\n    #skinBox .circle-grid { grid-template-columns: repeat(auto-fill, var(--cell)); grid-auto-rows: calc(var(--cell) + var(--rowExtra)); column-gap: var(--gap); row-gap: calc(var(--gap) * 0.8); }\n      /* Removed explicit width/height on circle-slot to avoid conflicts with aspect-ratio sizing */\n        #skinBox .skin-slot { contain-intrinsic-size: calc(var(--cell) + var(--rowExtra)) var(--cell); }\n      ",document.head.appendChild(N);const P=document.createElement("style");P.textContent='\n      #skinBox[data-density="compact"] { --rowExtra: 30px; --gap: calc(max(8px, var(--cell) * 0.08)); }\n      #skinBox[data-density="cozy"] { --rowExtra: 44px; --gap: calc(max(10px, var(--cell) * 0.115)); }\n      #skinBox[data-density="comfortable"] { --rowExtra: 56px; --gap: calc(max(12px, var(--cell) * 0.14)); }\n    ',document.head.appendChild(P);const G=document.createElement("style");G.textContent='\n    /* Hide the favorite badge overlay when disabled */\n    #skinBox[data-fav-badge="0"] .favorite-heart,\n    #skinBox[data-fav-badge="0"] .favorite-star { display: none !important; }\n        /* Hide the Add Skin control row and its input section when disabled */\n        #skinBox[data-add-control="0"] .add-control { display: none !important; }\n        #skinBox[data-add-control="0"] .add-input { display: none !important; }\n        /* Hide the skin name label when disabled */\n        #skinBox[data-name-label="0"] .skin-name { display: none !important; }\n        /* Tighten row height a bit if labels are off */\n        #skinBox[data-name-label="0"] { --rowExtra: 30px; }\n      ',document.head.appendChild(G);const D=document.createElement("div");D.id="skinBox";const R=document.createElement("div");R.className="circle-grid-container";const z=document.createElement("div");z.className="circle-grid";try{z.setAttribute("role","grid"),z.setAttribute("aria-label","Skin gallery")}catch(Po){}function H(e){try{if(!e||!e.__listeners)return;for(const t of e.__listeners){const[n,o,r]=t;(r||e).removeEventListener(n,o)}e.__listeners.length=0;const t=e.querySelector(".circle-slot");t&&t._onKeyDown&&(document.removeEventListener("keydown",t._onKeyDown),t._onKeyDown=null)}catch(e){}}for(let Go=0;Go<44;Go++){const Do=document.createElement("div");Do.className="skin-slot skeleton";try{Do.setAttribute("role","gridcell"),Do.tabIndex=0}catch(Oo){}const Ro=document.createElement("div");Ro.className="circle-slot";const zo=document.createElement("div");zo.className="info-row";const Ho=document.createElement("div");Ho.className="skin-name",Ho.textContent=`Skin ${Go+1}`;const Fo=document.createElement("div");Fo.className="use-button",Fo.textContent="USE",zo.appendChild(Ho),zo.appendChild(Fo),Do.appendChild(Ro),Do.appendChild(zo),z.appendChild(Do)}R.appendChild(z),D.appendChild(R),function(){const e=fo();try{"static"===window.getComputedStyle(e).position&&(e.style.position="relative")}catch(e){}e.appendChild(D)}();try{void 0!==d&&(d.init(R),d.observe(z))}catch(qo){}const F="gotaio.ui.cellSize",O="gotaio.ui.ringSize";function q(){try{const e="function"==typeof GM_getValue?GM_getValue(F):localStorage.getItem(F),t=e?parseInt(e,10):130;return isNaN(t)?130:Math.max(88,Math.min(220,t))}catch(e){return 130}}function j(e){const t=Math.max(88,Math.min(220,parseInt(e,10)||130));return"function"==typeof GM_setValue?GM_setValue(F,t):localStorage.setItem(F,String(t)),t}function U(e){const t=Math.max(88,Math.min(220,parseInt(e,10)||130));try{D.style.setProperty("--cell",t+"px")}catch(e){}return t}function V(){try{const e="function"==typeof GM_getValue?GM_getValue(O):localStorage.getItem(O),t=e?parseInt(e,10):4;return isNaN(t)?4:Math.max(0,Math.min(12,t))}catch(e){return 4}}function $(e){const t=Math.max(0,Math.min(12,parseInt(e,10)||4));return"function"==typeof GM_setValue?GM_setValue(O,t):localStorage.setItem(O,String(t)),t}function W(e){const t=Math.max(0,Math.min(12,parseInt(e,10)||4));try{D.style.setProperty("--ring-size",t+"px")}catch(e){}return t}U(q()),W(V());try{ae()}catch(jo){}R&&(c.initUnloading(R),void 0!==d&&d.init(R));const Y=document.createElement("div");Y.className="add-control",Y.style.display="flex",Y.style.alignItems="center",Y.style.gap="6px",Y.style.padding="0 10px",Y.style.cursor="pointer",Y.style.userSelect="none",Y.style.color="var(--acc, #4caf50)",Y.style.fontSize="13px",Y.style.marginTop="2px";const K=document.createElement("span");K.innerHTML='<svg viewBox="0 0 24 24" width="16" height="16" aria-hidden="true" focusable="false" style="display:block"><polyline points="8,5 16,12 8,19" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></polyline></svg>',K.style.transition="transform 0.2s",K.style.color="var(--acc, #4caf50)";const J=document.createElement("span");J.textContent="add skin",Y.appendChild(K),Y.appendChild(J),D.appendChild(Y);const X=document.createElement("div");X.classList.add("add-input"),X.style.display="flex",X.style.gap="8px",X.style.alignItems="center",X.style.padding="10px",X.style.background="rgba(0,0,0,0.2)";const Q=document.createElement("input");Q.type="text",Q.placeholder='Skin Name  OR  "Name | UUID or URL"',Q.style.flex="1",Q.style.padding="4px",Q.style.borderRadius="4px",Q.style.border="1px solid #ccc";const Z=document.createElement("button");Z.textContent="Add to Gallery",Z.style.padding="4px 10px",Z.style.borderRadius="4px",Z.style.border="none",Z.style.background="#4caf50",Z.style.color="white",Z.style.cursor="pointer",X.innerHTML="",X.appendChild(Q),X.appendChild(Z),X.style.display="flex",D.appendChild(X);let ee=!1,te=null;function ne(e){("boolean"==typeof e?e:!ee)?(ee||(ee=!0,X.style.display="flex",K.style.transform="rotate(0deg)",rt(X),ot(X,()=>ne(!1)),te||(te=e=>{const t=e.target;t&&(X.contains(t)||Y.contains(t))||ne(!1)},document.addEventListener("mousedown",te,!0))),requestAnimationFrame(()=>{try{Q.focus(),"function"==typeof Q.select&&Q.select()}catch(e){}})):ee&&(ee=!1,X.style.display="none",K.style.transform="rotate(-90deg)",rt(X),te&&(document.removeEventListener("mousedown",te,!0),te=null))}X.style.display="none",K.style.transform="rotate(-90deg)",Y.addEventListener("click",()=>ne()),Q.addEventListener("keydown",e=>{"Enter"===e.key&&(e.preventDefault(),Z.click())});const oe="gotaio.ui.prefs";function re(){try{const e=localStorage.getItem(oe);if(e){const t=JSON.parse(e);return Object.assign({showFavoriteBadge:!0,showAddControl:!0,showNameLabel:!0,favBadgeStyle:"heart",hideFavoriteRing:!1},t)}}catch(e){}return{showFavoriteBadge:!0,showAddControl:!0,showNameLabel:!0,favBadgeStyle:"heart",hideFavoriteRing:!1}}function ie(e){const t=Object.assign({showFavoriteBadge:!0,showAddControl:!0,showNameLabel:!0,favBadgeStyle:"heart",hideFavoriteRing:!1},e||{});try{localStorage.setItem(oe,JSON.stringify(t))}catch(e){}return t}function ae(e){const t=e||re();try{D.dataset.favBadge=t.showFavoriteBadge?"1":"0",D.dataset.addControl=t.showAddControl?"1":"0",D.dataset.nameLabel=t.showNameLabel?"1":"0",D.dataset.favStyle="star"===t.favBadgeStyle?"star":"heart",D.dataset.favring=t.hideFavoriteRing?"0":"1",se(D.dataset.favStyle),_t()}catch(e){}return t}try{ae()}catch(Uo){}function le(e){return String(null==e?"":e).replace(/[&<>"']/g,e=>({"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"}[e]))}function se(e){try{const t=z.querySelectorAll(".circle-slot.favorite"),n="star"===e;for(const e of t){const t=e.querySelector(".flip-front")||e;if(!t)continue;let o=t.querySelector(".favorite-heart"),r=t.querySelector(".favorite-star");try{e.style.setProperty("--ring-color",n?"#ffd600":"#ff0000")}catch(e){}n?(o&&o.remove(),r||(r=document.createElement("span"),r.className="favorite-star",r.innerHTML=pe,t.appendChild(r))):(r&&r.remove(),o||(o=document.createElement("span"),o.className="favorite-heart",o.innerHTML=de,t.appendChild(o)))}}catch(e){}}const ce="gotaio_profiles_v2",de='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="24" height="24" role="img" aria-label="favorite"><path d="M12 21s-7-4.6-9-7.2C0.8 10.9 3 6 7 6c2 0 3.5 1.2 5 3 1.5-1.8 3-3 5-3 4 0 6.2 4.9 4 7.8C19 16.4 12 21 12 21z" fill="#e53935" stroke="#000" stroke-width="1.8" stroke-linejoin="round" stroke-linecap="round"/></svg>',pe='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="24" height="24" role="img" aria-label="favorite"><polygon points="12,2 15.09,8.26 22,9 17,14.14 18.18,21.02 12,17.77 5.82,21.02 7,14.14 2,9 8.91,8.26" fill="#ffd600" stroke="#000" stroke-width="1.4" stroke-linejoin="round" stroke-linecap="round"/></svg>',ue="gotaio_last_profile_idx";let fe=[],ye=0;async function me(){if("function"==typeof GM_getValue){const e=await GM_getValue(ce);if(e)try{if(fe=JSON.parse(e),!Array.isArray(fe))throw new Error("Invalid format")}catch(e){fe=[{name:"Default",skins:[]}]}else fe=[{name:"Default",skins:[]}]}else{const e=localStorage.getItem(ce);if(e)try{if(fe=JSON.parse(e),!Array.isArray(fe))throw new Error("Invalid format")}catch(e){fe=[{name:"Default",skins:[]}]}else fe=[{name:"Default",skins:[]}]}fe=fe.map(e=>({name:"string"==typeof e.name?e.name:"Default",skins:Array.isArray(e.skins)?e.skins:[],..."string"==typeof e.ringColor&&e.ringColor?{ringColor:e.ringColor}:{},..."string"==typeof e.theme&&e.theme?{theme:e.theme}:{}}));try{Ae()}catch(e){}}let ge=null,he=()=>{};function be(){try{"function"==typeof GM_setValue?GM_setValue(ce,JSON.stringify(fe)):localStorage.setItem(ce,JSON.stringify(fe))}catch(e){}}async function xe(){ge&&clearTimeout(ge),he(),ge=setTimeout(()=>{be(),ge=null},500)}try{const Vo=()=>{location&&"skins.gota.io"===location.hostname||(ge&&(clearTimeout(ge),ge=null),be())};window.addEventListener("pagehide",Vo,{once:!0}),window.addEventListener("beforeunload",Vo,{once:!0})}catch($o){}async function ve(){if("function"==typeof GM_getValue){const e=await GM_getValue(ue);ye="number"==typeof e?e:0}else{const e=localStorage.getItem(ue);ye=e?parseInt(e,10):0}}let we=null;function ke(){try{"function"==typeof GM_setValue?GM_setValue(ue,ye):localStorage.setItem(ue,ye)}catch(e){}}function Ce(){we&&clearTimeout(we),we=setTimeout(()=>{ke(),we=null},400);try{window.__MirrorSync&&"function"==typeof window.__MirrorSync.profileIndexChanged&&window.__MirrorSync.profileIndexChanged(ye)}catch(e){}try{Ae()}catch(e){}}try{window.addEventListener("pagehide",()=>{we&&(clearTimeout(we),we=null),ke()},{once:!0}),window.addEventListener("beforeunload",()=>{we&&(clearTimeout(we),we=null),ke()},{once:!0})}catch(Wo){}function Ee(e,t=14,n=!1){try{const o=String(e||"").trim();return o.length<=t?o:n?o.slice(0,t)+"…":o.slice(0,t)}catch(t){return String(e||"")}}function _e(){return(fe||[])[ye]||null}function Se(){try{const e=_e();if(e&&"string"==typeof e.ringColor&&e.ringColor)return e.ringColor}catch(e){}return null}function Le(e){try{const t=_e();if(!t)return;e?t.ringColor=e:delete t.ringColor,xe();try{be()}catch(e){}}catch(e){}}function Ae(){try{const e=Se();e?D.style.setProperty("--ring-color",e):D.style.removeProperty("--ring-color")}catch(e){}}function Ie(){try{Ge(),Ue(),"function"==typeof updateHeader&&updateHeader()}catch(e){}Ce(),ko()}const Me=document.createElement("div");Me.style.position="absolute",Me.style.top="10px",Me.style.right="10px",Me.style.zIndex="9999",Me.style.color="white",Me.style.display="flex",Me.style.alignItems="center",Me.style.gap="6px";const Te=document.createElement("button");Te.type="button",Te.title="Select profile",Te.className="gotaio-profile-button",Te.style.display="inline-flex",Te.style.alignItems="center",Te.style.height="28px",Te.style.gap="6px",Te.style.padding="0 8px",Te.style.borderRadius="6px",Te.style.fontSize="12px",Te.style.cursor="pointer",Te.style.width="110px",Te.style.minWidth="110px",Te.style.maxWidth="110px",Te.style.boxSizing="border-box",Te.style.overflow="hidden";const Be=document.createElement("span");Be.className="name",Be.style.display="inline-block",Be.style.flex="1 1 auto",Be.style.overflow="hidden",Be.style.textOverflow="ellipsis",Be.style.whiteSpace="nowrap";const Ne=document.createElement("span");Ne.className="count",Ne.style.marginLeft="4px",Ne.style.flex="none",Te.appendChild(Be),Te.appendChild(Ne);const Pe=document.createElement("span");function Ge(){try{const e=fe[ye]||{name:"Default",skins:[]},t=Ee(e.name,12,!1),n=Array.isArray(e.skins)?e.skins.length:0;Be.textContent=t,Ne.textContent=`(${n})`,Te.title=`${e.name} — ${n} skins`}catch(e){}}Pe.innerHTML='<svg viewBox="0 0 24 24" width="14" height="14" aria-hidden="true" focusable="false"><polyline points="6,9 12,15 18,9" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>',Pe.style.opacity="0.9",Pe.style.flex="none",Te.appendChild(Pe);const De=document.createElement("div");De.className="gotaio-profile-list-panel",De.style.position="fixed",De.style.zIndex="1000001",De.style.borderRadius="8px",De.style.boxShadow="0 10px 20px rgba(0,0,0,0.28)",De.style.padding="4px 0",De.style.minWidth="160px",De.style.maxWidth="160px",De.style.display="none",De.style.maxHeight="300px",De.style.overflowY="auto";let Re="",ze=null,He=null;document.body.appendChild(De),function(){if(document.getElementById("gotaio-profile-dropdown-style"))return;const e=document.createElement("style");e.id="gotaio-profile-dropdown-style",e.textContent="\n          .gotaio-profile-button {\n            display: inline-flex;\n            align-items: center;\n            height: 28px;\n            padding: 0 8px;\n            border-radius: 8px;\n            color: var(--menu-fg, #fff);\n            background: var(--profile-bg, rgba(0,0,0,0.5));\n            border: 1px solid var(--menu-fg, #fff);\n            font-family: Inter, system-ui, -apple-system, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;\n            -webkit-font-smoothing: antialiased;\n            -moz-osx-font-smoothing: grayscale;\n          }\n          .gotaio-profile-button:hover { filter: brightness(1.05); }\n    /* Use theme accent for both name and count on the button */\n    .gotaio-profile-button .name,\n    .gotaio-profile-button .count { color: var(--acc, #2196f3); }\n    /* Slightly bolder and larger name for readability */\n    .gotaio-profile-button .name { font-weight: 600; font-size: 13px; }\n    .gotaio-profile-button .count { opacity: 0.9; font-size: 12px; }\n\n    .gotaio-profile-list-panel {\n            background: var(--menu-bg, rgba(40,40,40,0.98));\n            color: var(--menu-fg, #fff);\n            border: 1px solid rgba(255,255,255,0.12);\n            font-family: Inter, system-ui, -apple-system, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;\n            -webkit-font-smoothing: antialiased;\n            -moz-osx-font-smoothing: grayscale;\n            scrollbar-width: thin;\n            scrollbar-color: var(--acc, #2196f3) var(--menu-bg, #23272e);\n          }\n    /* Use theme accent for names and counts inside panel */\n    .gotaio-profile-list-panel .name,\n    .gotaio-profile-list-panel .count { color: var(--acc, #2196f3); }\n    /* Slightly bolder and larger profile names in the list for readability */\n    .gotaio-profile-list-panel .name { font-weight: 600; font-size: 13px; }\n    .gotaio-profile-list-panel .count { font-size: 12px; }\n          .gotaio-profile-list-panel::-webkit-scrollbar { width: 8px; }\n          .gotaio-profile-list-panel::-webkit-scrollbar-track { background: var(--menu-bg, #23272e); border-radius: 8px; }\n          .gotaio-profile-list-panel::-webkit-scrollbar-thumb { background: var(--acc, #2196f3); border-radius: 8px; }\n        ",document.head.appendChild(e)}();let Fe=!1;function Oe(){if(Fe){if(De.style.display&&"none"!==De.style.display)return;Fe=!1}Ue(),De.style.display="block",function(){try{const e=Te.getBoundingClientRect(),t=De.getBoundingClientRect();let n=e.bottom+6,o=e.left;const r=window.innerWidth,i=window.innerHeight;o+t.width>r-8&&(o=Math.max(8,r-8-t.width)),n+t.height>i-8&&(n=Math.max(8,i-8-t.height)),De.style.top=`${Math.round(n)}px`,De.style.left=`${Math.round(o)}px`}catch(e){}}(),function(){if(Ve)return;Ve=e=>{try{if(De.contains(e.target)||Te&&"function"==typeof Te.contains&&Te.contains(e.target))return}catch(e){}qe()},window.addEventListener("mousedown",Ve,!0),window.addEventListener("resize",qe,{passive:!0}),$e=function(e){try{if(De.contains(e.target))return}catch(e){}qe()},window.addEventListener("scroll",$e,!0)}();try{De.focus({preventScroll:!0})}catch(e){try{De.focus()}catch(e){}}try{ot(De,()=>{try{qe()}catch(e){}})}catch(e){}Fe=!0}function qe(){if(Fe){De.style.display="none";try{rt(De)}catch(e){}!function(){if(!Ve)return;try{window.removeEventListener("mousedown",Ve,!0)}catch(e){}try{window.removeEventListener("resize",qe)}catch(e){}try{$e&&window.removeEventListener("scroll",$e,!0)}catch(e){}$e=null,Ve=null}(),Fe=!1}}function je(){Fe?qe():Oe()}function Ue(){De.innerHTML="",Re="",ze&&(clearTimeout(ze),ze=null);const e=document.createElement("div");e.style.display="flex",e.style.flexDirection="column",fe.forEach((t,n)=>{const o=document.createElement("div");o.style.display="flex",o.style.alignItems="center",o.style.justifyContent="space-between",o.style.gap="10px",o.style.padding="6px 12px",o.style.cursor="pointer",o.style.fontSize="13px",n===ye&&(o.style.background="var(--selected-bg, rgba(76,175,80,0.18))");const r=document.createElement("span");r.className="name";const i=t.name||`Profile ${n+1}`,a=Ee(i,20,!1);r.textContent=a,r.title=i,r.style.display="inline-block",r.style.overflow="hidden",r.style.textOverflow="ellipsis",r.style.whiteSpace="nowrap",r.style.maxWidth="110px";const l=document.createElement("span");l.className="count";const s=Array.isArray(t.skins)?t.skins.length:0;l.textContent=s,l.style.opacity="0.85",l.style.fontSize="12px",o.appendChild(r),o.appendChild(l),o.addEventListener("mouseenter",()=>{n!==ye&&(o.style.background="var(--hover-bg, rgba(255,255,255,0.06))")}),o.addEventListener("mouseleave",()=>{o.style.background=n===ye?"var(--selected-bg, rgba(76,175,80,0.18))":"transparent"}),o.addEventListener("click",()=>{ye=n,Ce(),Ie(),st++,Ft(),he(),qe()}),o.setAttribute("data-idx",String(n)),e.appendChild(o)}),De.appendChild(e);try{if(De.tabIndex=-1,De._profileKeyHandler){try{De.removeEventListener("keydown",De._profileKeyHandler)}catch(e){}De._profileKeyHandler=null}De._profileKeyHandler=function(e){if("Escape"===e.key)return void qe();if("Enter"===e.key){if(He){const e=parseInt(He.getAttribute("data-idx")||"-1",10);Number.isNaN(e)||(ye=e,Ce(),Ie(),Ft(),he(),qe())}return}if("Backspace"===e.key)Re=Re.slice(0,-1);else{if(1!==e.key.length)return;Re+=e.key}const t=Re.trim().toLowerCase();if(ze&&clearTimeout(ze),ze=setTimeout(()=>{Re="",ze=null,He&&(He.style.background=parseInt(He.getAttribute("data-idx")||"-1",10)===ye?"var(--selected-bg, rgba(76,175,80,0.18))":"transparent",He=null)},700),!t){const e=De.querySelectorAll("[data-idx]");for(let t=0;t<e.length;t++)e[t].style.display="flex";return void(He&&(He.style.background=parseInt(He.getAttribute("data-idx")||"-1",10)===ye?"var(--selected-bg, rgba(76,175,80,0.18))":"transparent",He=null))}const n=De.querySelectorAll("[data-idx]");let o=null,r=null;for(let e=0;e<n.length;e++){const i=n[e];try{const e=(i.querySelector(".name")&&i.querySelector(".name").title||i.querySelector(".name").textContent||"").toLowerCase().startsWith(t);i.style.display=e?"flex":"none",e&&!r&&(r=i),!o&&e&&(o=i)}catch(e){}}if(!o){for(let e=0;e<n.length;e++)n[e].style.display="flex";o=null,r=null}if(o){He&&He!==o&&(He.style.background=parseInt(He.getAttribute("data-idx")||"-1",10)===ye?"var(--selected-bg, rgba(76,175,80,0.18))":"transparent"),o.style.background="var(--hover-bg, rgba(255,255,255,0.08))",He=o;try{o.scrollIntoView({block:"nearest"})}catch(e){}}},De.addEventListener("keydown",De._profileKeyHandler)}catch(e){}}let Ve=null,$e=null;Te.addEventListener("click",e=>{je(),e.stopPropagation()}),Te.addEventListener("keydown",e=>{const t=e.key||e.code;if("Enter"===t||" "===t)return e.preventDefault(),void je();Fe?"Escape"===t&&qe():("ArrowDown"===t&&(e.preventDefault(),ye=(ye+1)%fe.length,Ie(),st++,Ft(),he()),"ArrowUp"===t&&(e.preventDefault(),ye=(ye-1+fe.length)%fe.length,Ie(),st++,Ft(),he()))}),Te.addEventListener("wheel",e=>{if(Fe)return;if(!fe||fe.length<2)return;e.preventDefault();const t=e.deltaY>0?1:-1;ye=(ye+t+fe.length)%fe.length,Ce(),Ie(),st++,Ft(),he()},{passive:!1}),Me.appendChild(Te);const We=document.createElement("button");We.title="Settings",We.className="gotaio-gear-button",We.innerHTML='<svg viewBox="0 0 24 24" width="18" height="18" aria-hidden="true" focusable="false"><path d="M12 8.5a3.5 3.5 0 1 0 0 7 3.5 3.5 0 0 0 0-7zm9.4 3.5a7.5 7.5 0 0 0-.14-1.42l2.1-1.63-2-3.46-2.54 1a7.69 7.69 0 0 0-2.46-1.42l-.38-2.7h-4l-.38 2.7a7.69 7.69 0 0 0-2.46 1.42l-2.54-1-2 3.46 2.1 1.63A7.5 7.5 0 0 0 2.6 12c0 .48.05.96.14 1.42l-2.1 1.63 2 3.46 2.54-1c.74.6 1.58 1.08 2.46 1.42l.38 2.7h4l.38-2.7c.88-.34 1.72-.82 2.46-1.42l2.54 1 2-3.46-2.1-1.63c.09-.46.14-.94.14-1.42z" fill="currentColor"/></svg>',We.style.background="transparent",We.style.color="var(--acc, #4caf50)",function(){const e=We.querySelector("svg");e&&(e.style.color="var(--acc, #4caf50)")}(),We.style.border="1px solid rgba(255,255,255,0.12)",We.style.borderRadius="8px",We.style.width="28px",We.style.height="28px",We.style.display="inline-flex",We.style.alignItems="center",We.style.justifyContent="center",We.style.cursor="pointer",We.style.marginLeft="6px",We.addEventListener("mouseenter",()=>{We.style.background="rgba(255,255,255,0.08)",We.style.borderColor="rgba(255,255,255,0.2)"}),We.addEventListener("mouseleave",()=>{We.style.background="transparent",We.style.borderColor="rgba(255,255,255,0.12)"}),Me.appendChild(We),"undefined"!=typeof addProfileButton&&addProfileButton.parentNode&&addProfileButton.remove(),"undefined"!=typeof deleteProfileButton&&deleteProfileButton.parentNode&&deleteProfileButton.remove();const Ye=document.createElement("div");Ye.style.position="fixed",Ye.style.top="32px",Ye.style.right="20px",Ye.style.background="rgba(40,40,40,0.98)",Ye.style.color="white",Ye.style.borderRadius="8px",Ye.style.boxShadow="0 2px 8px rgba(0,0,0,0.18)",Ye.style.padding="6px 0",Ye.style.display="none",Ye.style.fontSize="14px",Me.appendChild(Ye),function(){let e=null;window.addEventListener("resize",()=>{e&&clearTimeout(e),e=setTimeout(()=>{try{Ye.style.top="32px",Ye.style.right="20px"}catch(e){}e=null},120)})}();const Ke=document.createElement("div");Ke.textContent="Add Profile",Ke.style.padding="8px 18px",Ke.style.cursor="pointer",Ke.addEventListener("mouseenter",()=>Ke.style.background="rgba(76,175,80,0.18)"),Ke.addEventListener("mouseleave",()=>Ke.style.background=""),Ke.addEventListener("click",()=>{Ye.style.display="none",En({title:"Add Profile",message:"Enter new profile name:",input:{placeholder:"Profile name"},confirmText:"Add",cancelText:"Cancel",onConfirm:e=>{e&&(fe.some(t=>t.name===e)?En({title:"Duplicate Profile Name",message:"You already have a profile with that name. (Both will be kept)",confirmText:"OK",cancelText:null,onConfirm:()=>{}}):(fe.push({name:e,skins:[]}),ye=fe.length-1,xe(),Ie(),Ft(),he()))}})});const Je=document.createElement("div");Je.textContent="Rename Profile",Je.style.padding="8px 18px",Je.style.cursor="pointer",Je.addEventListener("mouseenter",()=>Je.style.background="rgba(255,193,7,0.18)"),Je.addEventListener("mouseleave",()=>Je.style.background=""),Je.addEventListener("click",()=>{Ye.style.display="none",function(){const e=fe[ye];if(!e)return;En({title:"Rename Profile",message:"Enter new name for this profile:",input:{placeholder:"New profile name",value:e.name},confirmText:"Rename",cancelText:"Cancel",onConfirm:t=>{t&&(e.name=t,xe(),Ie(),Ft(),he())}})}()});const Xe=document.createElement("div");Xe.textContent="Delete Profile",Xe.style.padding="8px 18px",Xe.style.cursor="pointer",Xe.addEventListener("mouseenter",()=>Xe.style.background="rgba(211,47,47,0.18)"),Xe.addEventListener("mouseleave",()=>Xe.style.background=""),Xe._deleteListener&&Xe.removeEventListener("click",Xe._deleteListener),Xe._deleteListener=function(){Ye.style.display="none",fe.length<=1?En({title:"Cannot Delete Profile",message:"You cannot delete the last profile.",confirmText:"OK",cancelText:null,onConfirm:()=>{}}):En({title:"Delete Profile",message:`Are you sure you want to delete the profile "${le(fe[ye].name)}"<br><span style='color:#f55'>(This cannot be undone.)</span>`,confirmText:"Delete",cancelText:"Cancel",onConfirm:()=>{fe.splice(ye,1),ye>=fe.length&&(ye=fe.length-1),xe(),Ie(),Ft(),he()}})},Xe.addEventListener("click",Xe._deleteListener);const Qe=document.createElement("div");Qe.textContent="Share Profile",Qe.style.padding="8px 18px",Qe.style.cursor="pointer",Qe.addEventListener("mouseenter",()=>Qe.style.background="rgba(33,150,243,0.18)"),Qe.addEventListener("mouseleave",()=>Qe.style.background=""),Qe.addEventListener("click",()=>{Ye.style.display="none",function(){const e=fe[ye];if(!e)return void En({title:"No Profile Selected",message:"No profile selected to share.",confirmText:"OK",cancelText:null,onConfirm:()=>{}});const t=JSON.stringify({name:e.name,skins:e.skins},null,2),n=new Blob([t],{type:"application/json"}),o=URL.createObjectURL(n),r=document.createElement("a");r.href=o,r.download=`gotaio_profile_${i=e.name,(String(null==i?"":i).trim().replace(/[^a-z0-9 _.\-]/gi,"_").replace(/_{2,}/g,"_")||"file").slice(0,100)}.json`,document.body.appendChild(r),r.click(),setTimeout(()=>{r&&r.parentNode===document.body&&document.body.removeChild(r),URL.revokeObjectURL(o)},100);var i}()});const Ze=document.createElement("div");Ze.textContent="Import Profiles",Ze.style.padding="8px 18px",Ze.style.cursor="pointer",Ze.addEventListener("mouseenter",()=>Ze.style.background="rgba(255,193,7,0.18)"),Ze.addEventListener("mouseleave",()=>Ze.style.background=""),Ze.addEventListener("click",()=>{Ye.style.display="none",function(){const e=document.createElement("input");e.type="file",e.accept=".json,application/json",e.style.display="none",e.addEventListener("change",()=>{const t=e.files[0];if(!t)return;const n=new FileReader;n.onload=function(e){try{const t=function(e){if(!e||"object"!=typeof e)return null;const t="string"==typeof e.name&&e.name.trim()?e.name.trim():null,n=Array.isArray(e.skins)?e.skins.map(e=>({name:e&&"string"==typeof e.name?e.name.trim():null,uuid:e&&"string"==typeof e.uuid?e.uuid.trim():null})).filter(e=>e.name&&e.uuid):[];return t?{name:t,skins:n}:null}(JSON.parse(e.target.result));if(!t)throw new Error("Invalid format");fe.some(e=>e.name===t.name)&&En({title:"Duplicate Profile Name",message:"You already have a profile with that name. (Both will be kept)",confirmText:"OK",cancelText:null,onConfirm:()=>{}}),fe.push({name:t.name,skins:t.skins}),ye=fe.length-1,xe(),Ie(),Ft(),he(),$t("Profile imported!","green")}catch(e){En({title:"Import Failed",message:"Failed to import: "+le(e&&e.message?e.message:String(e)),confirmText:"OK",cancelText:null,onConfirm:()=>{}})}},n.readAsText(t)}),document.body.appendChild(e),e.click(),setTimeout(()=>{e&&e.parentNode===document.body&&document.body.removeChild(e)},1e3)}()}),Ye.appendChild(Ke),Ye.appendChild(Je),Ye.appendChild(Xe),Ye.appendChild(Qe),Ye.appendChild(Ze),We.addEventListener("click",e=>{const t="block"!==Ye.style.display;if(Ye.style.display=t?"block":"none",t){tt();const e=Ye.firstElementChild;if(e&&e.focus)try{e.focus()}catch(e){}}else nt();e.stopPropagation()}),window.addEventListener("mousedown",e=>{Ye.contains(e.target)||e.target===We||(Ye.style.display="none",nt())});let et=null;function tt(){et||(et=function(e){const t=e.key||e.code;"Escape"!==t&&"Esc"!==t||(e.stopPropagation(),"function"==typeof e.stopImmediatePropagation&&e.stopImmediatePropagation(),e.preventDefault(),Ye.style.display="none",nt())},window.addEventListener("keydown",et,!0))}function nt(){et&&(window.removeEventListener("keydown",et,!0),et=null)}function ot(e,t){if(!e)return;const n=function(o){const r=o.key||o.code;if("Escape"===r||"Esc"===r){o.stopPropagation(),"function"==typeof o.stopImmediatePropagation&&o.stopImmediatePropagation(),o.preventDefault();try{t&&t()}catch(e){}window.removeEventListener("keydown",n,!0),e.__escTrap=null}};e.__escTrap=n,window.addEventListener("keydown",n,!0)}function rt(e){const t=e&&e.__escTrap;t&&(window.removeEventListener("keydown",t,!0),e.__escTrap=null)}D.appendChild(Me);const it="gotaio_skin_sort_order";let at=localStorage.getItem(it)||"newest",lt=[],st=0;const ct=document.createElement("div");function dt(){ct.innerHTML="newest"===at?'<svg viewBox="0 0 24 24" width="18" height="18" aria-hidden="true"><polyline points="6,9 12,15 18,9" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>':'<svg viewBox="0 0 24 24" width="18" height="18" aria-hidden="true"><polyline points="6,15 12,9 18,15" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>',ct.title="newest"===at?"Newest First":"Oldest First"}ct.style.cursor="pointer",ct.style.color="var(--acc, #4caf50)",ct.style.display="inline-flex",ct.style.alignItems="center",ct.style.justifyContent="center",ct.style.width="28px",ct.style.height="28px",ct.style.margin="0",ct.addEventListener("click",()=>{at="newest"===at?"oldest":"newest",localStorage.setItem(it,at),dt(),Ht()}),dt();const pt=document.createElement("input");pt.className="gotaio-search-input",pt.type="text",pt.placeholder="Search…",pt.style.width="110px",pt.style.display="none",pt.style.height="28px",pt.style.marginLeft="0",pt.style.padding="0 6px",pt.style.borderRadius="6px",pt.style.border="1px solid var(--field-border, rgba(255,255,255,0.12))",pt.style.fontSize="12px",pt.style.background="var(--field-bg, rgba(40,40,40,0.6))",pt.style.backdropFilter="blur(10px)",pt.style.webkitBackdropFilter="blur(10px)",pt.style.color="var(--field-fg, white)",pt.style.outline="none",pt.style.transition="width 0.2s, border-color .15s";const ut=document.createElement("span");ut.className="gotaio-search-count",ut.style.display="none",ut.style.marginLeft="6px",ut.style.fontSize="11px",ut.style.color="var(--field-fg-muted, rgba(255,255,255,0.6))",ut.style.userSelect="none",ut.style.whiteSpace="nowrap",ut.textContent="";let ft=!1;const yt=document.createElement("button");function mt(){yt.title=ft?"Searching ALL profiles (click to search only current profile)":"Search all profiles (currently OFF)",yt.style.filter=ft?"drop-shadow(0 0 4px #4cafef)":"grayscale(0.7)"}function gt(e,t){if(ut)if(e){const e=1===t?"1 result":`${t} results`;ut.textContent=e,ut.style.display="inline-flex"}else ut.textContent="",ut.style.display="none"}yt.innerHTML='<svg viewBox="0 0 24 24" width="18" height="18" aria-hidden="true"><circle cx="12" cy="12" r="9" stroke="currentColor" stroke-width="1.8" fill="none"/><path d="M12 3c2.5 2.4 4 5.6 4 9s-1.5 6.6-4 9c-2.5-2.4-4-5.6-4-9s1.5-6.6 4-9z" fill="none" stroke="currentColor" stroke-width="1.4"/><path d="M3 12h18" stroke="currentColor" stroke-width="1.4"/></svg>',yt.style.display="none",yt.style.background="none",yt.style.border="none",yt.style.width="28px",yt.style.height="28px",yt.style.alignItems="center",yt.style.justifyContent="center",yt.style.cursor="pointer",yt.style.marginLeft="0",yt.style.color="#4cafef",yt.title="Search all profiles (currently OFF)",yt.addEventListener("click",e=>{ft=!ft,mt(),Ft(),e.stopPropagation()}),mt(),yt.addEventListener("mousedown",e=>{e.preventDefault(),e.stopPropagation(),pt.focus()}),pt.addEventListener("focus",()=>{pt.style.width="150px",yt.style.display="inline-flex",window.__searchEscTrap||(window.__searchEscTrap=function(e){const t=e.key||e.code;if("Escape"===t||"Esc"===t){e.stopPropagation(),"function"==typeof e.stopImmediatePropagation&&e.stopImmediatePropagation(),e.preventDefault();try{pt.blur()}catch(e){}window.removeEventListener("keydown",window.__searchEscTrap,!0),window.__searchEscTrap=null}},window.addEventListener("keydown",window.__searchEscTrap,!0))}),pt.addEventListener("blur",e=>{window.__searchEscTrap&&(window.removeEventListener("keydown",window.__searchEscTrap,!0),window.__searchEscTrap=null),setTimeout(()=>{if(document.activeElement!==yt){pt.style.width="110px",yt.style.display="none";try{Dt||pt.value.trim()||(pt.style.display="none")}catch(e){}}},0)}),pt.addEventListener("input",function(e,t=120){let n;return function(...o){clearTimeout(n),n=setTimeout(()=>e.apply(this,o),t)}}(()=>{Ht()},140));const ht=document.createElement("div");ht.style.display="flex",ht.style.alignItems="center",ht.style.justifyContent="space-between",ht.style.margin="6px 0 4px 10px",ht.style.gap="10px",ht.style.height="28px",ht.style.width="calc(100% - 20px)";const bt=document.createElement("div");bt.style.display="flex",bt.style.alignItems="center",bt.style.gap="6px";const xt="gotaio.ui.density";function vt(){try{return localStorage.getItem(xt)||"compact"}catch(e){return"compact"}}function wt(e){try{localStorage.setItem(xt,e)}catch(e){}}function kt(e){const t="compact"===e||"cozy"===e||"comfortable"===e?e:"compact";return D.setAttribute("data-density",t),wt(t),t}kt(vt()),ht.appendChild(bt),D.insertBefore(ht,R);let Ct=!1;const Et=document.createElement("button");function _t(){const e="star"===(D&&D.dataset&&D.dataset.favStyle?D.dataset.favStyle:"heart");Et.innerHTML=e?'<svg viewBox="0 0 24 24" width="22" height="22" aria-hidden="true"><polygon points="12,2 15.09,8.26 22,9 17,14.14 18.18,21.02 12,17.77 5.82,21.02 7,14.14 2,9 8.91,8.26" fill="currentColor" stroke="#000" stroke-width="1.2" stroke-linejoin="round"/></svg>':'<svg viewBox="0 0 24 24" width="22" height="22" aria-hidden="true"><path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z" fill="currentColor" stroke="#000" stroke-width="1.2"/></svg>',Et.style.color=e?"#ffd600":"#e53935",Et.style.filter=Ct?e?"drop-shadow(0 0 4px #ffd600)":"drop-shadow(0 0 4px #ff0000)":"grayscale(0.7)",Et.title=Ct?"Showing only favorites":"Show only favorites"}Et.title="Show only favorites",Et.style.background="none",Et.style.border="none",Et.style.fontSize="18px",Et.style.margin="0",Et.style.cursor="pointer",Et.style.transition="filter 0.15s, color 0.15s",Et.style.width="28px",Et.style.height="28px",Et.style.display="flex",Et.style.alignItems="center",Et.style.justifyContent="center",Et.style.padding="0",Et.style.boxSizing="content-box",Et.addEventListener("mousedown",e=>e.stopPropagation()),Et.addEventListener("click",()=>{Ct=!Ct,_t(),Ht()}),_t();let St=window.__skinSitePopupRef||null;let Lt=window.__skinSitePopupIdleTimer||null,At=window.__skinSitePopupCloseWatcher||null,It=!1;function Mt(){Lt&&(clearTimeout(Lt),Lt=null,window.__skinSitePopupIdleTimer=null),At&&(clearInterval(At),At=null,window.__skinSitePopupCloseWatcher=null),St=null,window.__skinSitePopupRef=null,It=!1}function Tt(){St&&!St.closed?(Lt&&clearTimeout(Lt),Lt=setTimeout(()=>{try{St&&!St.closed&&St.close()}catch(e){}Mt()},6e4),window.__skinSitePopupIdleTimer=Lt):Mt()}function Bt(e){var t;St=e,window.__skinSitePopupRef=e,It=!1,t=e,At&&clearInterval(At),At=setInterval(()=>{t&&!t.closed||Mt()},1e3),window.__skinSitePopupCloseWatcher=At,Tt()}const Nt=document.createElement("button");Nt.title="Open skins.gota.io",Nt.style.background="none",Nt.style.border="none",Nt.style.margin="0",Nt.style.cursor="pointer",Nt.style.width="28px",Nt.style.height="28px",Nt.style.display="flex",Nt.style.alignItems="center",Nt.style.justifyContent="center",Nt.style.padding="0",Nt.style.boxSizing="content-box",Nt.style.color="var(--acc, #4caf50)",Nt.style.transition="filter 0.15s, color 0.15s",Nt.style.filter="none",Nt.innerHTML='<svg viewBox="0 0 24 24" width="18" height="18" aria-hidden="true"><path d="M4 5h9v4h7v10H4V5z" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linejoin="round"/><path d="M13 5l7 4" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"/></svg>',Nt.addEventListener("mousedown",e=>e.stopPropagation());const Pt=()=>{Nt.style.filter="drop-shadow(0 0 4px currentColor)"},Gt=()=>{Nt.style.filter="none"};Nt.addEventListener("mouseenter",Pt),Nt.addEventListener("mouseleave",Gt),Nt.addEventListener("focus",Pt),Nt.addEventListener("blur",Gt),Nt.addEventListener("click",e=>{e.stopPropagation();St&&St.closed&&Mt();try{if(St&&!St.closed)return St.focus(),void Tt()}catch(e){Mt()}if(It)return;It=!0;const t=window.open("https://skins.gota.io/explore","gallerySkinBrowser","width=1024,height=800,menubar=no,toolbar=no,location=yes,status=yes,scrollbars=yes,resizable=yes");if(t){Bt(t);try{t.focus()}catch(e){}}else{It=!1;try{$t("Popup blocked. Allow popups for skins.gota.io","red")}catch(e){}}});let Dt=!1;const Rt=document.createElement("button");Rt.title="Search",Rt.style.background="none",Rt.style.border="none",Rt.style.margin="0",Rt.style.cursor="pointer",Rt.style.width="28px",Rt.style.height="28px",Rt.style.display="flex",Rt.style.alignItems="center",Rt.style.justifyContent="center",Rt.style.padding="0",Rt.style.boxSizing="content-box",Rt.style.color="var(--acc, #4caf50)",Rt.innerHTML='<svg viewBox="0 0 24 24" width="18" height="18" aria-hidden="true" focusable="false"><circle cx="11" cy="11" r="7" fill="none" stroke="currentColor" stroke-width="2"/><line x1="16.65" y1="16.65" x2="21" y2="21" stroke="currentColor" stroke-width="2" stroke-linecap="round"/></svg>',Rt.addEventListener("click",e=>{Dt&&pt.value.trim()?(pt.value="",Dt=!1):Dt=!Dt,function(){if(Dt){pt.style.display="inline-block";try{setTimeout(()=>pt.focus(),0)}catch(e){}}else{try{document.activeElement===pt&&pt.blur()}catch(e){}pt.value.trim()||(pt.style.display="none"),yt.style.display="none",pt.value.trim()||gt("",0)}Ht()}(),e.stopPropagation()}),bt.appendChild(Et),bt.appendChild(ct),bt.appendChild(Nt),bt.appendChild(Rt),bt.appendChild(pt),bt.appendChild(yt),bt.appendChild(ut);try{Me&&ht&&(Me.style.position="static",Me.style.top="",Me.style.right="",Me.style.zIndex="",Me.style.marginLeft="auto",ht.appendChild(Me))}catch(Yo){}function zt(e){document.querySelectorAll("#skinBox .circle-slot").forEach(t=>{e?t.classList.add("animated-bg"):t.classList.remove("animated-bg")})}function Ht(){if(!z)return;const e=(pt.value||"").trim(),t=!!ft&&!!e,n=!!g&&g.startsWith("ALL|"),o=function(){const e=(pt.value||"").trim().toLowerCase(),t=!!ft,n=!!Ct;let o;o=t&&e?fe.flatMap(e=>e.skins||[]):fe[ye]?.skins||[],n&&(o=o.filter(e=>e&&e.favorite));for(const e of o)e&&"string"==typeof e.name&&e.name&&!e.__lower&&(e.__lower=e.name.toLowerCase());if(e){const n="newest"===at?[...o].reverse():o,r=[];for(let t=0;t<n.length;t++){const o=n[t],i=A(o.__lower||"",e);i>=3||r.push({s:o,rel:i,i:t})}if(r.sort((e,t)=>e.rel-t.rel||e.i-t.i),t){const e=new Set,t=[];for(const n of r){const o=n.s&&n.s.uuid?n.s.uuid:"__idx"+n.i;e.has(o)||(e.add(o),t.push(n.s))}return t}return r.map(e=>e.s)}return"newest"===at?[...o].reverse():o}();if(gt(e,o.length),t&&!n)return void Ft();if(!t&&n)return void Ft();if(!y.length)return;const r=o.map(e=>e.uuid).filter(Boolean),i=new Set(r),a=document.createDocumentFragment();for(const e of y){const t=f.get(e);t&&(i.has(e)?"none"===t.style.display&&(t.style.display=""):"none"!==t.style.display&&(t.style.display="none"))}for(let e=0;e<r.length;e++){const t=r[e],n=f.get(t);n&&(n.setAttribute("data-index",String(e)),a.appendChild(n))}a.childNodes.length&&z.appendChild(a);try{void 0!==d&&d.observe(z)}catch(e){}try{void 0!==c&&c.init(z)}catch(e){}}function Ft(){let e=[],t=[];try{const n=(pt.value||"").trim(),o=n.toLowerCase(),r=!!ft&&!!n;if(r){const n=[];for(let e=0;e<fe.length;e++){const t=fe[e]&&fe[e].skins?fe[e].skins:[];for(let o=0;o<t.length;o++)n.push({s:t[o],o:e})}const r=new Map;for(let e=0;e<n.length;e++){const{s:t,o:i}=n[e],a=A(t&&t.__lower?t.__lower:t&&"string"==typeof t.name?t.name.toLowerCase():"",o),l=t&&t.uuid?t.uuid:"__idx"+e,s=r.get(l);(!s||a<s.rel||a===s.rel&&e<s.idx)&&r.set(l,{skin:t,owner:i,rel:a,idx:e})}const i=Array.from(r.values());e=i.map(e=>e.skin),t=i.map(e=>e.owner)}else e=fe[ye]?.skins||[],t=new Array(e.length).fill(ye);lt=e.map((e,t)=>t);const i=e.length,a=(r?"ALL":String(ye))+"|"+i+"|"+st;if(g===a)return void Ht();g=a}catch(e){}try{Ae()}catch(e){}const n=(e,t)=>{try{const t=e&&"string"==typeof e.name?e.name.trim():"";if(t)return t}catch(e){}return`Profile ${t+1}`},o=new Map;try{for(let e=0;e<fe.length;e++){const t=fe[e];if(!t||!Array.isArray(t.skins))continue;const r=n(t,e);for(const e of t.skins){if(!e||!e.uuid)continue;let t=o.get(e.uuid);t||(t=[],o.set(e.uuid,t)),t.includes(r)||t.push(r)}}}catch(e){}const r=document.getElementById("skin-drag-clone");r&&r.parentNode&&r.remove(),z.innerHTML="";const i=document.createDocumentFragment();f.clear(),m.clear();for(let r=0;r<e.length;r++){const a=e[r];m.set(a.uuid,a);const l=document.createElement("div");l.className="skin-slot skeleton";try{l.setAttribute("role","gridcell"),l.tabIndex=0,l.setAttribute("aria-label",`Skin: ${a.name}`)}catch(e){}l.dataset.uuid=a.uuid;try{const e=lt?lt[r]:r;l.setAttribute("data-real-index",e)}catch(e){}l.__listeners=[],l.setAttribute("data-index",r);const s=t&&null!=t[r]?t[r]:ye;try{l.setAttribute("data-owner-profile",String(s))}catch(e){}const c=(()=>{const e=o.get(a.uuid),t=e?[...e]:[],r=fe[s],i=n(r,s);if(t.length){const e=t.indexOf(i);-1===e?t.unshift(i):e>0&&(t.splice(e,1),t.unshift(i))}else t.push(i);return t})(),d=document.createElement("div");if(d.className="circle-slot"+(a.favorite?" favorite":""),a.favorite)try{const e=re().favBadgeStyle||"heart";d.style.setProperty("--ring-color","star"===e?"#ffd600":"#ff0000")}catch(e){d.style.setProperty("--ring-color","#ff0000")}else d.style.removeProperty("--ring-color");const p=document.createElement("img");p.setAttribute("data-vsrc",`https://skin-data.gota.io/${a.uuid}.png`),p.alt=a.name,p.loading="lazy",p.onerror=function(){p.style.display="none"},d.appendChild(p);const g=document.createElement("div");g.className="info-row";const h=document.createElement("div");h.className="skin-name",h.textContent=a.name,h.title="Click to copy",h.addEventListener("click",()=>{navigator.clipboard.writeText(a.name),h.classList.add("copied"),h.textContent="Copied!",setTimeout(()=>{h.classList.remove("copied"),h.textContent=a.name},900)}),g.appendChild(h),l.appendChild(d),l.appendChild(g),i.appendChild(l),f.set(a.uuid,l),l.style.perspective="400px";const b=document.createElement("div");b.style.width="100%",b.style.height="100%",b.style.position="relative",b.style.transition="transform 0.2s cubic-bezier(.2,.8,.2,1)",b.style.willChange="transform",b.style.transformStyle="preserve-3d";const x=document.createElement("div");if(x.className="flip-front",x.style.position="absolute",x.style.width="100%",x.style.height="100%",x.style.backfaceVisibility="hidden",x.appendChild(p),a.favorite){if("star"===(re().favBadgeStyle||"heart")){const e=document.createElement("span");e.className="favorite-star",e.innerHTML=pe,x.appendChild(e),d.style.setProperty("--ring-color","#ffd600")}else{const e=document.createElement("span");e.className="favorite-heart",e.innerHTML=de,x.appendChild(e),d.style.setProperty("--ring-color","#ff0000")}}const v=document.createElement("div");v.className="flip-back",v.style.position="absolute",v.style.top="-1.5px",v.style.left="-1.5px",v.style.width="calc(100% + 3px)",v.style.height="calc(100% + 3px)",v.style.background="rgba(0,0,0,0.7)",v.style.display="flex",v.style.flexDirection="column",v.style.alignItems="center",v.style.justifyContent="space-between",v.style.gap="6px",v.style.padding="10px",v.style.boxSizing="border-box",v.style.backfaceVisibility="hidden",v.style.transform="rotateY(180deg)";const w=document.createElement("div");w.className="flip-back-dots";const k=9,C=Math.min(c.length,k);for(let e=0;e<C;e++){const e=document.createElement("span");e.className="flip-back-dot",w.appendChild(e)}if(c.length>k){const e=document.createElement("span");e.className="flip-back-dot-more",e.textContent="+"+(c.length-k),w.appendChild(e)}v.appendChild(w);const E=document.createElement("div");E.className="flip-back-profiles",1===c.length&&E.classList.add("single"),c.forEach((e,t)=>{const n=document.createElement("span");n.textContent=e,0===t&&n.classList.add("current"),E.appendChild(n)}),v.appendChild(E);const _=document.createElement("div");_.className="flip-back-divider",v.appendChild(_);const A=document.createElement("div");A.className="flip-back-actions";const I=document.createElement("button");I.className="delete",I.title="Delete",I.setAttribute("aria-label","Delete skin"),I.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="#f36c60" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"><polyline points="3 6 5 6 21 6"></polyline><path d="M19 6l-1 14a2 2 0 0 1-2 2H8a2 2 0 0 1-2-2L5 6"></path><path d="M10 11v6"></path><path d="M14 11v6"></path><path d="M9 6V4a2 2 0 0 1 2-2h2a2 2 0 0 1 2 2v2"></path></svg>';const M=e=>{const t=fe[s].skins,n=t.findIndex(e=>e.name===a.name&&e.uuid===a.uuid);if(-1!==n){Ot={...t[n]},qt=s,jt=n,t.splice(n,1),xe(),Ie();const e=z.querySelector(`.skin-slot[data-uuid="${a.uuid}"]`);e&&(H(e),e.__listeners=null,e.remove()),f&&f.delete(a.uuid),m&&m.delete(a.uuid),Array.isArray(y)&&(y=y.filter(e=>e!==a.uuid)),Ht(),"function"==typeof d._mouseleaveHandler&&d._mouseleaveHandler(),D&&(document.removeEventListener("mousedown",D,!0),D=null),void 0!==u&&u===b&&(u=null),$t("Skin deleted!","red",function(){Ot&&fe[qt]&&(fe[qt].skins.splice(jt,0,Ot),xe(),Ie(),st++,Ft(),$t("Skin restored!","green"),Ot=null,qt=null,jt=null)})}e.stopPropagation()};I.addEventListener("click",M),l.__listeners.push(["click",M,I]),A.appendChild(I);const T=document.createElement("button");T.className="favorite",T.title=a.favorite?"Unfavorite":"Favorite",T.setAttribute("aria-label",a.favorite?"Remove from favorites":"Add to favorites"),T.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="#f36c60" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"><path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21l7.78-7.55 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"></path></svg>';const B=T.querySelector("svg path"),N=()=>{T.classList.toggle("active",a.favorite),T.setAttribute("aria-label",a.favorite?"Remove from favorites":"Add to favorites"),T.setAttribute("aria-pressed",a.favorite?"true":"false"),T.title=a.favorite?"Unfavorite":"Favorite",B&&(a.favorite?(B.setAttribute("fill","#f36c60"),B.setAttribute("stroke","#f36c60")):(B.setAttribute("fill","none"),B.setAttribute("stroke","#f36c60")))};N();const P=e=>{if(a.favorite=!a.favorite,xe(),d.classList.toggle("favorite",a.favorite),a.favorite){const e=re().favBadgeStyle||"heart";d.style.setProperty("--ring-color","star"===e?"#ffd600":"#ff0000")}else d.style.removeProperty("--ring-color");N();let t=x.querySelector(".favorite-heart"),n=x.querySelector(".favorite-star");if(a.favorite){"star"===(re().favBadgeStyle||"heart")?(t&&t.remove(),n||(n=document.createElement("span"),n.className="favorite-star",n.innerHTML=pe,x.appendChild(n))):(n&&n.remove(),t||(t=document.createElement("span"),t.className="favorite-heart",t.innerHTML=de,x.appendChild(t)))}else t&&t.remove(),n&&n.remove();$t(a.favorite?"Added to favorites!":"Removed from favorites!",a.favorite?"green":"red"),Ct&&Ht(),d._onKeyDown&&document.removeEventListener("keydown",d._onKeyDown),e.stopPropagation()};T.addEventListener("click",P),l.__listeners.push(["click",P,T]),A.appendChild(T),v.appendChild(A),b.appendChild(x),b.appendChild(v);let G=!1,D=null;b.addEventListener("click",e=>{if(G=!G,b.style.transform=G?"rotateY(180deg)":"",G?b.classList.add("flip-open"):b.classList.remove("flip-open"),e.stopPropagation(),G){if(u&&u!==b)try{u.classList.remove("flip-open"),u.style.transform="",u._flipped=!1}catch(e){}b.classList.add("flip-open"),b._flipped=!0,u=b,D=function(e){b.contains(e.target)||(G=!1,b.style.transform="",b.classList.remove("flip-open"),b._flipped=!1,u===b&&(u=null),document.removeEventListener("mousedown",D,!0))},document.addEventListener("mousedown",D,!0)}else b.classList.remove("flip-open"),b._flipped=!1,u===b&&(u=null),D&&(document.removeEventListener("mousedown",D,!0),D=null)}),d.addEventListener("mouseenter",()=>{let e=0,t=null;window.__hoveredSkinCtx={circle:d},d._onKeyDown=function(n){if(t&&!L(n,S("Apply skin"))&&(clearTimeout(t),t=null,e=0),L(n,S("Open skin page")))return"function"==typeof n.preventDefault&&n.preventDefault(),"function"==typeof n.stopPropagation&&n.stopPropagation(),"function"==typeof n.stopImmediatePropagation&&n.stopImmediatePropagation(),void window.open(`https://skins.gota.io/skins/${a.uuid}`);if(L(n,S("Apply skin")))return"function"==typeof n.preventDefault&&n.preventDefault(),"function"==typeof n.stopPropagation&&n.stopPropagation(),"function"==typeof n.stopImmediatePropagation&&n.stopImmediatePropagation(),e++,t&&clearTimeout(t),void(t=setTimeout(()=>{const n=Math.max(e||1,1);Yt(a.name,n),e=0,t=null},300));if(L(n,S("Toggle favorite"))){if("function"==typeof n.preventDefault&&n.preventDefault(),"function"==typeof n.stopPropagation&&n.stopPropagation(),"function"==typeof n.stopImmediatePropagation&&n.stopImmediatePropagation(),n.repeat)return;if(a.favorite=!a.favorite,xe(),d.classList.toggle("favorite",a.favorite),a.favorite)try{const e=re().favBadgeStyle||"heart";d.style.setProperty("--ring-color","star"===e?"#ffd600":"#ff0000")}catch(e){d.style.setProperty("--ring-color","#ff0000")}else d.style.removeProperty("--ring-color");N();let e=x.querySelector(".favorite-heart"),t=x.querySelector(".favorite-star");if(a.favorite)try{const n=re();"star"===(n.favBadgeStyle||"heart")?(e&&e.remove(),t||(t=document.createElement("span"),t.className="favorite-star",t.innerHTML=pe,x.appendChild(t))):(t&&t.remove(),e||(e=document.createElement("span"),e.className="favorite-heart",e.innerHTML=de,x.appendChild(e)))}catch(t){e||(e=document.createElement("span"),e.className="favorite-heart",e.innerHTML=de,x.appendChild(e))}else e&&e.remove(),t&&t.remove();return $t(a.favorite?"Added to favorites!":"Removed from favorites!",a.favorite?"green":"red"),void(Ct&&Ht())}if(L(n,S("Delete skin"))){"function"==typeof n.preventDefault&&n.preventDefault(),"function"==typeof n.stopPropagation&&n.stopPropagation(),"function"==typeof n.stopImmediatePropagation&&n.stopImmediatePropagation();const e=fe[s].skins,t=e.findIndex(e=>e.name===a.name&&e.uuid===a.uuid);if(-1!==t){Ot={...e[t]},qt=s,jt=t,e.splice(t,1),xe(),Ie();const n=z.querySelector(`.skin-slot[data-uuid="${a.uuid}"]`);n&&(H(n),n.__listeners=null,n.remove()),f&&f.delete(a.uuid),m&&m.delete(a.uuid),Array.isArray(y)&&(y=y.filter(e=>e!==a.uuid)),Ht(),"function"==typeof d._mouseleaveHandler&&d._mouseleaveHandler(),D&&(document.removeEventListener("mousedown",D,!0),D=null),void 0!==u&&u===b&&(u=null),$t("Skin deleted!","red",function(){Ot&&fe[qt]&&(fe[qt].skins.splice(jt,0,Ot),xe(),Ie(),st++,Ft(),$t("Skin restored!","green"),Ot=null,qt=null,jt=null)})}return}},d._mouseleaveHandler=function(){d._onKeyDown=null,d.removeEventListener("mouseleave",d._mouseleaveHandler),d._mouseleaveHandler=null,window.__hoveredSkinCtx&&window.__hoveredSkinCtx.circle===d&&(window.__hoveredSkinCtx=null)},d.addEventListener("mouseleave",d._mouseleaveHandler)}),d.innerHTML="",d.appendChild(b);try{l.addEventListener("focus",()=>{try{d.dispatchEvent(new Event("mouseenter"))}catch(e){}}),l.addEventListener("blur",()=>{try{d._mouseleaveHandler&&d._mouseleaveHandler()}catch(e){}})}catch(e){}}if(z.appendChild(i),y=e.map(e=>e.uuid).filter(Boolean),window.__skinGlobalKeydown||(window.__skinGlobalKeydown=!0,document.addEventListener("keydown",e=>{const t=document.activeElement;if(t&&("INPUT"===t.tagName||"TEXTAREA"===t.tagName||"SELECT"===t.tagName||t.isContentEditable))return;const n=window.__hoveredSkinCtx;if(n&&n.circle&&n.circle._onKeyDown)try{n.circle._onKeyDown(e)}catch(e){}})),void 0!==d&&(d.init(R),d.observe(z)),void 0!==c&&c.init(z),zt("none"!==D.style.display),Ht(),z.__kbdNav||(z.__kbdNav=!0,z.addEventListener("keydown",e=>{if(!["ArrowLeft","ArrowRight","ArrowUp","ArrowDown","Home","End","PageUp","PageDown"].includes(e.key))return;const t=document.activeElement;if(t&&("INPUT"===t.tagName||"TEXTAREA"===t.tagName||t.isContentEditable))return;const n=e.target&&e.target.closest?e.target.closest(".skin-slot"):null;if(!n||!z.contains(n))return;e.preventDefault(),e.stopPropagation();const o=parseInt(n.getAttribute("data-index")||"-1",10);if(Number.isNaN(o)||o<0)return;const r=n.getBoundingClientRect(),i=getComputedStyle(z),a=parseFloat(i.columnGap)||0,l=parseFloat(i.rowGap)||0,s=r.width+a,c=Math.max(1,Math.round((z.clientWidth+a)/s)),d=z.children.length;let p=o;const u=Math.max(1,Math.floor((R.clientHeight+l)/(r.height+l))-1);switch(e.key){case"ArrowLeft":p=Math.max(0,o-1);break;case"ArrowRight":p=Math.min(d-1,o+1);break;case"ArrowUp":p=Math.max(0,o-c);break;case"ArrowDown":p=Math.min(d-1,o+c);break;case"Home":p=0;break;case"End":p=d-1;break;case"PageUp":p=Math.max(0,o-c*u);break;case"PageDown":p=Math.min(d-1,o+c*u)}if(p===o)return;const f=z.querySelector(`.skin-slot[data-index="${p}"]`);if(f&&f.focus){f.focus({preventScroll:!1});try{f.scrollIntoView({block:"nearest"})}catch(e){}}})),!document.getElementById("skin-dnd-style")){const e=document.createElement("style");e.id="skin-dnd-style",e.textContent="#skinBox .circle-grid{position:relative}#skinBox .skin-slot{transition:transform .18s ease;}#skinBox .skin-slot.dnd-arming{transform:scale(.97);opacity:.92;}#skinBox .skin-slot.dnd-dragging{z-index:1000;pointer-events:none;transition:none;filter:drop-shadow(0 4px 10px rgba(0,0,0,.25));}",document.head.appendChild(e)}!function(){if(z.__delegatedDrag)return;z.__delegatedDrag=!0;let e=null,t=!1,n=!1,o=0,r=0,i=null,a=!1,l=-1,s=null,c=null;const d={x:0,y:0};let p=null,u=[],f=null,y=null,m=null,g=0,h=0,b=0,x=null;function v(){try{return!pt.value.trim()&&!ft}catch(e){return!0}}function w(){u=Array.from(z.children,e=>{const t=e.getBoundingClientRect();return{el:e,cx:t.left+t.width/2,cy:t.top+t.height/2}})}let k=!1,C=null;function E(e,t){C={el:e,tx:t},k||(k=!0,requestAnimationFrame(()=>{k=!1;const e=C;if(C=null,e&&e.el)try{e.el.style.transform=e.tx}catch(e){}}))}function _(e){if(i){try{null!=x&&i&&i.releasePointerCapture&&i.releasePointerCapture(x)}catch(e){}i.classList.remove("dnd-dragging");try{i.style.willChange="",i.style.transform=""}catch(e){}C=null;try{i.style.position="",i.style.left="",i.style.top="",i.style.width="",i.style.height=""}catch(e){}if(null!=e&&i&&-1!==l&&e!==l&&v()){const t=fe[ye].skins,n=lt&&null!=lt[l]?lt[l]:l,o=lt&&null!=lt[e]?lt[e]:e;if(o>=0&&o<t.length&&n>=0&&n<t.length){const r=t[n];t[n]=t[o],t[o]=r,st++,c&&clearTimeout(c),c=setTimeout(()=>{xe(),c=null},60);const a=i,s=z.querySelector(`.skin-slot[data-index="${e}"]`);if(a&&s&&(z.insertBefore(a,s),f&&f.parentNode===z&&z.insertBefore(s,f),a.setAttribute("data-index",String(e)),s.setAttribute("data-index",String(l)),lt&&lt.length)){const t=lt[l];lt[l]=lt[e],lt[e]=t;try{a.setAttribute("data-real-index",lt[e])}catch(e){}try{s.setAttribute("data-real-index",lt[l])}catch(e){}}f&&f.parentNode===z&&z.removeChild(f),f=null}}f&&f.parentNode===z&&(z.removeChild(f),f=null),document.removeEventListener("pointermove",S),document.removeEventListener("pointerup",A,!0),document.removeEventListener("pointercancel",A,!0);try{R.removeEventListener("scroll",L,{passive:!0})}catch(e){R.removeEventListener("scroll",L)}try{Array.from(z.children).forEach(e=>{e.__origTransition&&(e.style.transition=e.__origTransition,delete e.__origTransition),e.classList&&e.classList.remove("dnd-arming")})}catch(e){}i=null,l=-1,n=!1,t=!1,a=!1,s=null,x=null,m&&(window.removeEventListener("click",m,!0),m=null)}}function S(e){if(!i)return;h=e.clientX,b=e.clientY;const t=R.getBoundingClientRect();b<t.top+40?R.scrollTop+=Math.max(-24,.5*(b-(t.top+40))):b>t.bottom-40&&(R.scrollTop+=Math.min(24,.5*(b-(t.bottom-40))));const n=h-d.x,o=R.scrollTop-g,r=b-d.y+o,a=n-p.left,l=r-p.top;(!i.__lastTx||Math.abs(i.__lastTx.x-a)>.75||Math.abs(i.__lastTx.y-l)>.75)&&(i.__lastTx={x:a,y:l},E(i,`translate3d(${a}px, ${l}px,0) scale(1.07)`))}function L(){if(!i)return;const e=h-d.x,t=R.scrollTop-g,n=b-d.y+t;E(i,`translate3d(${e-p.left}px, ${n-p.top}px,0) scale(1.07)`)}function A(e){if(!i)return;e.preventDefault(),e.stopPropagation();const t=e.clientX-o,n=e.clientY-r;if(Math.hypot(t,n)<8)return void _(l);_(function(e,t){const n=document.elementFromPoint(e,t);if(n&&n.closest){const e=n.closest(".skin-slot");if(e&&z.contains(e)){if(e.classList&&e.classList.contains("dnd-placeholder"))return l;const t=parseInt(e.getAttribute("data-index")||"-1",10);if(!Number.isNaN(t))return t}}u&&0!==u.length||w();let o=null,r=1/0;for(let n=0;n<u.length;n++){const a=u[n];if(!a||!a.el||a.el===i||a.el.classList&&a.el.classList.contains("dnd-placeholder"))continue;const l=e-a.cx,s=t-a.cy,c=l*l+s*s;c<r&&(r=c,o=a.el)}if(o){const e=parseInt(o.getAttribute("data-index")||"-1",10);if(!Number.isNaN(e))return e}return-1}(e.clientX,e.clientY))}z.addEventListener("pointerdown",c=>{if(0!==c.button)return;if(!v())return;const u=c.target&&c.target.closest?c.target.closest(".skin-slot"):null;u&&z.contains(u)&&(t=!0,n=!1,o=c.clientX,r=c.clientY,s=u,u.classList.add("dnd-arming"),x=c.pointerId,e=setTimeout(()=>{if(!t)return;n=!0,a=!0,i=u,l=parseInt(u.getAttribute("data-index")||"-1",10),p=u.getBoundingClientRect(),d.x=o-p.left,d.y=r-p.top,u.classList.remove("dnd-arming"),u.classList.add("dnd-dragging");try{Array.from(z.children).forEach(e=>{e!==u&&(e.__origTransition||(e.__origTransition=e.style.transition),e.style.transition="none")})}catch(e){}try{u.style.willChange="transform"}catch(e){}f=document.createElement("div"),f.className="skin-slot dnd-placeholder",f.style.visibility="hidden",f.style.height=p.height+"px";try{f.setAttribute("data-index",String(l))}catch(e){}z.insertBefore(f,u),y=z.getBoundingClientRect();const e=p.left-y.left,s=p.top-y.top;u.style.position="absolute",u.style.left=e+"px",u.style.top=s+"px",u.style.width=p.width+"px",u.style.height=p.height+"px",g=R.scrollTop,w();try{u.setPointerCapture&&u.setPointerCapture(x)}catch(e){}document.addEventListener("pointermove",S),document.addEventListener("pointerup",A,!0),document.addEventListener("pointercancel",A,!0);try{R.addEventListener("scroll",L,{passive:!0})}catch(e){R.addEventListener("scroll",L)}m=function(e){e.preventDefault(),e.stopPropagation(),e.stopImmediatePropagation&&e.stopImmediatePropagation(),window.removeEventListener("click",m,!0),m=null},window.addEventListener("click",m,!0)},180))}),z.addEventListener("pointermove",c=>{if(!t||n)return;const u=c.clientX-o,h=c.clientY-r;if(Math.hypot(u,h)>7&&s){e&&(clearTimeout(e),e=null);const t=s;n=!0,a=!0,i=t,l=parseInt(t.getAttribute("data-index")||"-1",10),p=t.getBoundingClientRect(),d.x=o-p.left,d.y=r-p.top,t.classList.remove("dnd-arming"),t.classList.add("dnd-dragging");try{Array.from(z.children).forEach(e=>{e!==t&&(e.__origTransition||(e.__origTransition=e.style.transition),e.style.transition="none")})}catch(e){}try{t.style.willChange="transform"}catch(e){}f=document.createElement("div"),f.className="skin-slot dnd-placeholder",f.style.visibility="hidden",f.style.height=p.height+"px";try{f.setAttribute("data-index",String(l))}catch(e){}z.insertBefore(f,t),y=z.getBoundingClientRect();const c=p.left-y.left,u=p.top-y.top;t.style.position="absolute",t.style.left=c+"px",t.style.top=u+"px",t.style.width=p.width+"px",t.style.height=p.height+"px",g=R.scrollTop,w();try{t.setPointerCapture&&t.setPointerCapture(x)}catch(e){}document.addEventListener("pointermove",S),document.addEventListener("pointerup",A,!0),document.addEventListener("pointercancel",A,!0);try{R.addEventListener("scroll",L,{passive:!0})}catch(e){R.addEventListener("scroll",L)}return m=function(e){e.preventDefault(),e.stopPropagation(),e.stopImmediatePropagation&&e.stopImmediatePropagation(),window.removeEventListener("click",m,!0),m=null},void window.addEventListener("click",m,!0)}(Math.abs(u)>4||Math.abs(h)>4)&&(e&&(clearTimeout(e),e=null),s&&s.classList.remove("dnd-arming"),t=!1,n=!1,s=null)}),z.addEventListener("pointerup",()=>{n||(e&&(clearTimeout(e),e=null),s&&s.classList.remove("dnd-arming"),t=!1,s=null)}),z.addEventListener("pointerleave",()=>{n||(e&&(clearTimeout(e),e=null),s&&s.classList.remove("dnd-arming"),t=!1,s=null)})}()}!function(){if(Ft.__wrapped)return;const e=Ft;let t=!1;function n(...n){t||(t=!0,requestAnimationFrame(()=>{try{e.apply(this,n)}finally{t=!1}}))}n.__wrapped=!0,Object.defineProperty(n,"name",{value:"renderSkinsCoalesced"}),Ft=n}();let Ot=null,qt=null,jt=null,Ut=null;const Vt=document.createElement("div");function $t(e,t="green",n=null){Vt.innerHTML="",Vt.style.display="block",Vt.style.background="red"===t?"rgba(200,40,40,0.97)":"rgba(40,180,80,0.97)";const o=document.createElement("span");if(o.textContent=e,Vt.appendChild(o),n){const e=document.createElement("button");e.textContent="Undo",e.style.marginLeft="18px",e.style.background="#fff",e.style.color="#222",e.style.border="none",e.style.borderRadius="6px",e.style.padding="4px 16px",e.style.fontWeight="bold",e.style.cursor="pointer",e.addEventListener("click",()=>{Ut&&clearTimeout(Ut),Vt.style.display="none",n()}),Vt.appendChild(e),Ut=setTimeout(()=>{Vt.style.display="none"},4e3)}else setTimeout(()=>{Vt.style.display="none"},1200)}Vt.style.position="fixed",Vt.style.top="30px",Vt.style.left="50%",Vt.style.transform="translateX(-50%)",Vt.style.background="rgba(40,180,80,0.97)",Vt.style.color="white",Vt.style.padding="10px 24px",Vt.style.borderRadius="8px",Vt.style.fontSize="16px",Vt.style.fontWeight="bold",Vt.style.boxShadow="0 2px 8px rgba(0,0,0,0.2)",Vt.style.zIndex="10010",Vt.style.display="none",document.body.appendChild(Vt);const Wt=function(){if(window.__GalleryApplyTabId)return window.__GalleryApplyTabId;const e=Math.random().toString(36).slice(2)+Date.now().toString(36);return window.__GalleryApplyTabId=e,e}();function Yt(e,t,n){const o="string"==typeof e?e.trim():"";if(!o)return{appliedPrimary:!1,appliedSecondary:!1};const r=n||{},i=document.querySelector("input#name-box.gota-input"),a=document.querySelector("input#name-box-2.gota-input"),l=e=>{r.suppressNotification||$t(e)},s=e=>{if(!e)return!1;try{return e.value=o,e.dispatchEvent(new Event("input",{bubbles:!0})),!0}catch(e){return!1}},c=Math.max(Number(t)||1,1),d="boolean"==typeof r.broadcast?r.broadcast:2===c,p=window.__Gallery&&"function"==typeof window.__Gallery.__broadcastApply?window.__Gallery.__broadcastApply:null;let u=!1,f=!1;return 1===c?(u=s(i),u&&l(`Set name (input 1) to: ${o}`)):2===c?!d&&a?(f=s(a),f&&l(`Set name (input 2) to: ${o}`)):d&&p?(p({type:"GALLERY_REMOTE_APPLY",name:o,pressCount:c,sourceId:Wt}),l(`Sent name to second tab: ${o}`)):(u=s(i),u&&l(`Set name (input 2 fallback to 1) to: ${o}`)):(u=s(i),f=s(a),(u||f)&&(u&&f?l(`Set both inputs to: ${o}`):u?l(`Set input 1 (no input 2) to: ${o}`):f&&l(`Set input 2 (no input 1) to: ${o}`))),1===c&&r.broadcastSingle&&p&&p({type:"GALLERY_REMOTE_APPLY",name:o,pressCount:c,sourceId:Wt}),{appliedPrimary:u,appliedSecondary:f}}function Kt(e,t){const n=Object.assign({timeoutMs:15e3},t||{});return new Promise((t,o)=>{let r=!1;const i=document.createElement("iframe");i.src="https://skins.gota.io/explore",i.style.position="fixed",i.style.width="1px",i.style.height="1px",i.style.opacity="0",i.style.pointerEvents="none",i.style.left="-9999px",i.style.top="-9999px";const a=()=>{window.removeEventListener("message",d);try{i&&i.parentNode&&i.parentNode.removeChild(i)}catch(e){}try{clearInterval(s)}catch(e){}},l=setTimeout(()=>{r||(r=!0,a(),o(new Error("Timed out searching for UUID")))},n.timeoutMs),s=setInterval(()=>{!r&&window.__galleryCancel&&(r=!0,clearTimeout(l),a(),clearInterval(s),o(new Error("aborted")))},100),c=String(e||"").trim().toLowerCase(),d=n=>{const s=n&&n.data;if(s&&"object"==typeof s)if("GALLERY_IFRAME_READY"!==s.type){if("GALLERY_FIND_UUID_RESULT"===s.type){if(String(s.name||"").toLowerCase()!==c)return;if(r)return;r=!0,clearTimeout(l),a(),s.ok&&s.uuid?t({uuid:s.uuid}):o(new Error(s.error||"UUID not found"))}}else try{i.contentWindow.postMessage({type:"GALLERY_FIND_UUID",name:e},"*")}catch(e){}};window.addEventListener("message",d),i.onload=()=>{try{i.contentWindow.postMessage({type:"GALLERY_IFRAME_PING"},"*"),i.contentWindow.postMessage({type:"GALLERY_FIND_UUID",name:e},"*")}catch(e){}},document.body.appendChild(i)})}function Jt(e,t){const n=Object.assign({timeoutMs:2e4},t||{});return new Promise((t,o)=>{let r=!1;const i=window.open("https://skins.gota.io/explore","gallerySkinLookup","width=980,height=760,menubar=no,toolbar=no,location=yes,status=no,scrollbars=yes,resizable=yes");if(!i)return void o(new Error("Popup blocked"));const a=()=>{window.removeEventListener("message",d);try{i&&!i.closed&&i.close()}catch(e){}try{clearInterval(s)}catch(e){}},l=setTimeout(()=>{r||(r=!0,a(),o(new Error("Timed out searching for UUID (popup)")))},n.timeoutMs),s=setInterval(()=>{!r&&window.__galleryCancel&&(r=!0,clearTimeout(l),a(),clearInterval(s),o(new Error("aborted")))},100),c=String(e||"").trim().toLowerCase(),d=n=>{const s=n&&n.data;if(s&&"object"==typeof s)if("GALLERY_IFRAME_READY"!==s.type){if("GALLERY_FIND_UUID_RESULT"===s.type){if(String(s.name||"").toLowerCase()!==c)return;if(r)return;r=!0,clearTimeout(l),a(),s.ok&&s.uuid?t({uuid:s.uuid}):o(new Error(s.error||"UUID not found (popup)"))}}else try{i.postMessage({type:"GALLERY_FIND_UUID",name:e},"*")}catch(e){}};window.addEventListener("message",d),setTimeout(()=>{try{i.postMessage({type:"GALLERY_IFRAME_PING"},"*")}catch(e){}},500)})}!function(){let e=null;function t(){if(!e&&"undefined"!=typeof BroadcastChannel)try{e=new BroadcastChannel("gotaio_skin_apply")}catch(t){e=null}return e}window.__Gallery=window.__Gallery||{},window.__Gallery.__broadcastApply=function(e){const n=t();if(n)try{n.postMessage(e)}catch(e){}},window.__Gallery.__ensureApplyChannel=t,window.__Gallery.__applyTabId=Wt}(),function(){try{if(location&&"skins.gota.io"===location.hostname){const e=(e,t=1e4,n=150)=>new Promise((o,r)=>{const i=Date.now();!function a(){try{const t=e();if(t)return o(t)}catch(e){}if(Date.now()-i>=t)return r(new Error("timeout"));setTimeout(a,n)}()}),t=()=>document.querySelector("#flop_filters_0_value")||document.querySelector('input[name="filters[0][value]"]')||Array.from(document.querySelectorAll("input[placeholder]")).find(e=>/search\s*skins/i.test(e.getAttribute("placeholder")||""));try{const e=[];window.opener&&e.push(window.opener),window.parent&&window.parent!==window&&e.push(window.parent);for(const t of e)try{t.postMessage({type:"GALLERY_IFRAME_READY"},"*")}catch(e){}}catch(e){}window.addEventListener("message",async n=>{const o=n&&n.data;if(o&&"object"==typeof o)if("GALLERY_IFRAME_PING"!==o.type){if("GALLERY_FIND_UUID"===o.type){const n=o&&o.name;let r=null,i=null;try{r=await async function(n){const o=String(n||"").trim();if(!o)return null;await e(()=>"complete"===document.readyState,2e4,100).catch(()=>{});let r=!1,i=null;const a=await e(t,8e3).catch(()=>null);if(!a)return null;try{a.focus(),a.value=o,a.dispatchEvent(new Event("input",{bubbles:!0})),a.dispatchEvent(new Event("change",{bubbles:!0})),await new Promise(e=>setTimeout(e,80));const e={key:"Enter",code:"Enter",keyCode:13,which:13,bubbles:!0};a.dispatchEvent(new KeyboardEvent("keydown",e)),a.dispatchEvent(new KeyboardEvent("keypress",e)),a.dispatchEvent(new KeyboardEvent("keyup",e));const t=a.closest&&a.closest("form");if(t)try{t.requestSubmit?t.requestSubmit():t.submit()}catch(e){}i=setTimeout(()=>{if(!r)try{a.focus();const e={key:"Enter",code:"Enter",keyCode:13,which:13,bubbles:!0};a.dispatchEvent(new KeyboardEvent("keydown",e)),a.dispatchEvent(new KeyboardEvent("keypress",e)),a.dispatchEvent(new KeyboardEvent("keyup",e));const t=a.closest&&a.closest("form");if(t)try{t.requestSubmit?t.requestSubmit():t.submit()}catch(e){}}catch(e){}},500)}catch(e){}const l=()=>{const e=Array.from(document.querySelectorAll('a[href^="/skins/"]'));return Array.from(new Set(e.map(e=>e.closest?e.closest("li"):null).filter(Boolean)))},s=e=>{for(const t of e){const e=t.querySelector("span");if(String(e&&e.textContent?e.textContent:"").trim()===o)return t}const t=o.toLowerCase();for(const n of e){const e=n.querySelector("span");if(String(e&&e.textContent?e.textContent:"").trim().toLowerCase()===t)return n}return null};let c=l(),d=s(c);if(d){const e=d.querySelector('a[href^="/skins/"]');if(!e)return null;const t=(e.getAttribute("href")||"").match(/[0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{12}/);try{i&&(clearTimeout(i),i=null)}catch(e){}return r=!0,t?t[0]:null}return await new Promise(e=>{const t=t=>{try{o.disconnect()}catch(e){}clearTimeout(a);try{i&&(clearTimeout(i),i=null)}catch(e){}r=!0,e(t)},n=()=>{const e=l(),n=s(e);if(n){const e=n.querySelector('a[href^="/skins/"]');if(!e)return t(null);const o=(e.getAttribute("href")||"").match(/[0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{12}/);return t(o?o[0]:null)}},o=new MutationObserver(n);try{o.observe(document.body,{childList:!0,subtree:!0})}catch(e){}const a=setTimeout(()=>t(null),2e4);n()})}(n)}catch(e){i=String(e&&e.message?e.message:e||"error")}try{const e=[];window.opener&&e.push(window.opener),window.parent&&window.parent!==window&&e.push(window.parent);for(const t of e)try{t.postMessage({type:"GALLERY_FIND_UUID_RESULT",ok:!!r,name:String(n||""),uuid:r||null,error:r?null:i||"not_found"},"*")}catch(e){}}catch(e){}}}else try{const e=[];window.opener&&e.push(window.opener),window.parent&&window.parent!==window&&e.push(window.parent);for(const t of e)try{t.postMessage({type:"GALLERY_IFRAME_READY"},"*")}catch(e){}}catch(e){}})}}catch(e){}}(),Z.addEventListener("click",async()=>{if("Searching…"===Z.textContent)return window.__galleryCancel=!0,void(Z.textContent=Z.__prevTxt||"Add to Gallery");const e=Q.value.trim();if(!e)return;const t=e.includes("|");let n=e,o=null;if(t){const t=e.split("|").map(e=>e.trim());if(n=t[0]||"",o=t[1]||"",!n||!o)return void En({title:"Invalid Format",message:"Please enter as: Skin Name | UUID (or full skins URL)",confirmText:"OK",cancelText:null,onConfirm:()=>{}})}if((fe[ye].skins||[]).some(e=>e.name.toLowerCase()===n.toLowerCase()))En({title:"Duplicate Skin Name",message:"A skin with this name already exists in this profile!",confirmText:"OK",cancelText:null,onConfirm:()=>{}});else{if(!t){const e=Z.textContent;Z.__prevTxt=e,window.__galleryCancel=!1,Z.textContent="Searching…";try{let e=null;try{const t=await Jt(n);e=t&&t.uuid}catch(t){if(t&&"aborted"===String(t.message||t))throw t;const o=await Kt(n);e=o&&o.uuid}if(!e)throw new Error("UUID not found");o=e}catch(t){if(Z.textContent=e,t&&"aborted"===String(t.message||t))return;return void En({title:"Skin Not Found",message:"Couldn't find a UUID for that name on skins.gota.io. Try refining the name or paste a UUID/URL.",confirmText:"OK",cancelText:null,onConfirm:()=>{}})}Z.textContent=e}if(o){const e=String(o).match(/[0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{12}/);o=e?e[0].trim():String(o).trim()}o?(fe[ye].skins.push({name:n,uuid:o}),xe(),Ie(),Q.value="",st++,Ft(),$t("Skin added successfully!")):En({title:"Missing UUID",message:"Couldn't resolve a UUID. Please try again or use the 'Name | UUID' format.",confirmText:"OK",cancelText:null,onConfirm:()=>{}})}});const Xt="gotaio_gallery_position";function Qt(e,t){localStorage.setItem(Xt,JSON.stringify({left:e,top:t,width:D.offsetWidth,height:D.offsetHeight}))}!async function(){await me(),await ve(),Ie(),Ft(),ko()}();const Zt=document.createElement("div");Zt.style.position="absolute",Zt.style.top="0",Zt.style.left="0",Zt.style.width="100%",Zt.style.height="100%",Zt.style.zIndex="10005",Zt.style.pointerEvents="none",Zt.style.border="2px solid transparent",Zt.style.borderRadius="12px",D.appendChild(Zt);let en,tn,nn,on,rn=!1;D.addEventListener("mousedown",e=>{const t=D.getBoundingClientRect();(e.clientX-t.left<10||t.right-e.clientX<10||e.clientY-t.top<10||t.bottom-e.clientY<10)&&(rn=!0,en=e.clientX,tn=e.clientY,nn=D.offsetLeft,on=D.offsetTop,Zt.style.border="2px solid #4caf50",document.body.style.userSelect="none",e.preventDefault())}),document.addEventListener("mousemove",e=>{if(!rn)return;const t=e.clientX-en,n=e.clientY-tn;D.style.left=`${nn+t}px`,D.style.top=`${on+n}px`}),document.addEventListener("mouseup",()=>{if(rn){rn=!1,Zt.style.border="2px solid transparent",document.body.style.userSelect="",Qt(D.offsetLeft,D.offsetTop);try{wn()}catch(e){}}}),D.addEventListener("mousemove",e=>{const t=D.getBoundingClientRect(),n=e.clientX-t.left<10||t.right-e.clientX<10||e.clientY-t.top<10||t.bottom-e.clientY<10;D.style.cursor=n?"move":""}),D.addEventListener("mouseleave",()=>{D.style.cursor=""}),function(){const e=localStorage.getItem(Xt);if(e)try{const{left:t,top:n,width:o,height:r}=JSON.parse(e);D.style.width=void 0!==o?o+"px":"600px",D.style.height=void 0!==r?r+"px":"400px",void 0!==t&&(D.style.left=t+"px"),void 0!==n&&(D.style.top=n+"px")}catch(e){}else D.style.width="600px",D.style.height="400px",requestAnimationFrame(()=>{requestAnimationFrame(()=>{const e=yo();D.style.left=e.left+"px",D.style.top=e.top+"px",setTimeout(()=>{try{const e=yo();D.style.left=e.left+"px",D.style.top=e.top+"px"}catch(e){}},300)})})}();try{wn()}catch(Ko){}let an=!1;function ln(){const e=document.getElementById("main"),t=e?window.getComputedStyle(e):null,n=e&&"none"!==t.display&&"1"===t.opacity,o=an&&n;if(D.style.display=o?"":"none",zt(o),!o){try{if(window.__hoveredSkinCtx&&window.__hoveredSkinCtx.circle){const e=window.__hoveredSkinCtx.circle;"function"==typeof e._mouseleaveHandler&&e._mouseleaveHandler()}}catch(e){}window.__hoveredSkinCtx=null}try{wn()}catch(e){}}function sn(e,t){const n=t&&t.silent,o=!!e;if(an!==o&&(an=o,ln(),!n))try{window.__MirrorSync&&"function"==typeof window.__MirrorSync.galleryVisibilityChanged&&window.__MirrorSync.galleryVisibilityChanged(an)}catch(e){}}function cn(){const e=document.getElementById("account-profile");if(e&&!document.getElementById("account-gallery")){const t=document.createElement("button");t.id="account-gallery",t.className=e.className,t.textContent="Gallery",t.style.cssText=e.style.cssText,t.addEventListener("click",function(){sn(!an)}),e.parentNode.insertBefore(t,e)}const t=document.getElementById("account-login");if(t&&!document.getElementById("account-gallery-login")){const e=document.createElement("button");e.id="account-gallery-login",e.className=t.className,e.textContent="Gallery",e.style.cssText=t.style.cssText,e.addEventListener("click",function(){sn(!an)}),t.parentNode.insertBefore(e,t.nextSibling)}}!function(){const e="undefined"!=typeof unsafeWindow?unsafeWindow:window;if(e.__Gallery=e.__Gallery||{},window.__Gallery&&window.__Gallery!==e.__Gallery)try{Object.assign(e.__Gallery,window.__Gallery)}catch(e){}window.__Gallery=e.__Gallery,e.__Gallery.setOpen=function(e,t){sn(e,t)},e.__Gallery.isOpen=function(){return!!an}}(),cn(),ln();const dn=new MutationObserver(()=>ln());function pn(){const e=document.getElementById("main");if(e){try{dn.disconnect()}catch(e){}dn.observe(e,{attributes:!0,attributeFilter:["style","class"]})}}b(()=>{try{dn.disconnect()}catch(e){}}),pn();const un=new MutationObserver(e=>{let t=!1,n=!1;for(const o of e)o.addedNodes&&o.addedNodes.forEach(e=>{if(1===e.nodeType){const o=e.querySelector?e.querySelector.bind(e):null;("account-profile"===e.id||"account-login"===e.id||o&&o("#account-profile, #account-login"))&&(t=!0),("main"===e.id||o&&o("#main"))&&(n=!0)}});t&&cn(),n&&(pn(),ln())});try{un.observe(document.body,{childList:!0,subtree:!0})}catch(Jo){}b(()=>{try{un.disconnect()}catch(e){}}),window.addEventListener("resize",()=>{ln();try{wn()}catch(e){}},{passive:!0}),document.addEventListener("visibilitychange",()=>ln());const fn=document.createElement("div");fn.className="resize-handle",D.appendChild(fn);let yn,mn,gn,hn,bn=!1;fn.addEventListener("mousedown",e=>{bn=!0,yn=e.clientX,mn=e.clientY,gn=D.offsetWidth,hn=D.offsetHeight,document.body.style.userSelect="none",e.stopPropagation()}),document.addEventListener("mousemove",e=>{if(!bn)return;let t=Math.max(320,Math.min(window.innerWidth-D.offsetLeft-10,gn+(e.clientX-yn))),n=Math.max(200,Math.min(window.innerHeight-D.offsetTop-10,hn+(e.clientY-mn)));D.style.width=t+"px",D.style.height=n+"px",Qt(D.offsetLeft,D.offsetTop)}),document.addEventListener("mouseup",()=>{if(bn){bn=!1,document.body.style.userSelect="",Qt(D.offsetLeft,D.offsetTop);try{wn()}catch(e){}}});const xn=["#fff","#000","#4f46e5","#10b981","#14b8a6","#38bdf8","#f472b6"];let vn=0;try{const Xo=Se();if(Xo){const Qo=xn.indexOf(String(Xo).toLowerCase());Qo>=0&&(vn=Qo);try{D.style.setProperty("--ring-color",Xo)}catch(Zo){}}}catch(er){}if(window.addEventListener("keydown",function(e){const t=document.activeElement;if(t&&("INPUT"===t.tagName||"TEXTAREA"===t.tagName||t.isContentEditable||t.closest&&(t.closest("input")||t.closest("textarea")||t.closest('[contenteditable="true"]'))))return;const n=an&&D&&null!==D.offsetParent&&"none"!==D.style.display,o=n&&window.__hoveredSkinCtx&&window.__hoveredSkinCtx.circle&&"function"==typeof window.__hoveredSkinCtx.circle._onKeyDown?window.__hoveredSkinCtx:null,r=o&&o.circle&&o.circle.closest?o.circle.closest(".skin-slot"):null,i=S("Toggle gallery"),a=S("Add to random list"),l=S("Add skin"),s=S("Ring Color"),c=S("Reset gallery position"),d=S("Open skin page"),p=S("Apply skin");if(L(e,i))return"function"==typeof e.preventDefault&&e.preventDefault(),"function"==typeof e.stopPropagation&&e.stopPropagation(),"function"==typeof e.stopImmediatePropagation&&e.stopImmediatePropagation(),void sn(!an);if(L(e,a)){if(!n)return;const t=document.querySelector(".skin-slot:hover"),o=r||t;if(!o)return;const i=o.querySelector(".skin-name"),a=i?(i.textContent||"").trim():"";if(!a)return;"function"==typeof e.preventDefault&&e.preventDefault(),"function"==typeof e.stopPropagation&&e.stopPropagation(),"function"==typeof e.stopImmediatePropagation&&e.stopImmediatePropagation();let l=[];try{l=JSON.parse(localStorage.getItem("gota-favorite-skins"))||[]}catch(e){}if(!l.includes(a)){l.push(a),localStorage.setItem("gota-favorite-skins",JSON.stringify(l)),window.postMessage({type:"gota-favorite-skins-updated"},"*");const e=document.createElement("div");e.textContent=`Added '${a}' to Random Skin List!`,e.style.position="fixed",e.style.top="40px",e.style.left="50%",e.style.transform="translateX(-50%)",e.style.background="rgba(40,180,80,0.97)",e.style.color="white",e.style.padding="10px 24px",e.style.borderRadius="8px",e.style.fontSize="16px",e.style.fontWeight="bold",e.style.boxShadow="0 2px 8px rgba(0,0,0,0.2)",e.style.zIndex="10010",document.body.appendChild(e),setTimeout(()=>{e.remove()},1200)}return}if(L(e,l)){if(!n)return;return"function"==typeof e.preventDefault&&e.preventDefault(),"function"==typeof e.stopPropagation&&e.stopPropagation(),"function"==typeof e.stopImmediatePropagation&&e.stopImmediatePropagation(),void ne(!0)}if(L(e,s)){if(!n)return;return"function"==typeof e.preventDefault&&e.preventDefault(),"function"==typeof e.stopPropagation&&e.stopPropagation(),"function"==typeof e.stopImmediatePropagation&&e.stopImmediatePropagation(),void function(){if(!D||"none"===D.style.display||null===D.offsetParent)return;vn=(vn+1)%xn.length;const e=xn[vn];try{Le(e)}catch(e){}try{Ae()}catch(e){}}()}if(L(e,c)){if(!n)return;return function(){if(!D||"none"===D.style.display||null===D.offsetParent)return;D.style.width="600px",D.style.height="400px";const e=yo();D.style.left=e.left+"px",D.style.top=e.top+"px",Qt(e.left,e.top),$t("Gallery UI reset to default position!","green")}(),"function"==typeof e.preventDefault&&e.preventDefault(),"function"==typeof e.stopPropagation&&e.stopPropagation(),void("function"==typeof e.stopImmediatePropagation&&e.stopImmediatePropagation())}const u=L(e,d),f=L(e,p);return(u||f)&&o?("function"==typeof e.preventDefault&&e.preventDefault(),"function"==typeof e.stopPropagation&&e.stopPropagation(),void("function"==typeof e.stopImmediatePropagation&&e.stopImmediatePropagation())):void 0}),"skins.gota.io"!==location.hostname&&!window.__galleryApplyMessageBound){window.__galleryApplyMessageBound=!0,window.addEventListener("message",e=>{const t=e&&e.data;if(t&&"object"==typeof t){if("GALLERY_APPLY_SKIN_NAME"===t.type){const e="string"==typeof t.name?t.name.trim():"";if(!e)return;return void Yt(e,Math.max(Number(t.pressCount)||1,1))}if("GALLERY_REMOTE_APPLY"===t.type&&t.name){if(t.sourceId&&t.sourceId===Wt)return;const e=Math.max(Number(t.pressCount)||1,1);Yt(t.name,e,{broadcast:!1,suppressNotification:!0})}}});try{if(window.__Gallery&&"function"==typeof window.__Gallery.__ensureApplyChannel){const tr=window.__Gallery.__ensureApplyChannel();tr&&!window.__galleryApplyChannelBound&&(window.__galleryApplyChannelBound=!0,tr.addEventListener("message",e=>{const t=e&&e.data;if(!t||"object"!=typeof t||"GALLERY_REMOTE_APPLY"!==t.type)return;if(t.sourceId&&t.sourceId===Wt)return;const n="string"==typeof t.name?t.name.trim():"";if(!n)return;Yt(n,Math.max(Number(t.pressCount)||1,1),{broadcast:!1,suppressNotification:!0})}))}}catch(nr){}}function wn(){const e=document.getElementById("hud");if(!e)return;const t=D.getBoundingClientRect(),n=e.getBoundingClientRect();!(t.right<n.left||t.left>n.right||t.bottom<n.top||t.top>n.bottom)?D.classList.add("overlap-warning"):D.classList.remove("overlap-warning")}const kn=document.createElement("div");kn.style.position="fixed",kn.style.top="0",kn.style.left="0",kn.style.width="100vw",kn.style.height="100vh",kn.style.background="rgba(0,0,0,0.35)",kn.style.display="none",kn.style.zIndex="10050",kn.style.justifyContent="center",kn.style.alignItems="center",kn.style.transition="opacity 0.2s";const Cn=document.createElement("div");function En({title:e,message:t,input:n,confirmText:o,cancelText:r,onConfirm:i}){Cn.innerHTML="";const a=document.createElement("div");if(a.textContent=e||"",a.style.fontWeight="bold",a.style.fontSize="18px",a.style.marginBottom="10px",Cn.appendChild(a),t){const e=document.createElement("div");e.innerHTML=t,e.style.marginBottom="16px",e.style.textAlign="center",Cn.appendChild(e)}let l=null;n&&(l=document.createElement("input"),l.type="text",l.style.width="100%",l.style.padding="7px",l.style.marginBottom="16px",l.style.borderRadius="5px",l.style.border="1px solid #888",l.style.fontSize="15px",l.placeholder=n.placeholder||"",n.value&&(l.value=n.value),Cn.appendChild(l),setTimeout(()=>l.focus(),50));const s=document.createElement("div");s.style.display="flex",s.style.gap="12px",s.style.justifyContent="center",Cn.appendChild(s);const c=document.createElement("button");if(c.textContent=o||"OK",o&&o.toLowerCase().includes("delete")?(c.style.background="#d32f2f",c.style.color="white",c.style.border="none",c.style.borderRadius="5px",c.style.padding="7px 18px",c.style.fontSize="15px",c.style.cursor="pointer"):(c.style.background="#4caf50",c.style.color="white",c.style.border="none",c.style.borderRadius="5px",c.style.padding="7px 18px",c.style.fontSize="15px",c.style.cursor="pointer"),s.appendChild(c),r){const e=document.createElement("button");e.textContent=r||"Cancel",o&&o.toLowerCase().includes("delete")?(e.style.background="#4caf50",e.style.color="white"):(e.style.background="#d32f2f",e.style.color="white"),e.style.border="none",e.style.borderRadius="5px",e.style.padding="7px 18px",e.style.fontSize="15px",e.style.cursor="pointer",s.appendChild(e),e.onclick=()=>{kn.style.display="none"}}kn.style.display="flex",c.onclick=()=>{l?i(l.value):i(),kn.style.display="none"}}Cn.style.background="#23272e",Cn.style.color="white",Cn.style.padding="28px 32px 22px 32px",Cn.style.borderRadius="10px",Cn.style.boxShadow="0 4px 24px rgba(0,0,0,0.25)",Cn.style.minWidth="280px",Cn.style.maxWidth="90vw",Cn.style.display="flex",Cn.style.flexDirection="column",Cn.style.alignItems="center",kn.appendChild(Cn),document.body.appendChild(kn);const _n="github.backup.token",Sn="github.backup.owner",Ln="github.backup.repo",An="github.backup.branch",In="github.backup.path",Mn="github.backup.",Tn=["gotaio_profiles_v2","gotaio_last_profile_idx","gotaio.ui.cellSize","gotaio.ui.ringSize","gotaio.ui.prefs","gotaio_gallery_position","gotaio_skin_sort_order","gotaio_theme","gotaio.broken_skins_v1","gotaio_hotkeys","gotaio.sync.prefs","gotaio.sync.last"];function Bn(){return{token:"function"==typeof GM_getValue?GM_getValue(_n):localStorage.getItem(_n)||"",owner:"function"==typeof GM_getValue?GM_getValue(Sn):localStorage.getItem(Sn)||"",repo:"function"==typeof GM_getValue?GM_getValue(Ln):localStorage.getItem(Ln)||"",branch:"function"==typeof GM_getValue?GM_getValue(An):localStorage.getItem(An)||"main",path:"function"==typeof GM_getValue?GM_getValue(In):localStorage.getItem(In)||"gotaio_backup.json"}}function Nn(){"function"==typeof GM_setValue?(GM_setValue(_n,""),GM_setValue(Sn,""),GM_setValue(Ln,""),GM_setValue(An,""),GM_setValue(In,"")):(localStorage.removeItem(_n),localStorage.removeItem(Sn),localStorage.removeItem(Ln),localStorage.removeItem(An),localStorage.removeItem(In))}async function Pn(e=!0){let t=Bn();const n=!t.token||!t.owner||!t.repo;if(!e&&n)return null;if(n){const e=prompt("Enter GitHub Personal Access Token (repo scope):",t.token||"");if(!e)return $t("Setup cancelled","red"),null;const n=prompt("GitHub owner/user:",t.owner||"");if(!n)return $t("Setup cancelled","red"),null;const o=prompt("GitHub repo name:",t.repo||"");if(!o)return $t("Setup cancelled","red"),null;const r=prompt("Branch (default main):",t.branch||"main")||"main",i=prompt("Backup file path:",t.path||"gotaio_backup.json")||"gotaio_backup.json";"function"==typeof GM_setValue?(GM_setValue(_n,e.trim()),GM_setValue(Sn,n.trim()),GM_setValue(Ln,o.trim()),GM_setValue(An,r.trim()),GM_setValue(In,i.trim())):(localStorage.setItem(_n,e.trim()),localStorage.setItem(Sn,n.trim()),localStorage.setItem(Ln,o.trim()),localStorage.setItem(An,r.trim()),localStorage.setItem(In,i.trim())),t=Bn(),$t("GitHub settings saved")}return t}function Gn(e){return btoa(encodeURIComponent(e).replace(/%([0-9A-F]{2})/g,(e,t)=>String.fromCharCode("0x"+t)))}function Dn(e){const t=atob(e),n=Array.prototype.map.call(t,e=>"%"+("00"+e.charCodeAt(0).toString(16)).slice(-2)).join("");return decodeURIComponent(n)}function Rn(e){return{Authorization:`Bearer ${e.token}`,Accept:"application/vnd.github+json","X-GitHub-Api-Version":"2022-11-28","Content-Type":"application/json"}}async function zn(e){const t=await fetch(function(e){const t=encodeURIComponent(e.path).replace(/%2F/g,"/");return`https://api.github.com/repos/${encodeURIComponent(e.owner)}/${encodeURIComponent(e.repo)}/contents/${t}?ref=${encodeURIComponent(e.branch)}`}(e),{method:"GET",headers:Rn(e)});if(404===t.status)return null;if(!t.ok)throw new Error(`GitHub GET ${t.status}`);return t.json()}async function Hn(e,t,n,o=null){const r=encodeURIComponent(e.path).replace(/%2F/g,"/"),i=`https://api.github.com/repos/${encodeURIComponent(e.owner)}/${encodeURIComponent(e.repo)}/contents/${r}`,a={message:n,content:t,branch:e.branch};o&&(a.sha=o);const l=await fetch(i,{method:"PUT",headers:Rn(e),body:JSON.stringify(a)});if(!l.ok){const e=await l.text().catch(()=>"");throw new Error(`GitHub PUT ${l.status}: ${e.slice(0,600)}`)}return l.json()}function Fn(e){const t=e?.message||"";return t.includes("GitHub PUT 401")||t.includes("GitHub PUT 403")||t.includes("GitHub GET 401")||t.includes("GitHub GET 403")}function On(){const e={};if("function"!=typeof GM_getValue)return e;try{for(const t of Tn)if(!t.startsWith(Mn))try{const n=GM_getValue(t);null!=n&&(e[t]=n)}catch(e){}}catch(e){}return e}function qn(){const e={};try{for(const t of Tn)if(!t.startsWith(Mn))try{const n=localStorage.getItem(t);null!=n&&(e[t]=n)}catch(e){}}catch(e){}return e}function jn(){return{meta:{tool:"Gota.io Gallery Backup",version:2,ts:(new Date).toISOString(),origin:location.origin,scope:"whitelist"},gm:On(),localStorage:qn(),keys:Tn.slice()}}async function Un(e){if(!e||"object"!=typeof e)return;const t=new Set(Tn);if(e.gm&&"object"==typeof e.gm)for(const[n,o]of Object.entries(e.gm))if(t.has(n))try{"function"==typeof GM_setValue&&GM_setValue(n,o)}catch(e){}if(e.localStorage&&"object"==typeof e.localStorage)for(const[n,o]of Object.entries(e.localStorage))if(t.has(n))try{localStorage.setItem(n,o)}catch(e){}}async function Vn(){let e=0;for(;e<=1;)try{const e=await Pn(!0);if(!e)return;const t=Gn(JSON.stringify(jn(),null,2)),n=await zn(e),o=n?.sha||null;return await Hn(e,t,`Backup ${(new Date).toISOString()}`,o),void $t(`Backup uploaded to ${e.owner}/${e.repo}@${e.branch}`)}catch(t){if(console.error("Backup error:",t),Fn(t)&&0===e){Nn(),$t("Invalid GitHub credentials. Please re-enter your details.","orange"),e++;continue}return void $t(`Backup failed: ${t.message||t}`,"red")}}async function $n(){let e=0;for(;e<=1;)try{let e=Bn();if(e.token&&e.owner&&e.repo||(e=await Pn(!0)),!e)return;const t=await zn(e);if(!t||!t.content)return void $t("Backup file not found","red");const n=Dn(t.content.replace(/\n/g,"")),o=JSON.parse(n);await Un(o),await me(),await ve(),Ie();try{__lastRenderSig=null,st=(st||0)+1,lt=[]}catch(e){}try{U(q())}catch(e){}try{W(V())}catch(e){}try{kt(vt())}catch(e){}try{ae(re())}catch(e){}try{ko()}catch(e){}try{Ae()}catch(e){}return"function"==typeof Ft&&Ft(),void $t("Restore complete. All data refreshed.")}catch(t){if(console.error("Restore error:",t),Fn(t)&&0===e){Nn(),$t("Invalid GitHub credentials. Please re-enter your details.","orange"),e++;continue}return void $t(`Restore failed: ${t.message||t}`,"red")}}function Wn(){try{const e=Bn?Bn():null;if(!(e&&e.token&&e.owner&&e.repo))return void Pn(!0).then(e=>{e&&Wn()})}catch(e){}try{return void En({title:"Confirm GitHub Backup",message:"This will overwrite your GitHub backup with your current gallery data. Are you sure?",confirmText:"Backup",cancelText:"Cancel",onConfirm:()=>{try{Vn()}catch(e){}}})}catch(e){}confirm("Overwrite GitHub backup with current gallery data?")&&Vn()}function Yn(){try{const e=Bn?Bn():null;if(!(e&&e.token&&e.owner&&e.repo))return void Pn(!0).then(e=>{e&&Yn()})}catch(e){}try{return void En({title:"Confirm Restore from GitHub",message:"This will replace your local gallery data with the backup from GitHub. Are you sure?",confirmText:"Restore",cancelText:"Cancel",onConfirm:()=>{try{$n()}catch(e){}}})}catch(e){}confirm("Replace local gallery data with backup from GitHub?")&&$n()}!function(){function e(){const e=document.querySelector("#context-menu .context-list");if(!e)return;!function(){if(document.getElementById("gs-addskin-style"))return;const e=document.createElement("style");e.id="gs-addskin-style",e.textContent="#context-menu #menu-add-skin-gallery{display:block !important;}",document.head.appendChild(e)}();if(e.querySelector("#menu-add-skin-gallery"))return;const t=document.createElement("li");t.id="menu-add-skin-gallery",t.className="context-action",t.innerHTML="<span>Add Skin</span>",t.addEventListener("click",()=>{const e=document.querySelector("#context-menu #context-name"),t=function(e){const t=(e=String(e||"").trim()).match(/\[([^\]]+)\]/);return(t?t[1]:e).trim()}(e&&e.textContent);if(!t)return;En({title:"Add Skin",message:`<div style="margin-bottom:8px;">Choose profile</div><select id="gs-addskin-prof" style="width:100%;padding:6px;border-radius:6px;border:1px solid #888;">${(Array.isArray(fe)?fe:[]).map((e,t)=>{const n=e&&e.name?e.name:`Profile ${t+1}`;return`<option value="${t}"${t===ye?" selected":""}>${n}</option>`}).join("")}</select><div style="margin-top:10px;color:#ccc;font-size:12px;">Skin: <b>${t.replace(/</g,"&lt;")}</b></div>`,confirmText:"Add",cancelText:"Cancel",onConfirm:async()=>{const e=document.getElementById("gs-addskin-prof"),n=e?parseInt(e.value,10):ye;try{if((fe[n].skins||[]).some(e=>(e.name||"").toLowerCase()===t.toLowerCase()))return void $t("Skin name already exists in that profile");let e=null;try{const n=await Jt(t);e=n&&n.uuid}catch(n){const o=await Kt(t);e=o&&o.uuid}if(!e)return void En({title:"Skin Not Found",message:"Could not resolve a UUID for that skin name.",confirmText:"OK",cancelText:null,onConfirm:()=>{}});fe[n].skins.push({name:t,uuid:String(e).trim()}),xe(),Ie(),"function"==typeof Ft&&Ft(),$t("Skin added!")}catch(e){}}})}),e.appendChild(t)}const t=new MutationObserver(e);try{t.observe(document.body,{childList:!0,subtree:!0})}catch(e){}e()}(),"function"==typeof GM_registerMenuCommand&&(GM_registerMenuCommand("Backup to Git",Wn),GM_registerMenuCommand("Restore All",Yn));const Kn="gotaio.sync.prefs",Jn="gotaio.sync.last";function Xn(){try{const e="function"==typeof GM_getValue?GM_getValue(Kn):localStorage.getItem(Kn);if(!e)return{enabled:!1,intervalDays:3,mirrorTabs:!1};const t="string"==typeof e?JSON.parse(e):e;return{enabled:!!t.enabled,intervalDays:parseInt(t.intervalDays,10)||3,mirrorTabs:!!t.mirrorTabs}}catch(e){return{enabled:!1,intervalDays:3}}}function Qn(e){const t=function(){try{const e="function"==typeof GM_getValue?GM_getValue(Kn):localStorage.getItem(Kn);return e?"string"==typeof e?JSON.parse(e):e:{}}catch(e){return{}}}(),n={enabled:!!(e.enabled??t.enabled),intervalDays:parseInt(e.intervalDays??t.intervalDays,10)||3,mirrorTabs:!!(e.mirrorTabs??t.mirrorTabs)},o=JSON.stringify(n);"function"==typeof GM_setValue?GM_setValue(Kn,o):localStorage.setItem(Kn,o)}function Zn(){try{const e="function"==typeof GM_getValue?GM_getValue(Jn):localStorage.getItem(Jn),t="number"==typeof e?e:e?parseInt(e,10):0;return isNaN(t)?0:t}catch(e){return 0}}async function eo(){const e=Bn();if(e.token&&e.owner&&e.repo)try{const t=Gn(JSON.stringify(jn(),null,2)),n=await zn(e),o=n?.sha||null;await Hn(e,t,`Auto Backup ${(new Date).toISOString()}`,o),function(e){const t="number"==typeof e?e:Date.now();"function"==typeof GM_setValue?GM_setValue(Jn,t):localStorage.setItem(Jn,String(t))}(Date.now()),$t("Auto backup complete")}catch(e){console.error("Auto backup failed",e),Fn(e)?(Nn(),$t("Auto backup failed: Invalid credentials","red")):$t("Auto backup failed","red")}}let to=null;function no(e=!1){to&&(clearInterval(to),to=null);const t=Xn();if(!t.enabled)return;const n=24*Math.max(1,t.intervalDays)*60*60*1e3,o=Zn(),r=Date.now();(!o||r-o>n)&&setTimeout(()=>{eo().catch(()=>{})},1500),to=setInterval(()=>{const e=Zn();(!e||Date.now()-e>=n)&&eo().catch(()=>{})},Math.min(n,216e5))}try{no()}catch(or){}if(function(){const e="gotaio.mirror.v1",t="gotaio.mirror.bus",n=Math.random().toString(36).slice(2),o=Date.now();let r=null,i=!1,a=[],l={scroll:!1,pos:!1,theme:!1,profile:!1,gv:!1},s=!1;const c=new Map;let d=!1;function p(e){a.push(e)}function u(o){o=Object.assign({id:n,ts:Date.now()},o);try{if(!r&&"BroadcastChannel"in window&&(r=new BroadcastChannel(e)),r)return void r.postMessage(o)}catch(e){}try{localStorage.setItem(t,JSON.stringify(o))}catch(e){}}function f(e){if(!e||e.id===n)return;const t=e.t,r=e.p;if(t){if("h"===t)return"number"==typeof e.ts&&c.set(e.id,{id:e.id,ts:e.ts}),void m();if("bye"===t){s&&e.id;const t=Array.from(c.values());t.push({id:n,ts:o}),t.sort((e,t)=>t.ts-e.ts||e.id.localeCompare(t.id));const r=t.length?t[0].id:n;try{c.delete(e.id)}catch(e){}m();(function(){const e=Array.from(c.values());e.push({id:n,ts:o}),e.sort((e,t)=>t.ts-e.ts||e.id.localeCompare(t.id)),e.length&&e[0].id})();if(r===e.id&&n!==e.id)try{!s&&window.__Gallery&&"function"==typeof window.__Gallery.setOpen&&window.__Gallery.setOpen(!1,{silent:!0})}catch(e){}return}if("rq"!==t){if("rp"===t){if(e.to!==n)return;return function(e){if(!e||"object"!=typeof e)return;if(e.th){l.theme=!0;try{ho(e.th),wo(e.th)}finally{requestAnimationFrame(()=>{l.theme=!1})}}if(e.p){const t=document.getElementById("skinBox");t&&(l.pos=!0,"number"==typeof e.p.l&&(t.style.left=e.p.l+"px"),"number"==typeof e.p.t&&(t.style.top=e.p.t+"px"),"number"==typeof e.p.w&&(t.style.width=e.p.w+"px"),"number"==typeof e.p.h&&(t.style.height=e.p.h+"px"),requestAnimationFrame(()=>{l.pos=!1}))}if(e.s){const t=document.querySelector("#skinBox .circle-grid-container");if(t){l.scroll=!0;try{t.scrollTo({top:e.s.y||0,left:e.s.x||0,behavior:"auto"})}catch(n){t.scrollTop=e.s.y||0,t.scrollLeft=e.s.x||0}requestAnimationFrame(()=>{l.scroll=!1})}}if("number"==typeof e.pi){l.profile=!0;try{try{window.currentProfileIdx=e.pi}catch(e){}try{ye=e.pi}catch(e){}Ie(),"function"==typeof Ft&&Ft(),"function"==typeof he&&he(),Ce()}finally{requestAnimationFrame(()=>{l.profile=!1})}}if("boolean"==typeof e.gv){l.gv=!0;try{window.__Gallery&&"function"==typeof window.__Gallery.setOpen&&window.__Gallery.setOpen(!!e.gv,{silent:!0})}finally{requestAnimationFrame(()=>{l.gv=!1})}}}(r),void(d=!0)}if("gv"!==t){if("s"===t){const e=document.querySelector("#skinBox .circle-grid-container");if(!e)return;l.scroll=!0;try{e.scrollTo({top:r.y||0,left:r.x||0,behavior:"auto"})}catch(t){e.scrollTop=r.y||0,e.scrollLeft=r.x||0}requestAnimationFrame(()=>{l.scroll=!1})}else if("p"===t){const e=document.getElementById("skinBox");if(!e)return;l.pos=!0,"number"==typeof r.l&&(e.style.left=r.l+"px"),"number"==typeof r.t&&(e.style.top=r.t+"px"),"number"==typeof r.w&&(e.style.width=r.w+"px"),"number"==typeof r.h&&(e.style.height=r.h+"px"),requestAnimationFrame(()=>{l.pos=!1})}else if("th"===t){l.theme=!0;try{ho(r),wo(r)}finally{requestAnimationFrame(()=>{l.theme=!1})}}else if("pi"===t){if("number"!=typeof r)return;l.profile=!0;try{window.currentProfileIdx=r;try{window.currentProfileIdx=r}catch(e){}try{ye=r}catch(e){}Ie(),"function"==typeof Ft&&Ft(),Ce(),"function"==typeof he&&he(),ko()}finally{requestAnimationFrame(()=>{l.profile=!1})}}}else{if(l.gv)return;l.gv=!0;try{window.__Gallery&&"function"==typeof window.__Gallery.setOpen&&window.__Gallery.setOpen(!!r,{silent:!0})}finally{requestAnimationFrame(()=>{l.gv=!1})}}}else{if(!s)return;u({t:"rp",to:e.id,p:y()})}}}function y(){try{const e=document.querySelector("#skinBox .circle-grid-container"),t=document.getElementById("skinBox"),n=document.documentElement.getAttribute("data-theme")||(void 0!==Co?Co:""),o=t?t.getBoundingClientRect():null;return{pi:"number"==typeof ye?ye:0,th:n,p:t&&o?{l:parseInt(t.style.left||o.left||0,10)||0,t:parseInt(t.style.top||o.top||0,10)||0,w:parseInt(t.style.width||o.width||0,10)||0|o.width,h:parseInt(t.style.height||o.height||0,10)||0|o.height}:null,s:e?{x:0|e.scrollLeft,y:0|e.scrollTop}:null,gv:!(!window.__Gallery||"function"!=typeof window.__Gallery.isOpen)&&!!window.__Gallery.isOpen()}}catch(e){return{pi:0,th:""}}}function m(){try{const e=Array.from(c.values());e.push({id:n,ts:o}),e.sort((e,t)=>t.ts-e.ts||e.id.localeCompare(t.id));const t=(e.length?e[0].id:n)===n;t!==s&&(s=t)}catch(e){}}function g(e){let t=0,n=!1,o=null,r=null;return function(i){const a=Date.now();if(o=arguments,r=this,n)return;const l=a-t;if(l>=e)t=a,i.apply(r,[]);else{n=!0;setTimeout(()=>{requestAnimationFrame(()=>{t=Date.now(),n=!1,i.apply(r,[])})},e-l)}}}const h=g(80),x=g(90),v=g(120);function w(){if(i)return;i=!0;try{if(!r&&"BroadcastChannel"in window&&(r=new BroadcastChannel(e)),r){const e=e=>f(e&&e.data);r.addEventListener("message",e),p(()=>{try{r.removeEventListener("message",e)}catch(e){}})}}catch(e){}const n=e=>{if(e&&e.key===t)try{f(JSON.parse(e.newValue||""))}catch(e){}};window.addEventListener("storage",n),p(()=>{try{window.removeEventListener("storage",n)}catch(e){}}),u({t:"h",ts:o}),m(),setTimeout(()=>{s||d||u({t:"rq"})},160);const a=()=>{try{u({t:"bye"})}catch(e){}};window.addEventListener("beforeunload",a),p(()=>{try{window.removeEventListener("beforeunload",a)}catch(e){}});const c=document.querySelector("#skinBox .circle-grid-container");if(c){const e=()=>{l.scroll||h(()=>{u({t:"s",p:{x:0|c.scrollLeft,y:0|c.scrollTop}})})};c.addEventListener("scroll",e,{passive:!0}),p(()=>{try{c.removeEventListener("scroll",e)}catch(e){}})}const y=document.getElementById("skinBox");if(y){const e=new MutationObserver(()=>{l.pos||x(()=>{const e=y.getBoundingClientRect();u({t:"p",p:{l:0|(parseInt(y.style.left||e.left||0,10)||0),t:0|(parseInt(y.style.top||e.top||0,10)||0),w:0|(parseInt(y.style.width||e.width||0,10)||0|e.width),h:0|(parseInt(y.style.height||e.height||0,10)||0|e.height)}})})});try{e.observe(y,{attributes:!0,attributeFilter:["style"]})}catch(e){}p(()=>{try{e.disconnect()}catch(e){}})}const g=document.documentElement;if(g){const e=new MutationObserver(()=>{if(l.theme)return;const e=g.getAttribute("data-theme")||(void 0!==Co?Co:void 0);e&&v(()=>{u({t:"th",p:e})})});try{e.observe(g,{attributes:!0,attributeFilter:["data-theme"]})}catch(e){}p(()=>{try{e.disconnect()}catch(e){}})}window.__MirrorSync=window.__MirrorSync||{},window.__MirrorSync.profileIndexChanged=function(e){i&&!l.profile&&u({t:"pi",p:Number(e)||0})},window.__MirrorSync.galleryVisibilityChanged=function(e){i&&!l.gv&&u({t:"gv",p:!!e})}}function k(){i&&(i=!1,a.splice(0).forEach(e=>{try{e()}catch(e){}}))}window.__MirrorSync=Object.assign(window.__MirrorSync||{},{enable:w,disable:k,isEnabled:()=>i,setEnabled:e=>{e?w():k()}});try{const e=Xn();e&&e.mirrorTabs&&w()}catch(e){}try{b(()=>{k();try{r&&r.close&&r.close()}catch(e){}})}catch(e){}}(),"skins.gota.io"===location.hostname){function oo(e,t){if(!e||!t)return;if(e.dataset.gotaioHoverName=t,e.__gotaioHoverBound)return;e.__gotaioHoverBound=!0;const n=()=>{const n=e.dataset.gotaioHoverName||t;n&&(window.__skinSiteHover={element:e,name:n})},o=()=>{window.__skinSiteHover&&window.__skinSiteHover.element===e&&(window.__skinSiteHover=null)};e.addEventListener("mouseenter",n),e.addEventListener("mouseleave",o),e.addEventListener("focusin",n),e.addEventListener("focusout",o)}window.__skinSiteHover=null,function(){if(document.getElementById("gotaio-skin-site-dropdown-style"))return;const e=document.createElement("style");e.id="gotaio-skin-site-dropdown-style",e.textContent="\n          /* Modal select and options: force white background for readability */\n          #gotaio-profile-modal select {\n            background: #ffffff !important;\n            color: #23272e !important;\n            border: 2px solid #4caf50 !important;\n          }\n          #gotaio-profile-modal select option {\n            background: #ffffff !important;\n            color: #23272e !important;\n          }\n          /* Some browsers use a separate list box element; try to cover it generically */\n          #gotaio-profile-modal select:focus {\n            outline: none !important;\n            border-color: #1976d2 !important;\n          }\n        ",document.head.appendChild(e)}();const rr=async function(){const e=await("function"==typeof GM_getValue?GM_getValue("gotaio_profiles_v2"):null);let t=[];if(e)try{if(t=JSON.parse(e),!Array.isArray(t))throw new Error("Invalid format")}catch(e){t=[{name:"Default",skins:[]}]}else t=[{name:"Default",skins:[]}];return t=t.map(e=>({name:"string"==typeof e.name?e.name:"Default",skins:Array.isArray(e.skins)?e.skins:[],..."string"==typeof e.ringColor&&e.ringColor?{ringColor:e.ringColor}:{},..."string"==typeof e.theme&&e.theme?{theme:e.theme}:{}})),t},ir=async function(e){try{Array.isArray(e)&&(fe=e)}catch(e){}"function"==typeof GM_setValue&&await GM_setValue("gotaio_profiles_v2",JSON.stringify(e))};function ro(e,t,n,o,r){const i=r||{};let a=document.getElementById("gotaio-profile-modal");a&&a.remove();const l=document.createElement("div");l.id="gotaio-profile-modal",l.style.position="fixed",l.style.top="0",l.style.left="0",l.style.width="100vw",l.style.height="100vh",l.style.background="rgba(0,0,0,0.35)",l.style.zIndex="10050",l.style.display="flex",l.style.justifyContent="center",l.style.alignItems="center";const s=document.createElement("div");s.style.background="#23272e",s.style.color="white",s.style.padding="28px  32px 22px 32px",s.style.borderRadius="10px",s.style.boxShadow="0 4px 24px rgba(0,0,0,0.25)",s.style.minWidth="280px",s.style.maxWidth="90vw",s.style.display="flex",s.style.flexDirection="column",s.style.alignItems="center";const c=document.createElement("div");c.textContent=i.titleText||"Add skin to profile",c.style.fontWeight="bold",c.style.fontSize="18px",c.style.marginBottom="10px",s.appendChild(c);const d=document.createElement("select");d.style.width="100%",d.style.padding="7px",d.style.marginBottom="24px",d.style.borderRadius="5px",d.style.border="2px solid #4caf50",d.style.fontSize="16px",d.style.fontWeight="bold",d.style.background="#fff",d.style.color="#23272e",d.style.boxShadow="0 2px 8px rgba(0,0,0,0.18)",d.style.outline="none",d.style.transition="border-color .15s ease, box-shadow .15s ease, background-color .15s ease",d.style.lineHeight="1.25",d.onfocus=function(){d.style.border="2px solid #1976d2",d.style.boxShadow="0 0 0 3px rgba(25,118,210,0.15)"},d.onblur=function(){d.style.border="2px solid #4caf50",d.style.boxShadow="none"};const p=!!i.onlyContaining;e.forEach((e,n)=>{const o=document.createElement("option");o.value=n;const r=(e.skins||[]).some(e=>e.uuid===t);p&&!r||(r?(o.textContent=e.name+" ✔️",o.style.color="#4caf50",o.style.fontWeight="bold",o.style.background="#e8f5e9"):o.textContent=e.name,d.appendChild(o))});const u="gotaio_last_profile_idx";let f=parseInt(localStorage.getItem(u),10);(isNaN(f)||f<0||f>=e.length)&&(f=0),p?d.options.length>0&&(d.selectedIndex=0):d.selectedIndex=f,s.appendChild(d);const y=document.createElement("div");y.style.display="flex",y.style.gap="12px",y.style.justifyContent="center";const m=document.createElement("button");m.textContent=i.confirmText||"Add",m.style.background="#4caf50",m.style.color="white",m.style.border="none",m.style.borderRadius="5px",m.style.padding="7px 18px",m.style.fontSize="15px",m.style.cursor="pointer";const g=document.createElement("button");g.textContent="Cancel",g.style.background="#d32f2f",g.style.color="white",g.style.border="none",g.style.borderRadius="5px",g.style.padding="7px 18px",g.style.fontSize="15px",g.style.cursor="pointer",y.appendChild(m),y.appendChild(g),s.appendChild(y),l.appendChild(s),document.body.appendChild(l),m.onclick=function(){localStorage.setItem(u,d.selectedIndex),o(parseInt(d.value,10)),l.remove()},g.onclick=function(){l.remove()}}function io(e,t="green"){let n=document.getElementById("gotaio-skin-site-note");n||(n=document.createElement("div"),n.id="gotaio-skin-site-note",n.style.position="fixed",n.style.top="30px",n.style.left="50%",n.style.transform="translateX(-50%)",n.style.background="red"===t?"rgba(200,40,40,0.97)":"rgba(40,180,80,0.97)",n.style.color="white",n.style.padding="10px 24px",n.style.borderRadius="8px",n.style.fontSize="16px",n.style.fontWeight="bold",n.style.boxShadow="0 2px 8px rgba(0,0,0,0.2)",n.style.zIndex="10010",n.style.display="none",document.body.appendChild(n)),n.textContent=e,n.style.display="block",n.style.background="red"===t?"rgba(200,40,40,0.97)":"rgba(40,180,80,0.97)",setTimeout(()=>{n.style.display="none"},1200)}function ao(){let e=[];e=location.pathname.startsWith("/skins")?document.querySelectorAll(".grid .flex.flex-col"):document.querySelectorAll("#skins li"),e.forEach(e=>{if(e.querySelector(".uuid-btn"))return;const t=e.querySelector("img");if(!t||!t.src)return;const n=t.src.match(/([a-f0-9\-]{36})\.png$/i);if(!n)return;const o=n[1];let r="",i=null;const a=e.querySelector("span.text-lg.font-bold");if(a&&a.textContent.trim().length>0)i=a,r=a.textContent.trim();else{const t=["h3","h4","h5","span","div","p"];for(const n of t){const t=e.querySelector(n);if(t&&t.textContent.trim().length>0){i=t,r=t.textContent.trim();break}}}i&&!i.dataset.gotaioCopyBound&&(i.dataset.gotaioCopyBound="1",i.title="Click to copy",i.style.cursor="pointer",i.addEventListener("click",e=>{e.preventDefault(),e.stopPropagation();const t=r?`${r} | ${o}`:o;navigator.clipboard.writeText(t);const n=i.textContent;i.textContent="Copied!",setTimeout(()=>{i.textContent=n},900)})),r&&oo(e,r);const l=document.createElement("button");l.textContent="Delete",l.className="uuid-btn",l.style.marginTop="2px",l.style.padding="2px 8px",l.style.borderRadius="4px",l.style.border="none",l.style.background="#D65050",l.style.color="#fff",l.style.cursor="pointer",l.style.fontWeight="bold",l.style.display="block",l.style.marginLeft="0",l.style.marginRight="0",l.style.marginBottom="0",l.onclick=async function(){try{const e=await rr(),t=[];for(let n=0;n<e.length;n++)(e[n].skins||[]).some(e=>e.uuid===o)&&t.push(n);if(0===t.length)return void io("Skin not found in any profile","red");if(1===t.length){const n=t[0];return e[n].skins=(e[n].skins||[]).filter(e=>e.uuid!==o),await ir(e),void io("Skin deleted from profile!")}ro(e,o,0,async function(t){e[t].skins=(e[t].skins||[]).filter(e=>e.uuid!==o),await ir(e),io("Skin deleted from profile!")},{titleText:"Delete skin from profile",confirmText:"Delete",onlyContaining:!0})}catch(e){console.error(e)}};const s=document.createElement("button");s.textContent="Add",s.className="add-btn",s.style.marginTop="2px",s.style.padding="2px 8px",s.style.borderRadius="4px",s.style.border="none",s.style.background="#4CAF50",s.style.color="#fff",s.style.cursor="pointer",s.style.fontWeight="bold",s.style.display="block",s.style.marginBottom="0",s.onclick=async function(){const e=await rr();ro(e,o,0,async function(t){const n=e&&e[t];if(!n)return void io("Profile not found","red");(n.skins||[]).some(e=>e.uuid===o)?io("Skin already exists in this profile!","red"):(n.skins=Array.isArray(n.skins)?n.skins:[],n.skins.push({name:r,uuid:o}),await ir(e),io("Skin added to profile!"))})};const c=document.createElement("div");c.style.display="flex",c.style.flexDirection="row",c.style.justifyContent="center",c.style.alignItems="center",c.style.gap="8px",c.appendChild(l),c.appendChild(s),e.appendChild(c)})}function lo(){if(!/^\/skins\/[a-f0-9\-]{36}$/i.test(location.pathname))return;const e=document.querySelector("img.rounded-full.rainbow");if(!e||!e.src)return;const t=e.src.match(/([a-f0-9\-]{36})\.png$/i);if(!t)return;const n=t[1];let o="";const r=document.querySelector("h3.text-lg");if(r&&r.textContent.trim().length>0){o=r.textContent.trim(),r.dataset.gotaioCopyBound||(r.dataset.gotaioCopyBound="1",r.title="Click to copy",r.style.cursor="pointer",r.addEventListener("click",e=>{e.preventDefault(),e.stopPropagation();const t=o?`${o} | ${n}`:n;navigator.clipboard.writeText(t);const i=r.textContent;r.textContent="Copied!",setTimeout(()=>{r.textContent=i},900)}));const t=e.closest(".flex")||e.parentElement;o&&t&&oo(t,o)}if(e.parentElement.querySelector(".uuid-btn"))return;const i=document.createElement("button");i.textContent="Delete",i.className="uuid-btn",i.style.marginTop="12px",i.style.padding="2px 8px",i.style.borderRadius="4px",i.style.border="none",i.style.background="#D65050",i.style.color="#fff",i.style.cursor="pointer",i.style.fontWeight="bold",i.style.display="inline-block",i.onclick=async function(){try{const e=await rr(),t=[];for(let o=0;o<e.length;o++)(e[o].skins||[]).some(e=>e.uuid===n)&&t.push(o);if(0===t.length)return void io("Skin not found in any profile","red");if(1===t.length){const o=t[0];return e[o].skins=(e[o].skins||[]).filter(e=>e.uuid!==n),await ir(e),void io("Skin deleted from profile!")}ro(e,n,0,async function(t){e[t].skins=(e[t].skins||[]).filter(e=>e.uuid!==n),await ir(e),io("Skin deleted from profile!")},{titleText:"Delete skin from profile",confirmText:"Delete",onlyContaining:!0})}catch(e){console.error(e)}};const a=document.createElement("button");a.textContent="Add",a.className="add-btn",a.style.marginLeft="8px",a.style.marginTop="12px",a.style.padding="2px 8px",a.style.borderRadius="4px",a.style.border="none",a.style.background="#4CAF50",a.style.color="#fff",a.style.cursor="pointer",a.style.fontWeight="bold",a.style.display="inline-block",a.onclick=async function(){const e=await rr();ro(e,n,0,async function(t){const r=e&&e[t];if(!r)return void io("Profile not found","red");(r.skins||[]).some(e=>e.uuid===n)?io("Skin already exists in this profile!","green"):(r.skins=Array.isArray(r.skins)?r.skins:[],r.skins.push({name:o,uuid:n}),await ir(e),io("Skin added to profile!"))})};const l=document.createElement("div");l.style.display="flex",l.style.flexDirection="row",l.style.justifyContent="center",l.style.alignItems="center",l.style.gap="8px",l.appendChild(i),l.appendChild(a),e.parentElement.appendChild(l)}if(!window.__skinSiteHotkeysInstalled){window.__skinSiteHotkeysInstalled=!0;const ar=300;let lr=null,sr=0,cr=null;const dr=(e,t)=>{if(!e)return;const n={type:"GALLERY_APPLY_SKIN_NAME",name:e,pressCount:t},o=[];window.opener&&!window.opener.closed&&o.push(window.opener),window.parent&&window.parent!==window&&o.push(window.parent);let r=!1;for(const e of o)try{e.postMessage(n,"*"),r=!0}catch(e){}if(r)try{{let n;n=t>=3?`Sent "${e}" to game (both inputs)`:2===t?`Sent "${e}" to game (input 2)`:`Sent "${e}" to game (input 1)`,io(n)}}catch(e){}};window.addEventListener("keydown",e=>{const t=document.activeElement;if(t&&("INPUT"===t.tagName||"TEXTAREA"===t.tagName||t.isContentEditable||t.closest&&(t.closest("input")||t.closest("textarea")||t.closest('[contenteditable="true"]'))))return;if(!L(e,S("Apply skin")))return;const n=window.__skinSiteHover,o=n&&n.name;o&&("function"==typeof e.preventDefault&&e.preventDefault(),"function"==typeof e.stopPropagation&&e.stopPropagation(),"function"==typeof e.stopImmediatePropagation&&e.stopImmediatePropagation(),lr&&lr!==o&&(sr=0,cr&&(clearTimeout(cr),cr=null)),lr||(lr=o),sr++,cr&&clearTimeout(cr),cr=setTimeout(()=>{const e=lr,t=sr;lr=null,sr=0,cr=null,dr(e,t||1)},ar))})}}if("function"==typeof GM_addValueChangeListener){let pr=0;const ur="function"==typeof GM_setValue?GM_setValue:null;ur&&(window.GM_setValue=async function(e,t){return"gotaio_profiles_v2"===e&&(pr=Date.now()),ur(e,t)});let fr=null;GM_addValueChangeListener("gotaio_profiles_v2",async function(e,t,n,o){o&&(Date.now()-pr<500||(fr&&clearTimeout(fr),fr=setTimeout(async()=>{__lastRenderSig=null,await me(),await ve(),Ie(),"function"==typeof Ft&&Ft();try{$t("Skins synced!","green")}catch(e){}fr=null},120)))})}let so=null;function co(){let e=document.getElementById("gotaio-profile-reorder-menu");e&&e.remove();const t=document.createElement("div");t.id="gotaio-profile-reorder-menu",t.style.position="fixed",t.style.top="0",t.style.left="0",t.style.width="100vw",t.style.height="100vh",t.style.background="rgba(0,0,0,0.45)",t.style.zIndex="10050",t.style.display="flex",t.style.justifyContent="center",t.style.alignItems="center";const n=document.createElement("div");n.style.background="var(--submenu-bg, rgba(22,24,32,0.96))",n.style.color="var(--menu-fg, #f5f5f5)",n.style.padding="28px 30px 22px",n.style.borderRadius="14px",n.style.boxShadow="0 18px 48px rgba(0,0,0,0.35)",n.style.border="1px solid var(--submenu-border, rgba(255,255,255,0.08))",n.style.backdropFilter="blur(14px)",n.style.minWidth="280px",n.style.maxWidth="90vw",n.style.display="flex",n.style.flexDirection="column",n.style.alignItems="center";const o=document.createElement("div");o.textContent="Manage Profiles",o.style.fontWeight="600",o.style.letterSpacing="0.03em",o.style.fontSize="19px",o.style.marginBottom="12px",o.style.color="var(--acc, #ff6bb0)",n.appendChild(o);const r=document.createElement("ul");r.style.listStyle="none",r.style.padding="0",r.style.margin="0 0 20px",r.style.width="100%",r.style.maxHeight="60vh",r.style.overflowY="auto",r.style.display="flex",r.style.flexDirection="column",r.style.gap="8px",fe.forEach((e,n)=>{const o=document.createElement("li");o.style.display="flex",o.style.alignItems="center",o.style.justifyContent="space-between",o.style.padding="10px 12px",o.style.borderRadius="10px",o.style.background="rgba(0,0,0,0.14)",o.style.border="1px solid var(--section-border, rgba(255,255,255,0.05))";const i=document.createElement("span");i.textContent=e.name,i.style.flex="1",i.style.overflow="hidden",i.style.textOverflow="ellipsis",i.style.whiteSpace="nowrap",i.style.fontWeight="500",i.style.color="var(--menu-fg, #f9f9f9)",n===ye&&(i.style.fontWeight="700",i.style.color="var(--acc, #ff6bb0)"),o.appendChild(i);const a=document.createElement("div");a.style.display="flex",a.style.gap="6px";const l=document.createElement("button");l.textContent="↑",l.title="Move Up",l.style.background="var(--chip-bg, rgba(255,255,255,0.12))",l.style.color="var(--menu-fg, #f5f5f5)",l.style.border="1px solid var(--section-border, rgba(255,255,255,0.08))",l.style.borderRadius="6px",l.style.padding="4px 12px",l.style.backdropFilter="blur(6px)",l.style.cursor=0===n?"not-allowed":"pointer",l.disabled=0===n,l.onclick=()=>{if(0===n)return;const e=fe[n-1];fe[n-1]=fe[n],fe[n]=e,ye===n?ye--:ye===n-1&&ye++,xe(),Ce(),co(),Ie(),Ft(),he()},a.appendChild(l);const s=document.createElement("button");if(s.textContent="↓",s.title="Move Down",s.style.background="var(--chip-bg, rgba(255,255,255,0.12))",s.style.color="var(--menu-fg, #f5f5f5)",s.style.border="1px solid var(--section-border, rgba(255,255,255,0.08))",s.style.borderRadius="6px",s.style.padding="4px 12px",s.style.backdropFilter="blur(6px)",s.style.cursor=n===fe.length-1?"not-allowed":"pointer",s.disabled=n===fe.length-1,s.onclick=()=>{if(n===fe.length-1)return;const e=fe[n+1];fe[n+1]=fe[n],fe[n]=e,ye===n?ye++:ye===n+1&&ye--,xe(),Ce(),co(),Ie(),Ft(),he()},a.appendChild(s),fe.length>1){const o=document.createElement("button");o.textContent="🗑️",o.title="Delete Profile",o.style.background="linear-gradient(135deg, rgba(255,68,128,0.92) 0%, rgba(214,43,86,0.9) 100%)",o.style.color="#fff",o.style.border="1px solid rgba(255,255,255,0.08)",o.style.borderRadius="6px",o.style.padding="4px 12px",o.style.cursor="pointer",o.onclick=()=>{t.style.display="none";const o=kn.style.zIndex;kn.style.zIndex="10060",En({title:"Delete Profile",message:`Are you sure you want to delete the profile "${le(e.name)}"?<br><span style='color:#f55'>(This cannot be undone.)</span>`,confirmText:"Delete",cancelText:"Cancel",onConfirm:()=>{fe.splice(n,1),ye>=fe.length&&(ye=Math.max(0,fe.length-1)),xe(),Ce(),Ie(),Ft(),he(),kn.style.zIndex=o,kn.style.display="none",t.style.display="flex",co()}}),setTimeout(()=>{const e=Cn.querySelectorAll("button");e.length>1&&(e[1].onclick=()=>{kn.style.display="none",kn.style.zIndex=o,t.style.display="flex"})},10)},a.appendChild(o)}o.appendChild(a),r.appendChild(o)}),n.appendChild(r);const i=document.createElement("button");i.textContent="Done",i.style.background="#4caf50",i.style.color="white",i.style.border="none",i.style.borderRadius="5px",i.style.padding="7px 18px",i.style.fontSize="15px",i.style.cursor="pointer",i.onclick=()=>t.remove(),n.appendChild(i);const a=document.createElement("div");a.textContent="Profiles can be reordered or deleted here.",a.style.fontSize="12px",a.style.color="#bbb",a.style.marginTop="12px",n.appendChild(a),t.appendChild(n),document.body.appendChild(t),ot(t,()=>{rt(t),t.remove()})}window.addEventListener("storage",async function(e){"gotaio_profiles_v2"===e.key&&(so&&clearTimeout(so),so=setTimeout(async()=>{__lastRenderSig=null,await me(),await ve(),Ie(),"function"==typeof Ft&&Ft(),so=null},120))});const po=document.createElement("div");function uo(){removeAdIframes(),function(){const e=document.getElementById("preroll");e&&e.parentNode&&e.remove()}(),document.querySelectorAll(".videoAdUiPlayPauseControl").forEach(e=>{e.parentNode&&e.remove()}),document.querySelectorAll("#preroll video, video[autoplay]").forEach(e=>{e.parentNode&&e.remove()})}function fo(){const e=document.querySelector("div.main-left.main-divider");if(e)return e;const t=document.querySelector("div.main-panel-wrapper");if(t)return t;const n=document.querySelector("#main-right.main-divider.main-panel");return n||document.body}function yo(){const e=fo(),t=e.querySelector("#main-account.main-panel");document.querySelector(".main-content.main-divider.main-panel");let n=10;if(t){const e=Array.from(t.querySelectorAll(".main-mini-container")).find(e=>"none"!==getComputedStyle(e).display);n=e?t.offsetTop+e.offsetTop+e.offsetHeight+8:t.offsetTop+8}const o=document.getElementById("skinBox"),r=o&&o.offsetWidth||600,i=document.querySelector("div.main-left.main-divider");return{left:(i?.clientWidth||e.clientWidth||0|e.getBoundingClientRect().width||800)-r-0,top:n}}po.textContent="Manage Profiles",po.style.padding="8px 18px",po.style.cursor="pointer",po.addEventListener("mouseenter",()=>po.style.background="rgba(33,150,243,0.18)"),po.addEventListener("mouseleave",()=>po.style.background=""),po.addEventListener("click",()=>{Ye.style.display="none",co()}),Ye.appendChild(po),function(){const e=document.createElement("style");for(e.textContent='\n  /* ========================================\n    COMPACT PROFILE MENU - COMPLETE CSS\n    (scoped to .menu-container; includes positioning)\n    ======================================== */\n\n  .menu-container {\n    position: fixed;\n    top: 32px;\n    right: 0;\n    background: var(--menu-bg, #ffffff);\n    border: 1px solid var(--menu-border, rgba(0,0,0,0.08));\n    border-radius: 8px;\n    width: 172px;\n    padding: 0;\n    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);\n  font-family: "Inter", "Segoe UI", "Helvetica Neue", Arial, sans-serif;\n  font-size: 12px;\n    color: var(--menu-fg, #1a1a1f);\n    z-index: 1000000;\n    display: none;\n  }\n  .menu-container:hover { box-shadow: 0 6px 16px rgba(0,0,0,0.12); }\n\n  /* Header */\n  .menu-container .menu-header {\n    padding: 4px 4px 3px 4px;\n    display: flex;\n    flex-direction: column;\n    gap: 5px;\n    border-bottom: 1px solid var(--menu-border, rgba(0,0,0,0.08));\n  }\n  .menu-container .profile-card-main {\n    display: flex;\n    align-items: center;\n    gap: 6px;\n    background: var(--section-bg, #e8e9ed);\n    padding: 5px 7px; /* slightly larger to feel like a proper card */\n    border-radius: 6px;\n    border: 1px solid var(--menu-border, rgba(0,0,0,0.08));\n    box-shadow: 0 1px 2px rgba(0,0,0,0.06);\n    transition: border-color 0.2s ease, box-shadow 0.2s ease;\n  }\n  .menu-container .profile-card-main:hover { border-color: var(--acc, #5b68f5); box-shadow: 0 2px 6px rgba(0,0,0,0.10); }\n  .menu-container .profile-icon { width: 16px; height: 16px; color: var(--acc, #5b68f5); flex-shrink: 0; }\n  .menu-container .profile-icon svg { width: 16px; height: 16px; display: block; }\n  .menu-container .profile-info { display: flex; flex-direction: column; flex: 1; min-width: 0; }\n  .menu-container .profile-name { font-size: 13px; font-weight: 700; color: var(--acc, #5b68f5); letter-spacing: 0.12em; text-transform: uppercase; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; text-shadow: 0 1px 2px rgba(0,0,0,0.08); }\n\n  /* Stats Mini Cards */\n  .menu-container .stats-cards { display: flex; gap: 2px; }\n  .menu-container .mini-card { display: flex; flex-direction: column; align-items: center; gap: 0px; background: var(--chip-bg, #f5f5f7); padding: 2px 4px; border-radius: 4px; flex: 1; }\n  .menu-container .mini-card.accent { background: var(--acc, #5b68f5); }\n  .menu-container .mini-value { font-size: 10.5px; font-weight: 600; color: var(--menu-fg, #1a1a1f); letter-spacing: 0.14em; text-transform: uppercase; }\n  .menu-container .mini-card.accent .mini-value { color: #fff; }\n  .menu-container .mini-label { font-size: 8px; font-weight: 600; text-transform: uppercase; letter-spacing: 0.12em; color: var(--chip-fg, #6b6d7a); opacity: 0.72; }\n  .menu-container .mini-card.accent .mini-label { color: #fff; opacity: 0.85; }\n\n  /* Menu Sections (compact) */\n  .menu-container .menu-section { position: relative; margin: 0; padding: 0 4px; }\n  .menu-container .menu-section + .menu-section { margin-top: 1px; }\n  .menu-container .menu-title { position: relative; display: flex; align-items: center; justify-content: space-between; width: 100%; height: 35px; background: var(--section-bg, #e8e9ed) !important; background-color: var(--section-bg, #e8e9ed) !important; color: var(--section-fg, #6b6d7a); border: 1px solid var(--section-border, rgba(0,0,0,0.08)); border-radius: 12px; padding: 3px 6px; font-size: 11px; font-weight: 650; cursor: pointer; transition: all 0.15s ease; text-transform: uppercase; letter-spacing: 0.14em; line-height: 1; min-height: 0; box-sizing: border-box; -webkit-appearance: none; appearance: none; vertical-align: middle; font-variant: small-caps; }\n  .menu-container .menu-title:hover, .menu-container .menu-title:focus-visible { color: var(--acc, #5b68f5); outline: none; background: var(--hover-bg, rgba(91,104,245,0.08)) !important; background-color: var(--hover-bg, rgba(91,104,245,0.08)) !important; border-color: var(--acc, #5b68f5); }\n  .menu-container .menu-title:focus-visible { box-shadow: 0 0 0 2px var(--acc, #5b68f5); }\n  .menu-container .menu-title-text { flex: 1; text-align: left; }\n  .menu-container .menu-title .menu-title-icon { display: inline-flex; align-items: center; justify-content: center; width: 14px; height: 14px; margin-right: 6px; color: currentColor; }\n  .menu-container .menu-title .menu-title-icon svg { width: 14px; height: 14px; display: block; }\n  .menu-container .menu-chevron { position: absolute; right: 6px; width: 11px; height: 11px; transition: color 0.15s ease; flex-shrink: 0; }\n  .menu-container .menu-title:hover .menu-chevron, .menu-container .menu-title-open .menu-chevron { color: var(--acc, #5b68f5); }\n\n  /* Submenu */\n  .menu-container .submenu { position: absolute; left: 100%; top: 0; margin-left: 4px; background: var(--menu-bg, #ffffff); border: 1px solid var(--menu-border, rgba(0,0,0,0.08)); border-radius: 6px; width: 124px; padding: 2px; box-shadow: 0 4px 12px rgba(0,0,0,0.12); z-index: 50; display: none; }\n  .menu-container .menu-section.submenu-open > .submenu { display: block; }\n  @keyframes submenuSlideIn { from { opacity: 0; transform: translateX(-4px);} to { opacity: 1; transform: translateX(0);} }\n  .menu-container .submenu-button { display: flex; align-items: center; gap: 6px; width: 100%; background: transparent; border: none; border-radius: 4px; padding: 5px 6px; font-size: 12px; font-weight: 400; color: var(--menu-fg, #1a1a1f); cursor: pointer; transition: all 0.12s ease; text-align: left; }\n  .menu-container .submenu-button:hover, .menu-container .submenu-button:focus-visible { background: var(--hover-bg, rgba(91,104,245,0.08)); color: var(--acc, #5b68f5); outline: none; transform: translateX(1px); }\n  .menu-container .submenu-button:focus-visible { box-shadow: 0 0 0 2px var(--acc, #5b68f5); }\n  .menu-container .submenu-icon { display: flex; align-items: center; justify-content: center; width: 16px; height: 16px; flex-shrink: 0; }\n  .menu-container .submenu-icon svg { width: 16px; height: 16px; display: block; }\n  .menu-container .submenu-label { flex: 1; }\n  /* Hover to open submenu automatically */\n  .menu-container .menu-section:hover > .submenu { display: block; animation: submenuSlideIn 0.15s ease; }\n  /* Hover bridge so moving from title to submenu doesn\'t close it */\n  .menu-container .menu-section::after { content: ""; position: absolute; top: 0; bottom: 0; left: 100%; width: 6px; }\n        ',document.head.appendChild(e),Ye&&Ye.getAttribute("style")&&Ye.removeAttribute("style");Ye.firstChild;)Ye.removeChild(Ye.firstChild);Ye.className="menu-container";try{We.innerHTML=g("gear"),We.style.background="transparent",We.style.border="1px solid rgba(255,255,255,0.12)",We.style.color="var(--acc, #4caf50)",We.style.width="30px",We.style.height="28px",We.style.borderRadius="8px",We.style.display="inline-flex",We.style.alignItems="center",We.style.justifyContent="center",We.style.cursor="pointer";const e=We.querySelector("svg");e&&(e.style.color="var(--acc, #4caf50)")}catch(e){}const t=document.createElement("div");t.className="menu-header";const n=document.createElement("div");n.className="profile-card-main";const o=document.createElement("div");o.className="profile-icon",o.innerHTML='<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path><circle cx="12" cy="7" r="4"></circle></svg>';const r=document.createElement("div");r.className="profile-info";const i=document.createElement("span");i.className="profile-name",i.id="profileName",r.appendChild(i),n.appendChild(o),n.appendChild(r),t.appendChild(n);const a=document.createElement("div");a.className="stats-cards";const l=document.createElement("div");l.className="mini-card";const s=document.createElement("span");s.className="mini-value",s.id="profilesCount",s.textContent="0";const c=document.createElement("span");c.className="mini-label",c.textContent="Profiles",l.appendChild(s),l.appendChild(c);const d=document.createElement("div");d.className="mini-card";const p=document.createElement("span");p.className="mini-value",p.id="skinsCount",p.textContent="0";const u=document.createElement("span");u.className="mini-label",u.textContent="Skins",d.appendChild(p),d.appendChild(u);const f=document.createElement("div");f.className="mini-card";const y=document.createElement("span");y.className="mini-value",y.id="favsCount",y.textContent="0";const m=document.createElement("span");function g(e){switch(e){case"gear":return'<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="3"></circle><path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 1 1-2.83 2.83l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 1 1-4 0v-.09a1.65 1.65 0 0 0-1-1.51 1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 1 1-2.83-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 1 1 0-4h.09a1.65 1.65 0 0 0 1.51-1 1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 1 1 2.83-2.83l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 1 1 4 0v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 1 1 2.83 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9c0 .66.39 1.26 1 1.51.31.14.65.21 1 .21H21a2 2 0 1 1 0 4h-.09c-.35 0-.69.07-1 .21-.61.25-1 .85-1 1.51z"/></svg>';case"profiles":return'<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"><path d="M17 21v-1a4 4 0 0 0-4-4h-2a4 4 0 0 0-4 4v1"/><circle cx="12" cy="8" r="3"/><path d="M23 21v-1a4 4 0 0 0-3-3.87"/><path d="M4 20v-1a4 4 0 0 1 3-3.87"/><path d="M16 3.13a3 3 0 0 1 0 5.74"/><path d="M8 8.87a3 3 0 0 1 0-5.74"/></svg>';case"add":return'<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>';case"rename":return'<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"><path d="M12 20h9"/><path d="M16.5 3.5a2.1 2.1 0 0 1 3 3L7 19l-4 1 1-4 12.5-12.5z"/></svg>';case"delete":return'<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"><polyline points="3 6 5 6 21 6"/><path d="M19 6l-1 14a2 2 0 0 1-2 2H8a2 2 0  0 1-2-2L5 6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/><line x1="10" y1="11" x2="10" y2="17"/><line x1="14" y1="11" x2="14" y2="17"/></svg>';case"share":return'<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"><circle cx="18" cy="5" r="3"/><circle cx="6" cy="12" r="3"/><circle cx="18" cy="19" r="3"/><line x1="8.59" y1="13.51" x2="15.42" y2="17.49"/><line x1="15.41" y1="6.51" x2="8.59" y2="10.49"/></svg>';case"import":return'<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/></svg>';case"cloud":return'<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"><path d="M20 17.58A5 5 0 0 0 18 9h-1.26A8 8 0 1 0 4 16.25"/><polyline points="16 16 12 12 8 16"/><line x1="12" y1="12" x2="12" y2="21"/></svg>';case"restore":return'<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"><polyline points="1 4 1 10 7 10"/><path d="M3.51 15a9 9 0 1 0 2.13-9.36L1 10"/></svg>';case"manage":return'<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"><line x1="4" y1="21" x2="4" y2="14"/><line x1="4" y1="10" x2="4" y2="3"/><line x1="12" y1="21" x2="12" y2="12"/><line x1="12" y1="8" x2="12" y2="3"/><line x1="20" y1="21" x2="20" y2="16"/><line x1="20" y1="12" x2="20" y2="3"/></svg>';case"hotkeys":return'<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="5" width="7" height="7" rx="1"/><rect x="14" y="5" width="7" height="7" rx="1"/><rect x="3" y="14" width="7" height="7" rx="1"/><rect x="14" y="14" width="7" height="7" rx="1"/></svg>';default:return""}}function h(e,t){const n=document.createElement("div");n.className="menu-section";const o=document.createElement("button");o.className="menu-title",o.setAttribute("aria-expanded","false"),o.setAttribute("aria-haspopup","menu");try{o.style.removeProperty("background"),o.style.removeProperty("background-color")}catch(e){}const r="Profiles"===e?"profiles":"Backup"===e?"cloud":"Settings"===e?"gear":"",i=r?`<span class="menu-title-icon">${g(r)}</span>`:"";o.innerHTML=`${i}<span class="menu-title-text">${e}</span>\n          <svg class="menu-chevron" viewBox="0 0 12 12" width="12" height="12" fill="none"><path d="M4.5 2.5L8 6L4.5 9.5" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/></svg>`;const a=document.createElement("div");return a.className="submenu",t.forEach(({cls:e,icon:t,label:n,action:o})=>{const r=document.createElement("button");r.className=`submenu-button ${e}`,r.innerHTML=`<span class="submenu-icon">${g(t)}</span><span class="submenu-label">${n}</span>`,r.dataset.action=o,a.appendChild(r)}),n.appendChild(o),n.appendChild(a),o.addEventListener("click",e=>{e.stopPropagation(),Ye.querySelectorAll(".menu-section.submenu-open").forEach(e=>{e!==n&&e.classList.remove("submenu-open");const t=e.querySelector(".menu-title");t&&t.classList.remove("menu-title-open");const o=e.querySelector(".submenu");o&&o.style.removeProperty("display")});const t=!n.classList.contains("submenu-open");n.classList.toggle("submenu-open",t),o.classList.toggle("menu-title-open",t),o.setAttribute("aria-expanded",t?"true":"false");try{a.style.removeProperty("display")}catch(e){}try{requestAnimationFrame(S)}catch(e){S()}}),n}m.className="mini-label",m.textContent="Favorites",f.appendChild(y),f.appendChild(m),a.appendChild(l),a.appendChild(d),a.appendChild(f),t.appendChild(a),Ye.appendChild(t),t.addEventListener("wheel",function(e){if(!fe||fe.length<2)return;e.preventDefault();let t=e.deltaY>0?1:-1,n=(ye+t+fe.length)%fe.length;ye=n,C(),Ie(),Ce(),"function"==typeof Ft&&Ft()},{passive:!1});const x=h("Profiles",[{cls:"add",icon:"add",label:"Add Profile",action:"add"},{cls:"rename",icon:"rename",label:"Rename Profile",action:"rename"},{cls:"delete",icon:"delete",label:"Delete Profile",action:"delete"}]),v=h("Backup",[{cls:"share",icon:"share",label:"Share Profile",action:"share"},{cls:"import",icon:"import",label:"Import Profiles",action:"import"},{cls:"gh",icon:"cloud",label:"Back up to GitHub",action:"backup"},{cls:"gh",icon:"restore",label:"Restore all from GitHub",action:"restore"}]),k=h("Settings",[{cls:"manage-profiles",icon:"manage",label:"Manage Profiles",action:"manage"},{cls:"hotkeys",icon:"hotkeys",label:"Hotkeys",action:"hotkeys"},{cls:"options",icon:"gear",label:"Options",action:"options"}]);Ye.appendChild(x),Ye.appendChild(v),Ye.appendChild(k),Ye.parentElement!==document.body&&document.body.appendChild(Ye);try{Ye.setAttribute("role","menu"),We.setAttribute("aria-haspopup","menu")}catch(e){}function C(){const e=(fe||[]).length,t=(fe||[]).reduce((e,t)=>e+(Array.isArray(t.skins)?t.skins.length:0),0),n=(fe||[])[ye]||{name:"Default",skins:[]},o=Array.isArray(n.skins)?n.skins.filter(e=>e&&e.favorite).length:0,r=document.getElementById("profilesCount"),i=document.getElementById("skinsCount"),a=document.getElementById("favsCount");r&&(r.textContent=String(e)),i&&(i.textContent=String(t)),a&&(a.textContent=String(o));const l=Ee(n.name,14,!1),s=document.getElementById("profileName");s&&(s.textContent=l||"",s.title=n.name||"")}C();let E=!1;function S(){const e=Ye.querySelectorAll(".submenu"),t=window.innerWidth,n=window.innerHeight;e.forEach(e=>{e.style.left="",e.style.right="",e.style.top="";const o=e.parentElement;if(!o)return;const r=o.getBoundingClientRect();let i;if("none"===window.getComputedStyle(e).display){const t={d:e.style.display,v:e.style.visibility,l:e.style.left};e.style.visibility="hidden",e.style.display="flex",e.style.left="-99999px",i=e.getBoundingClientRect(),e.style.display=t.d||"",e.style.visibility=t.v||"",e.style.left=t.l||""}else i=e.getBoundingClientRect();r.right+i.width>t-6&&(e.style.left="auto",e.style.right="100%");const a=r.top;if(a+i.height>n-6){const t=Math.min(Math.max(0,i.height-10),a+i.height-(n-6));e.style.top=-t+"px"}})}he=()=>{if(!Ye||"block"!==Ye.style.display)return;if(E)return;E=!0;const e=()=>{E=!1,C()};"function"==typeof requestAnimationFrame?requestAnimationFrame(e):setTimeout(e,16)},Ye.addEventListener("click",e=>{const t=e.target.closest(".submenu button");if(!t)return;const n=t.dataset.action;switch(Ye.style.display="none",n){case"add":Ke.click();break;case"rename":Je.click();break;case"delete":Xe.click();break;case"share":Qe.click();break;case"import":Ze.click();break;case"backup":Wn();break;case"restore":Yn();break;case"manage":po.click();break;case"hotkeys":{let i=_();function o(e){try{localStorage.setItem(w,JSON.stringify(e))}catch(e){}}let a=document.getElementById("gotaio-hotkeys-modal");a&&a.remove();const l=document.createElement("div");l.id="gotaio-hotkeys-modal",l.style.position="fixed",l.style.top="0",l.style.left="0",l.style.width="100vw",l.style.height="100vh",l.style.background="rgba(0,0,0,0.45)",l.style.zIndex="10060",l.style.display="flex",l.style.justifyContent="center",l.style.alignItems="center";const s=document.createElement("div");s.style.background="var(--submenu-bg, rgba(18,20,28,0.94))",s.style.color="var(--menu-fg, #f5f5f5)",s.style.padding="22px 24px 20px",s.style.borderRadius="12px",s.style.boxShadow="0 18px 48px rgba(0,0,0,0.35)",s.style.border="1px solid var(--submenu-border, rgba(255,255,255,0.08))",s.style.backdropFilter="blur(14px)",s.style.minWidth="300px",s.style.maxWidth="560px",s.style.display="flex",s.style.flexDirection="column",s.style.alignItems="center";const c=document.createElement("div");c.textContent="Hotkeys",c.style.fontWeight="600",c.style.fontSize="19px",c.style.letterSpacing="0.03em",c.style.marginBottom="10px",c.style.color="var(--acc, #00f0ff)",s.appendChild(c);const d=document.createElement("ul");d.style.listStyle="none",d.style.padding="0",d.style.margin="0 0 16px",d.style.width="100%",d.style.display="flex",d.style.flexDirection="column",d.style.gap="8px",i.forEach((e,t)=>{const n=document.createElement("li");n.style.display="flex",n.style.alignItems="center",n.style.justifyContent="space-between",n.style.padding="8px 12px",n.style.borderRadius="10px",n.style.background="rgba(0,0,0,0.14)",n.style.border="1px solid var(--section-border, rgba(255,255,255,0.06))";const r=document.createElement("span");r.textContent=e.action,r.style.flex="1",r.style.fontSize="15px",r.style.fontWeight="500",r.style.color="var(--menu-fg, #f9f9f9)";const a=document.createElement("input");a.type="text",a.value=e.key,a.style.background="rgba(255,255,255,0.08)",a.style.color="var(--menu-fg, #f5f5f5)",a.style.borderRadius="8px",a.style.padding="4px 8px",a.style.fontWeight="600",a.style.fontSize="14px",a.style.border="1px solid var(--section-border, rgba(255,255,255,0.1))",a.style.width="84px",a.style.fontSize="13px",a.style.backgroundClip="padding-box",a.style.textAlign="center",a.readOnly=!0,a.tabIndex=0,a.style.transition="border-color .15s ease, box-shadow .15s ease",a.addEventListener("keydown",e=>{if(e.preventDefault(),"Delete"===e.key||"Backspace"===e.key)return a.value="",i[t].key="",o(i),a.style.borderColor="var(--acc, #ff6bb0)",a.style.boxShadow="0 0 0 3px rgba(255,107,176,0.35)",a.blur(),void setTimeout(()=>{a.style.borderColor="var(--section-border, rgba(255,255,255,0.1))",a.style.boxShadow="none"},160);let n=[];e.ctrlKey&&n.push("Ctrl"),e.altKey&&n.push("Alt"),e.shiftKey&&n.push("Shift"),e.metaKey&&n.push("Meta");let r=e.key;if("Control"===r||"Shift"===r||"Alt"===r||"Meta"===r)return;1===r.length?r=r.toUpperCase():/^Arrow/.test(r)&&(r=r.replace("Arrow","")),n.push(r);const l=n.join("+");a.value=l,i[t].key=l,o(i),a.blur()}),a.addEventListener("focus",()=>{a.value="",a.style.borderColor="var(--acc, #00f0ff)",a.style.boxShadow="0 0 0 3px rgba(255,43,216,0.25)"}),a.addEventListener("blur",()=>{a.style.borderColor="var(--section-border, rgba(255,255,255,0.1))",a.style.boxShadow="none"}),n.appendChild(r),n.appendChild(a),d.appendChild(n)}),s.appendChild(d);const p=document.createElement("button");p.textContent="Done",p.style.background="#4caf50",p.style.color="white",p.style.border="none",p.style.borderRadius="5px",p.style.padding="7px 18px",p.style.fontSize="15px",p.style.cursor="pointer",p.onclick=()=>l.remove(),s.appendChild(p),l.appendChild(s),document.body.appendChild(l),ot(l,()=>{rt(l),l.remove()});break}case"options":{const u=document.getElementById("gotaio-options-modal");u&&u.remove(),function(){const e="gotaio-options-css";if(document.getElementById(e))return;const t=document.createElement("style");t.id=e,t.textContent='\n                .gotaio-options { font-family: inherit; color: var(--menu-fg, #f5f5f5); }\n                .gotaio-options .opts-group { display: flex; flex-direction: column; gap: 10px; width: 100%; }\n                .gotaio-options .opts-row { display: grid; grid-template-columns: 160px 1fr; align-items: center; gap: 14px; width: 100%; padding: 10px 12px; background: rgba(12,14,20,0.42); border-radius: 12px; border: 1px solid var(--section-border, rgba(255,255,255,0.08)); transition: border-color .18s ease, box-shadow .18s ease, background .18s ease; }\n                .gotaio-options .opts-row:hover { border-color: var(--acc, rgba(255,255,255,0.32)); box-shadow: 0 6px 22px rgba(0,0,0,0.28); background: rgba(18,20,28,0.55); }\n                .gotaio-options .lbl { color: inherit; opacity: 0.9; font-size: 14px; font-weight: 500; letter-spacing: 0.01em; }\n                .gotaio-options .controls { display: inline-flex; align-items: center; gap: 12px; flex-wrap: wrap; }\n                .gotaio-options select { width: 140px; min-width: 140px; background: rgba(255,255,255,0.08); color: var(--menu-fg, #f5f5f5); border: 1px solid var(--section-border, rgba(255,255,255,0.12)); border-radius: 10px; padding: 6px 12px; font-weight: 600; }\n                .gotaio-options select option { background: var(--submenu-bg, rgba(18,20,28,0.95)); color: var(--menu-fg, #f5f5f5); }\n                .gotaio-options select:focus { outline: none; border-color: var(--acc, rgba(255,255,255,0.32)); box-shadow: 0 0 0 3px rgba(255,255,255,0.16); }\n                .gotaio-options .toggle-switch { position: relative; display: inline-block; width: 46px; height: 24px; vertical-align: middle; }\n                .gotaio-options .toggle-switch input { opacity: 0; width: 0; height: 0; }\n                .gotaio-options .toggle-switch .track { position: absolute; inset: 0; background: rgba(255,255,255,0.08); border-radius: 9999px; transition: background .18s ease, box-shadow .18s ease; border: 1px solid var(--section-border, rgba(255,255,255,0.12)); box-shadow: inset 0 0 0 1px rgba(0,0,0,0.18); }\n                .gotaio-options .toggle-switch .track::after { content: \'\'; position: absolute; width: 18px; height: 18px; border-radius: 50%; background: var(--submenu-bg, #12141c); top: 2px; left: 3px; transition: transform .18s ease, background .18s ease; box-shadow: 0 3px 10px rgba(0,0,0,0.32); }\n                .gotaio-options .toggle-switch input:checked + .track { background: var(--acc, #6ce6ff); box-shadow: 0 0 0 3px rgba(108,230,255,0.25); }\n                .gotaio-options .toggle-switch input:checked + .track::after { transform: translateX(20px); background: rgba(10,12,18,0.92); }\n                .gotaio-options .actions { display: flex; justify-content: flex-end; gap: 8px; flex-wrap: wrap; margin-top: 4px; }\n                .gotaio-options .actions button { border: 1px solid transparent; border-radius: 9999px; padding: 6px 14px; font-weight: 600; font-size: 13px; letter-spacing: 0.01em; cursor: pointer; transition: transform .18s ease, box-shadow .18s ease, border-color .18s ease; background: rgba(255,255,255,0.07); color: var(--menu-fg, #f5f5f5); backdrop-filter: blur(6px); }\n                .gotaio-options .actions button:hover { transform: translateY(-1px); box-shadow: 0 10px 24px rgba(0,0,0,0.35); }\n                .gotaio-options .actions button[data-variant="primary"] { background: var(--acc, #6ce6ff); color: var(--submenu-bg, #080b10); }\n                .gotaio-options .actions button[data-variant="danger"] { background: rgba(239,68,68,0.16); border-color: rgba(239,68,68,0.4); color: #fca5a5; }\n                .gotaio-options .actions button[data-variant="warning"] { background: rgba(251,191,36,0.14); border-color: rgba(251,191,36,0.4); color: #fcd34d; }\n                .gotaio-options .actions button[data-variant="info"] { background: rgba(56,189,248,0.16); border-color: rgba(56,189,248,0.4); color: #67e8f9; }\n                .gotaio-options .actions button[data-variant="ghost"] { background: rgba(255,255,255,0.04); border-color: var(--section-border, rgba(255,255,255,0.12)); }\n                .gotaio-options .actions button:focus-visible { outline: none; border-color: var(--acc, rgba(255,255,255,0.32)); box-shadow: 0 0 0 3px rgba(255,255,255,0.18); }\n              ',document.head.appendChild(t)}();const f=document.createElement("div");f.id="gotaio-options-modal",f.style.position="fixed",f.style.inset="0",f.style.background="rgba(4,6,12,0.6)",f.style.zIndex="10060",f.style.display="flex",f.style.justifyContent="center",f.style.alignItems="center";const y=document.createElement("div");y.style.background="var(--submenu-bg, rgba(18,20,28,0.92))",y.style.color="var(--menu-fg, #f5f5f5)",y.style.padding="22px 24px 20px",y.style.borderRadius="14px",y.style.boxShadow="0 24px 60px rgba(0,0,0,0.45)",y.style.border="1px solid var(--submenu-border, rgba(255,255,255,0.08))",y.style.backdropFilter="blur(16px)",y.style.minWidth="320px",y.style.maxWidth="600px",y.style.display="flex",y.style.flexDirection="column",y.style.gap="12px",y.style.alignItems="stretch",y.className="gotaio-options";const m=document.createElement("div");m.textContent="Options",m.style.fontWeight="700",m.style.fontSize="18px",m.style.letterSpacing="0.08em",m.style.textTransform="uppercase",m.style.marginBottom="2px",m.style.color="var(--acc, #6ce6ff)",m.style.alignSelf="center",y.appendChild(m);const g=q(),h=document.createElement("div");h.className="opts-row";const b=document.createElement("label");b.className="lbl",b.textContent="GitHub backup schedule:";const x=document.createElement("select");[["0","OFF"],["1","1 day"],["3","3 days"],["7","7 days"]].forEach(([e,t])=>{const n=document.createElement("option");n.value=e,n.textContent=t,x.appendChild(n)});const v=Xn();x.value=v&&v.enabled&&v.intervalDays?String(v.intervalDays):"0";const k=document.createElement("input");k.type="checkbox",k.checked=!(!v||!v.mirrorTabs),k.addEventListener("change",()=>{try{window.__MirrorSync&&"function"==typeof window.__MirrorSync.setEnabled&&window.__MirrorSync.setEnabled(k.checked)}catch(e){}});const C=document.createElement("div");C.className="controls",C.appendChild(x),h.appendChild(b),h.appendChild(C);const E=document.createElement("div");E.className="opts-row";const S=document.createElement("label");S.className="lbl",S.textContent="Sync across tabs:";const L=document.createElement("div");L.className="controls";const A=document.createElement("label");A.className="toggle-switch";const I=k,M=document.createElement("span");M.className="track",A.appendChild(I),A.appendChild(M),L.appendChild(A),E.appendChild(S),E.appendChild(L);const T=document.createElement("div");T.className="opts-row";const B=document.createElement("label");B.className="lbl",B.textContent="Layout density:";const N=document.createElement("select");[["compact","Compact"],["cozy","Cozy"],["comfortable","Comfortable"]].forEach(([e,t])=>{const n=document.createElement("option");n.value=e,n.textContent=t,N.appendChild(n)});const P=vt();N.value=P,N.addEventListener("change",()=>{kt(N.value)});const G=document.createElement("div");G.className="controls",G.appendChild(N),T.appendChild(B),T.appendChild(G);const D=document.createElement("div");D.className="opts-row";const R=document.createElement("label");R.className="lbl",R.textContent="Ring size:";const z=document.createElement("input");z.type="range",z.min="1",z.max="12",z.step="1",z.value=String(V()),z.style.width="220px";const H=document.createElement("span");H.textContent=z.value+"px",H.style.minWidth="48px",H.style.textAlign="right",H.style.fontWeight="600",H.style.opacity="0.82";const F=V();z.addEventListener("input",()=>{W(parseInt(z.value,10)),H.textContent=z.value+"px"});const O=document.createElement("div");O.className="controls",O.appendChild(z),O.appendChild(H),D.appendChild(R),D.appendChild(O);const Y=document.createElement("div");Y.className="opts-row";const K=document.createElement("label");K.className="lbl",K.textContent="Circle size:";const J=document.createElement("input");J.type="range",J.min="88",J.max="220",J.step="2",J.value=String(q()),J.style.width="220px";const X=document.createElement("span");X.textContent=J.value+"px",X.style.minWidth="48px",X.style.textAlign="right",X.style.fontWeight="600",X.style.opacity="0.82",J.addEventListener("input",()=>{U(parseInt(J.value,10)),X.textContent=J.value+"px"});const Q=document.createElement("div");Q.className="controls",Q.appendChild(J),Q.appendChild(X),Y.appendChild(K),Y.appendChild(Q);const Z=document.createElement("div");Z.className="opts-group",Z.appendChild(h),Z.appendChild(T),y.appendChild(Z);const ee=document.createElement("div");ee.style.height="1px",ee.style.background="var(--section-border, rgba(255,255,255,0.1))",ee.style.margin="4px 0",ee.style.opacity="0.65",y.appendChild(ee);const te=document.createElement("div");te.className="opts-group",te.appendChild(D),te.appendChild(Y),y.appendChild(te);const ne=document.createElement("div");ne.style.height="1px",ne.style.background="var(--section-border, rgba(255,255,255,0.1))",ne.style.margin="4px 0",ne.style.opacity="0.65",y.appendChild(ne);const oe=document.createElement("div");oe.className="opts-group",oe.appendChild(E),y.appendChild(oe);const le=re(),ce=Object.assign({},le);let de=!1;const pe=()=>{ae({showFavoriteBadge:!ye.checked,showAddControl:!Ne.checked,showNameLabel:!He.checked})},ue=document.createElement("div");ue.className="opts-row";const fe=document.createElement("label");fe.className="lbl",fe.textContent="Hide favorite badge";const ye=document.createElement("input");ye.type="checkbox",ye.checked=!le.showFavoriteBadge,ye.addEventListener("change",pe);const me=document.createElement("div");me.className="controls";const ge=document.createElement("span");ge.textContent="Hide ring:",ge.style.opacity="0.9",ge.style.fontWeight="500";const he=document.createElement("input");he.type="checkbox",he.checked=!!le.hideFavoriteRing,he.addEventListener("change",()=>{ae({showFavoriteBadge:!ye.checked,showAddControl:!Ne.checked,showNameLabel:!He.checked,favBadgeStyle:le.favBadgeStyle||"heart",hideFavoriteRing:!!he.checked})});const be=document.createElement("label");be.className="toggle-switch";const xe=document.createElement("span");xe.className="track",be.appendChild(he),be.appendChild(xe);const ve=document.createElement("label");ve.className="toggle-switch";const we=document.createElement("span");we.className="track",ve.appendChild(ye),ve.appendChild(we);const ke=document.createElement("span");ke.textContent="Style:",ke.style.opacity="0.9";const Ce=document.createElement("button");Ce.type="button",Ce.title="Toggle Favorite Style",Ce.setAttribute("aria-label","Toggle Favorite Style"),Ce.style.position="relative",Ce.style.display="inline-flex",Ce.style.alignItems="center",Ce.style.width="52px",Ce.style.height="28px",Ce.style.borderRadius="9999px",Ce.style.background="linear-gradient(to right, #fef3c7, #fde68a)",Ce.style.border="1px solid #fde68a",Ce.style.boxShadow="inset 0 2px 4px rgba(0,0,0,0.1)",Ce.style.transition="all 0.25s ease",Ce.style.outline="none",Ce.style.cursor="pointer";const Ee=document.createElementNS("http://www.w3.org/2000/svg","svg");Ee.setAttribute("width","14"),Ee.setAttribute("height","14"),Ee.setAttribute("viewBox","0 0 24 24"),Ee.style.position="absolute",Ee.style.left="6px",Ee.style.top="50%",Ee.style.transform="translateY(-50%)";const _e=document.createElementNS("http://www.w3.org/2000/svg","polygon");_e.setAttribute("points","12,2 15.09,8.26 22,9 17,14.14 18.18,21.02 12,17.77 5.82,21.02 7,14.14 2,9 8.91,8.26"),_e.setAttribute("fill","#d97706"),_e.setAttribute("stroke","#d97706"),_e.setAttribute("stroke-width","2"),Ee.appendChild(_e);const Se=document.createElementNS("http://www.w3.org/2000/svg","svg");Se.setAttribute("width","14"),Se.setAttribute("height","14"),Se.setAttribute("viewBox","0 0 24 24"),Se.style.position="absolute",Se.style.right="6px",Se.style.top="50%",Se.style.transform="translateY(-50%)";const Le=document.createElementNS("http://www.w3.org/2000/svg","path");Le.setAttribute("d","M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"),Le.setAttribute("fill","#ef4444"),Le.setAttribute("stroke","#ef4444"),Le.setAttribute("stroke-width","2"),Se.appendChild(Le);const Ae=document.createElement("div");Ae.style.position="absolute",Ae.style.top="4px",Ae.style.width="20px",Ae.style.height="20px",Ae.style.left="4px",Ae.style.borderRadius="9999px",Ae.style.background="white",Ae.style.boxShadow="0 10px 15px -3px rgba(0,0,0,0.1), 0 4px 6px -2px rgba(0,0,0,0.05)",Ae.style.border="1px solid #e5e7eb",Ae.style.transition="all 0.25s ease",Ae.style.transform="translateX(0px)";const Ie=document.createElementNS("http://www.w3.org/2000/svg","svg");Ie.setAttribute("width","14"),Ie.setAttribute("height","14"),Ie.setAttribute("viewBox","0 0 24 24");const Me=document.createElementNS("http://www.w3.org/2000/svg","polygon");function r(){if("heart"===(le.favBadgeStyle||"heart")){Ce.style.background="linear-gradient(to right, #fecaca, #fca5a5)",Ce.style.borderColor="#fca5a5",_e.setAttribute("fill","#f59e0b"),_e.setAttribute("stroke","#f59e0b"),Le.setAttribute("fill","#dc2626"),Le.setAttribute("stroke","#dc2626"),Ae.style.transform="translateX(24px)",Ie.innerHTML="";const e=document.createElementNS("http://www.w3.org/2000/svg","path");e.setAttribute("d","M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"),e.setAttribute("fill","#ef4444"),e.setAttribute("stroke","#ef4444"),e.setAttribute("stroke-width","2"),Ie.appendChild(e)}else{Ce.style.background="linear-gradient(to right, #fef3c7, #fde68a)",Ce.style.borderColor="#fde68a",_e.setAttribute("fill","#d97706"),_e.setAttribute("stroke","#d97706"),Le.setAttribute("fill","#ef4444"),Le.setAttribute("stroke","#ef4444"),Ae.style.transform="translateX(0px)",Ie.innerHTML="";const e=document.createElementNS("http://www.w3.org/2000/svg","polygon");e.setAttribute("points","12,2 15.09,8.26 22,9 17,14.14 18.18,21.02 12,17.77 5.82,21.02 7,14.14 2,9 8.91,8.26"),e.setAttribute("fill","#f59e0b"),e.setAttribute("stroke","#f59e0b"),e.setAttribute("stroke-width","2"),Ie.appendChild(e)}}Me.setAttribute("points","12,2 15.09,8.26 22,9 17,14.14 18.18,21.02 12,17.77 5.82,21.02 7,14.14 2,9 8.91,8.26"),Me.setAttribute("fill","#f59e0b"),Me.setAttribute("stroke","#f59e0b"),Me.setAttribute("stroke-width","2"),Ie.appendChild(Me),Ae.style.display="flex",Ae.style.alignItems="center",Ae.style.justifyContent="center",Ae.appendChild(Ie),Ce.appendChild(Ee),Ce.appendChild(Se),Ce.appendChild(Ae),Ce.addEventListener("click",()=>{!function(e){le.favBadgeStyle=e,ie(le);try{const t=document.getElementById("skinBox");t&&(t.dataset.favStyle="star"===e?"star":"heart")}catch(e){}se(e);try{_t()}catch(e){}de=!0,r()}("heart"===(le.favBadgeStyle||"heart")?"star":"heart")}),r(),me.appendChild(ve),me.appendChild(ke),me.appendChild(Ce),me.appendChild(ge),me.appendChild(be),ue.appendChild(fe),ue.appendChild(me),oe.appendChild(ue);const Te=document.createElement("div");Te.className="opts-row";const Be=document.createElement("label");Be.className="lbl",Be.textContent='Hide "Add skin" arrow';const Ne=document.createElement("input");Ne.type="checkbox",Ne.checked=!le.showAddControl,Ne.addEventListener("change",pe);const Pe=document.createElement("div");Pe.className="controls";const Ge=document.createElement("label");Ge.className="toggle-switch";const De=document.createElement("span");De.className="track",Ge.appendChild(Ne),Ge.appendChild(De),Pe.appendChild(Ge),Te.appendChild(Be),Te.appendChild(Pe),oe.appendChild(Te);const Re=document.createElement("div");Re.className="opts-row";const ze=document.createElement("label");ze.className="lbl",ze.textContent="Hide skin names";const He=document.createElement("input");He.type="checkbox",He.checked=!le.showNameLabel,He.addEventListener("change",pe);const Fe=document.createElement("div");Fe.className="controls";const Oe=document.createElement("label");Oe.className="toggle-switch";const qe=document.createElement("span");qe.className="track",Oe.appendChild(He),Oe.appendChild(qe),Fe.appendChild(Oe),Re.appendChild(ze),Re.appendChild(Fe),oe.appendChild(Re);const je=document.createElement("div");je.className="actions";const Ue=document.createElement("button");Ue.type="button",Ue.textContent="Back up now",Ue.dataset.variant="info";const Ve=document.createElement("button");Ve.type="button",Ve.textContent="Clear GitHub token",Ve.title="Clear stored GitHub token (and repo settings)",Ve.dataset.variant="warning";const $e=document.createElement("button");$e.type="button",$e.textContent="Restore defaults",$e.dataset.variant="danger";const We=document.createElement("button");We.type="button",We.textContent="Save",We.dataset.variant="primary";const et=document.createElement("button");et.type="button",et.textContent="Close",et.dataset.variant="ghost",je.appendChild(Ue),je.appendChild(Ve),je.appendChild($e),je.appendChild(We),je.appendChild(et),y.appendChild(je),f.appendChild(y),document.body.appendChild(f),ot(f,()=>{try{de||(ae(ce),U(g),W(F),kt(P))}catch(e){}rt(f),f.remove()}),et.onclick=()=>{try{de||(ae(ce),U(g),W(F),kt(P),window.__MirrorSync&&"function"==typeof window.__MirrorSync.setEnabled&&window.__MirrorSync.setEnabled(!(!v||!v.mirrorTabs)))}catch(e){}rt(f),f.remove()},We.onclick=()=>{const e=parseInt(x.value,10)||0,t={enabled:e>0,intervalDays:e>0?e:0,mirrorTabs:k&&!!k.checked};Qn(t),no(!0);try{window.__MirrorSync&&"function"==typeof window.__MirrorSync.setEnabled&&window.__MirrorSync.setEnabled(!!t.mirrorTabs)}catch(e){}j(parseInt(J.value,10)),$(parseInt(z.value,10)),wt(N.value);const n={showFavoriteBadge:!ye.checked,showAddControl:!Ne.checked,showNameLabel:!He.checked,favBadgeStyle:le.favBadgeStyle||"heart",hideFavoriteRing:!(!he||!he.checked)};ie(n),ae(n),$t("Options saved"),de=!0,rt(f),f.remove()},Ue.onclick=async()=>{if(confirm("Run GitHub sync now with current gallery data?"))try{await eo()}catch(e){console.error(e)}},Ve.onclick=()=>{if(confirm("Clear stored GitHub credentials (token/repo/branch/path)?\nYou can re-enter them next time you run a backup."))try{Nn(),$t("GitHub settings cleared")}catch(e){console.error(e)}},$e.onclick=()=>{try{x.value="0",Qn({enabled:!1,intervalDays:0,mirrorTabs:!1}),no(!0);try{k&&(k.checked=!1),window.__MirrorSync&&"function"==typeof window.__MirrorSync.setEnabled&&window.__MirrorSync.setEnabled(!1)}catch(e){}j(130),U(130),J.value="130",X.textContent="130px",$(4),W(4),z.value="4",H.textContent="4px",wt("compact"),kt("compact"),N.value="compact",ie({showFavoriteBadge:!0,showAddControl:!0,showNameLabel:!0,hideFavoriteRing:!1}),ae({showFavoriteBadge:!0,showAddControl:!0,showNameLabel:!0,hideFavoriteRing:!1}),ye.checked=!1,Ne.checked=!1,He.checked=!1,void 0!==he&&(he.checked=!1),$t("Options reset to defaults"),de=!0}catch(e){console.error(e)}};break}}});const L=new MutationObserver(()=>{if("block"===Ye.style.display){C(),function(){try{if(!We)return;const e=We.getBoundingClientRect(),t=Ye.getBoundingClientRect(),n=e.bottom+6,o=e.right-t.width;Ye.style.top=`${Math.round(n)}px`,Ye.style.left=`${Math.round(o)}px`,Ye.style.right="auto"}catch(e){}}(),requestAnimationFrame(S),tt();try{const e=Ye.querySelector(".submenu button");e&&"function"==typeof e.focus&&e.focus()}catch(e){}try{We.setAttribute("aria-expanded","true")}catch(e){}}else{nt();try{Ye.querySelectorAll(".menu-section.submenu-open").forEach(e=>e.classList.remove("submenu-open"))}catch(e){}try{We.setAttribute("aria-expanded","false")}catch(e){}}});L.observe(Ye,{attributes:!0,attributeFilter:["style"]}),b(()=>{try{L.disconnect()}catch(e){}})}(),document.addEventListener("DOMContentLoaded",function(){var e=document.querySelector(".main-bottom-links");e&&e.parentNode&&e.remove();var t=document.querySelector(".policyLinks");t&&t.parentNode&&t.remove()}),function(){if("skins.gota.io"!==location.hostname)return;const e=function(e){let t=!1;return function(){t||(t=!0,requestAnimationFrame(()=>{t=!1,e()}))}}(()=>{try{ao()}catch(e){}try{lo()}catch(e){}}),t=(()=>{let e=!1;return async function(){e||(e=!0,requestAnimationFrame(async()=>{e=!1;try{!function(){if("skins.gota.io"!==location.hostname)return;Array.from(document.querySelectorAll("img")).forEach(e=>{(e.classList.contains("rounded-full")||e.classList.contains("rainbow")||e.width>=64&&e.height>=64&&/skin-data\.gota\.io\/.+\.png/.test(e.src))&&(e.style.borderRadius="50%",e.style.border="4px solid #FFD600",e.style.boxSizing="border-box")})}()}catch(e){}try{await async function(){if("skins.gota.io"!==location.hostname)return;let e=new Set,t=[];if("function"==typeof GM_getValue){const e=await GM_getValue("gotaio_profiles_v2");if(e)try{t=JSON.parse(e)}catch(e){t=[]}}else try{const e=localStorage.getItem("gotaio_profiles_v2");e&&(t=JSON.parse(e))}catch(e){t=[]}t.forEach(t=>(t.skins||[]).forEach(t=>e.add(t.uuid))),Array.from(document.querySelectorAll("img")).forEach(t=>{t.style.border="",t.style.boxShadow="",t.style.borderRadius="";const n=t.src&&t.src.match(/([a-f0-9\-]{36})\.png$/i);if(n){const o=n[1];e.has(o)&&(t.style.borderRadius="50%",t.style.border="4px solid #FFFFFF",t.style.boxShadow="0 0 0 0px #fff, 0 0 0 2px #FF0000, 0 2px 14px #FF0000",t.style.boxSizing="border-box")}})}()}catch(e){}}))}})();function n(){e(),t()}n(),window.addEventListener("DOMContentLoaded",n,{once:!0}),setTimeout(n,1e3);const o=new MutationObserver(n);try{o.observe(document.body,{childList:!0,subtree:!0})}catch(e){}b(()=>{try{o.disconnect()}catch(e){}})}(),document.addEventListener("DOMContentLoaded",uo);const mo='\n    /* Base container */\n    #skinBox {\n      background: var(--bg, rgba(120,120,120,0.35));\n      border: 2px solid var(--border, #777);\n      font-weight: 600;\n      letter-spacing: 0.02em;\n      text-shadow: var(--text-shadow, none);\n    }\n\n    /* Ring color for non-favorite skins is inherited from tokens; no override here */\n\n    /* Labels under skins */\n    #skinBox .skin-name {\n      color: var(--label-fg, #eee);\n      background: var(--label-bg, rgba(0,0,0,0.4));\n      border: var(--label-border, none);\n      box-shadow: var(--label-shadow, none);\n    }\n\n    /* Simple handle, no heavy glow */\n    #skinBox .resize-handle {\n      background: var(--handle-bg, rgba(255,255,255,0.2));\n      box-shadow: none;\n    }\n\n    /* Search input */\n    #skinBox .gotaio-search-input {\n      background: var(--field-bg, rgba(35,35,35,0.6)) !important;\n      background-color: var(--field-bg, rgba(35,35,35,0.6)) !important;\n      color: var(--field-fg, #eee) !important;\n      border: 1px solid var(--field-border, #777) !important;\n      box-shadow: none !important;\n    }\n\n    /* Menu header/text accents (scoped, subtle) */\n    .menu-container .menu-header .profile-name { color: var(--acc, #4caf50); }\n\n    /* Removed old heavy overrides for section headers/submenus to keep the compact spec exact */\n\n    /* Themed minimal scrollbars for main panel and menus */\n    #skinBox, .menu-container {\n      scrollbar-width: thin;\n      scrollbar-color: var(--scroll-thumb, #4caf50) var(--scroll-track, #23272e);\n    }\n    #skinBox::-webkit-scrollbar-thumb, .menu-container::-webkit-scrollbar-thumb {\n      background: var(--scroll-thumb, #4caf50);\n    }\n    #skinBox::-webkit-scrollbar-track, .menu-container::-webkit-scrollbar-track {\n      background: var(--scroll-track, #23272e);\n    }\n    /* Theme menu options (use per-item CSS variables set in JS) */\n    .theme-option { padding: 7px 12px; cursor: pointer; transition: background 0.13s, color 0.13s; min-width: 132px; user-select: none; }\n    .theme-option:hover:not([data-active="1"]) { background: var(--acc-bg); color: var(--acc-fg); }\n    .theme-option[data-active="1"] { background: var(--acc-bg-active); color: var(--acc-fg); }\n  ',go={noir:{bg:"radial-gradient(circle at 30% 35%, #1e1e1e 0%, #0f0f0f 65%, #060606 100%),\n            url(\"data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='140' height='140' viewBox='0 0 140 140'><g stroke='%23ffffff11' stroke-width='1'><path d='M0 20H140M0 60H140M0 100H140'/><path d='M20 0V140M60 0V140M100 0V140'/></g><g stroke='%23ffffff08' stroke-width='1'><path d='M0 0L140 140M140 0L0 140'/></g><circle cx='70' cy='70' r='22' fill='none' stroke='%23ffffff10' stroke-width='2'/></svg>\")",border:"#d3d3d3",acc:"#ffffff","ring-color":"#e0e0e0","label-fg":"#f5f5f5","label-bg":"rgba(255,255,255,0.04)","field-bg":"#161616","field-fg":"#f5f5f5","field-border":"#3a3a3a","section-bg":"#141414","section-fg":"#fafafa","section-border":"#ffffff","submenu-bg":"#121212","submenu-border":"#2a2a2a","scroll-thumb":"#555","scroll-track":"#1a1a1a","chip-bg":"rgba(255,255,255,0.08)","chip-fg":"#f5f5f5","handle-bg":"linear-gradient(135deg, #2a2a2a 0%, #0f0f0f 100%)","menu-bg":"rgba(18,18,18,0.96)","menu-fg":"#ffffff","profile-bg":"rgba(0,0,0,0.5)","hover-bg":"rgba(255,255,255,0.10)","text-shadow":"0 1px 2px rgba(0,0,0,0.8)"},cyberpunk:{bg:"radial-gradient(circle at 78% 14%, rgba(255,43,216,0.22) 0%, rgba(255,43,216,0) 42%),\n            radial-gradient(circle at 18% 8%, rgba(0,240,255,0.18) 0%, rgba(0,240,255,0) 45%),\n            linear-gradient(160deg, #170037 0%, #041b3d 40%, #010915 65%, #03050c 100%),\n            url(\"data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='240' height='240' viewBox='0 0 240 240'><defs><linearGradient id='cpGrid' x1='0%25' y1='0%25' x2='100%25' y2='100%25'><stop offset='0%25' stop-color='%2300f0ff' stop-opacity='0.55'/><stop offset='45%25' stop-color='%23ff2bd8' stop-opacity='0.36'/><stop offset='100%25' stop-color='%238a00ff' stop-opacity='0.32'/></linearGradient><linearGradient id='cpBld' x1='0%25' y1='0%25' x2='0%25' y2='100%25'><stop offset='0%25' stop-color='%2300f0ff' stop-opacity='0.72'/><stop offset='60%25' stop-color='%2310152d' stop-opacity='0.2'/></linearGradient><linearGradient id='cpNeon' x1='0%25' y1='0%25' x2='100%25' y2='0%25'><stop offset='0%25' stop-color='%23ff2bd8'/><stop offset='100%25' stop-color='%2300f0ff'/></linearGradient></defs><g stroke='url(%23cpGrid)' stroke-width='1.15' opacity='0.45'><path d='M0 40H240M0 70H240M0 100H240M0 130H240M0 160H240M0 190H240'/><path d='M40 0V240M70 0V240M100 0V240M130 0V240M160 0V240M190 0V240M220 0V240'/></g><g opacity='0.32' stroke='%2300f0ff' stroke-width='1.5' fill='none'><path d='M0 160 Q120 120 240 160'/><path d='M0 182 Q120 140 240 182'/></g><g opacity='0.55' fill='url(%23cpBld)'><path d='M28 240V172h24v68z'/><path d='M66 240V150h18v90z'/><path d='M92 240V134h28v106z'/><path d='M132 240V160h20v80z'/><path d='M162 240V140h24v100z'/><path d='M198 240V176h18v64z'/></g><g opacity='0.22' stroke='%23ff2bd8' stroke-width='1.4'><polyline points='30,150 40,140 50,150 60,138 70,150'/><polyline points='170,128 180,118 190,126 200,120 210,128'/></g><g opacity='0.28'><rect x='96' y='112' width='40' height='10' fill='url(%23cpNeon)'/><rect x='150' y='90' width='26' height='7' fill='%2300f0ff'/><rect x='56' y='100' width='18' height='6' fill='%23ff2bd8'/></g><g opacity='0.2' stroke='%23ffffff55' stroke-width='0.8'><rect x='112' y='70' width='32' height='18'/><rect x='40' y='58' width='28' height='14'/></g><g opacity='0.22' fill='%23ffffff22'><circle cx='28' cy='42' r='1.8'/><circle cx='210' cy='52' r='1.6'/><circle cx='140' cy='36' r='1.4'/><circle cx='82' cy='26' r='1.2'/></g></svg>\")",border:"#00f0ff",acc:"#ff2bd8","ring-color":"#00d5ff","label-fg":"#66f7ff","label-bg":"rgba(6,12,26,0.78)","field-bg":"rgba(8,14,28,0.92)","field-fg":"#66f7ff","field-border":"#00f0ff","section-bg":"rgba(6,10,22,0.9)","section-fg":"#d6f6ff","section-border":"#ff2bd8","submenu-bg":"rgba(4,8,18,0.94)","submenu-border":"rgba(255,43,216,0.55)","scroll-thumb":"#00f0ff","scroll-track":"#060a12","chip-bg":"rgba(255,43,216,0.16)","chip-fg":"#d6f6ff","handle-bg":"linear-gradient(135deg, #00f0ff 0%, #ff2bd8 60%, #8a00ff 100%)","menu-bg":"rgba(4,8,18,0.94)","menu-fg":"#d6f6ff","profile-bg":"rgba(0,12,24,0.55)","hover-bg":"rgba(255,43,216,0.18)","text-shadow":"0 0 8px rgba(0,255,255,0.6), 0 0 4px rgba(255,43,216,0.4)"},sakura:{bg:"linear-gradient(135deg, rgba(255,246,251,0.85) 0%, rgba(255,224,239,0.88) 40%, rgba(255,182,213,0.92) 100%),\n            url(\"data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='120' height='120' viewBox='0 0 120 120'><defs><g id='branch'><path d='M0,0 Q2,3 4,8 Q5,10 6,15' stroke='%23b8917a' stroke-width='1.5' fill='none' opacity='0.3'/><path d='M4,8 Q6,9 9,10' stroke='%23b8917a' stroke-width='1' fill='none' opacity='0.25'/></g><g id='petal'><path d='M0,-6 Q3,-4 4,0 Q3,1 0,2 Q-3,1 -4,0 Q-3,-4 0,-6z' fill='%23ff9ec8'/><path d='M0,-6 Q3,-4 4,0 Q3,1 0,2 Q-3,1 -4,0 Q-3,-4 0,-6z' fill='url(%23petalGrad)'/><path d='M0,-5 Q2,-3.5 3,-1 Q2,0 0,1 Q-2,0 -3,-1 Q-2,-3.5 0,-5z' fill='%23ffc4dd' opacity='0.6'/></g><linearGradient id='petalGrad' x1='0%25' y1='0%25' x2='0%25' y2='100%25'><stop offset='0%25' stop-color='%23ffffff' stop-opacity='0.4'/><stop offset='100%25' stop-color='%23ff6bb0' stop-opacity='0.1'/></linearGradient></defs><g opacity='0.65'><use href='%23branch' x='15' y='10'/><use href='%23branch' x='70' y='15' transform='rotate(25 70 15)'/><use href='%23branch' x='45' y='50' transform='rotate(-15 45 50)'/><use href='%23branch' x='80' y='65' transform='rotate(35 80 65)'/><g transform='translate(22,18)'><use href='%23petal' transform='rotate(0)'/><use href='%23petal' transform='rotate(72)'/><use href='%23petal' transform='rotate(144)'/><use href='%23petal' transform='rotate(216)'/><use href='%23petal' transform='rotate(288)'/><circle r='2.5' fill='%23ffeb99' opacity='0.9'/><circle r='1.5' fill='%23ff6bb0' opacity='0.3'/><circle cx='0.3' cy='-0.3' r='0.8' fill='%23fff' opacity='0.6'/></g><g transform='translate(78,24) scale(0.85)'><use href='%23petal' transform='rotate(15)'/><use href='%23petal' transform='rotate(87)'/><use href='%23petal' transform='rotate(159)'/><use href='%23petal' transform='rotate(231)'/><use href='%23petal' transform='rotate(303)'/><circle r='2.5' fill='%23ffeb99' opacity='0.9'/><circle r='1.5' fill='%23ff6bb0' opacity='0.3'/></g><g transform='translate(52,58) scale(1.1)'><use href='%23petal' transform='rotate(-8)'/><use href='%23petal' transform='rotate(64)'/><use href='%23petal' transform='rotate(136)'/><use href='%23petal' transform='rotate(208)'/><use href='%23petal' transform='rotate(280)'/><circle r='2.5' fill='%23ffeb99' opacity='0.9'/><circle r='1.5' fill='%23ff6bb0' opacity='0.3'/><circle cx='0.4' cy='-0.4' r='0.9' fill='%23fff' opacity='0.5'/></g><g transform='translate(88,74) scale(0.9)'><use href='%23petal' transform='rotate(20)'/><use href='%23petal' transform='rotate(92)'/><use href='%23petal' transform='rotate(164)'/><use href='%23petal' transform='rotate(236)'/><use href='%23petal' transform='rotate(308)'/><circle r='2.5' fill='%23ffeb99' opacity='0.9'/><circle r='1.5' fill='%23ff6bb0' opacity='0.3'/></g><g transform='translate(18,85) scale(0.75)'><use href='%23petal' transform='rotate(-12)'/><use href='%23petal' transform='rotate(60)'/><use href='%23petal' transform='rotate(132)'/><use href='%23petal' transform='rotate(204)'/><use href='%23petal' transform='rotate(276)'/><circle r='2.5' fill='%23ffeb99' opacity='0.9'/><circle r='1.5' fill='%23ff6bb0' opacity='0.3'/></g><path d='M35,45 Q36,48 35,52' fill='none' stroke='%23ffb6d5' stroke-width='2.5' opacity='0.4' stroke-linecap='round'/><ellipse cx='35' cy='52' rx='2.5' ry='6' fill='%23ffc4dd' opacity='0.5' transform='rotate(25 35 52)'/><ellipse cx='35.5' cy='50' rx='1.5' ry='3.5' fill='%23fff' opacity='0.3' transform='rotate(25 35.5 50)'/><path d='M65,35 Q64,39 66,43' fill='none' stroke='%23ffb6d5' stroke-width='2' opacity='0.4' stroke-linecap='round'/><ellipse cx='66' cy='43' rx='2' ry='5.5' fill='%23ff9ec8' opacity='0.5' transform='rotate(-15 66 43)'/><ellipse cx='66.3' cy='41' rx='1.2' ry='3' fill='%23fff' opacity='0.3' transform='rotate(-15 66.3 41)'/><path d='M95,50 Q93,53 94,57' fill='none' stroke='%23ffb6d5' stroke-width='2.2' opacity='0.4' stroke-linecap='round'/><ellipse cx='94' cy='57' rx='2.3' ry='5.8' fill='%23ffc4dd' opacity='0.5' transform='rotate(40 94 57)'/></g></svg>\")",border:"#ff9ec8",acc:"#ff6bb0","ring-color":"#ff7bc4","label-fg":"#7a2d4f","label-bg":"rgba(255,246,251,0.98)","field-bg":"rgba(255,242,248,0.96)","field-fg":"#7a2d4f","field-border":"#f7b6d2","section-bg":"rgba(255,233,244,0.96)","section-fg":"#7a2d4f","section-border":"#f7b6d2","submenu-bg":"linear-gradient(135deg, rgba(255,234,244,0.95) 0%, rgba(249,210,230,0.95) 100%)","submenu-border":"#ff9ec8","scroll-thumb":"#f7b6d2","scroll-track":"rgba(255,246,251,0.6)","chip-bg":"rgba(255,183,213,0.18)","chip-fg":"#7a2d4f","handle-bg":"linear-gradient(135deg, #ff9ec8 0%, #ffc4dd 100%)","menu-bg":"linear-gradient(135deg, rgba(255,228,239,0.97) 0%, rgba(246,202,223,0.97) 100%)","menu-fg":"#7a2d4f","profile-bg":"rgba(255,183,213,0.18)","hover-bg":"rgba(255,126,182,0.22)","text-shadow":"0 1px 1px rgba(255,255,255,0.8)"},inferno:{bg:"linear-gradient(180deg, #1a0802 0%, #2a0a04 100%)",border:"#ff6a00",acc:"#ff7a1a","ring-color":"#ff6a00","label-fg":"#ffd7b3","label-bg":"rgba(42,10,4,0.92)","field-bg":"rgba(42,10,4,0.96)","field-fg":"#ffd7b3","field-border":"#ff6a00","section-bg":"rgba(42,10,4,0.94)","section-fg":"#ffd7b3","section-border":"#ff6a00","submenu-bg":"rgba(42,10,4,0.96)","submenu-border":"#ff6a00","scroll-thumb":"#ff6a00","scroll-track":"#2a0a04","chip-bg":"rgba(255,255,255,0.08)","chip-fg":"#ffd7b3","handle-bg":"linear-gradient(135deg, #ff6a00 0%, #ffb84d 100%)","menu-bg":"rgba(32,8,3,0.98)","menu-fg":"#ffd7b3","profile-bg":"rgba(0,0,0,0.5)","hover-bg":"rgba(255,122,26,0.14)","text-shadow":"none"},retro:{bg:"radial-gradient(ellipse at 50% 120%, rgba(255,0,128,0.15) 0%, rgba(138,0,184,0.1) 40%, transparent 70%),\n            linear-gradient(180deg, #0a0015 0%, #1a0833 35%, #2d1048 65%, #1a0833 100%),\n            url(\"data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='200' height='200' viewBox='0 0 200 200'><defs><linearGradient id='gridGlow' x1='0%25' y1='0%25' x2='0%25' y2='100%25'><stop offset='0%25' stop-color='%23ff0080' stop-opacity='0.6'/><stop offset='50%25' stop-color='%23bc13fe' stop-opacity='0.5'/><stop offset='100%25' stop-color='%236b00b8' stop-opacity='0.4'/></linearGradient><filter id='glow'><feGaussianBlur stdDeviation='1.5' result='coloredBlur'/><feMerge><feMergeNode in='coloredBlur'/><feMergeNode in='SourceGraphic'/></feMerge></filter></defs><g opacity='0.4' stroke='url(%23gridGlow)' fill='none' stroke-width='1.5'><line x1='0' y1='40' x2='200' y2='40'/><line x1='0' y1='60' x2='200' y2='60'/><line x1='0' y1='80' x2='200' y2='80'/><line x1='0' y1='100' x2='200' y2='100'/><line x1='0' y1='120' x2='200' y2='120'/><line x1='0' y1='140' x2='200' y2='140'/><line x1='0' y1='160' x2='200' y2='160'/><line x1='0' y1='180' x2='200' y2='180'/><line x1='40' y1='0' x2='40' y2='200'/><line x1='60' y1='0' x2='60' y2='200'/><line x1='80' y1='0' x2='80' y2='200'/><line x1='100' y1='0' x2='100' y2='200'/><line x1='120' y1='0' x2='120' y2='200'/><line x1='140' y1='0' x2='140' y2='200'/><line x1='160' y1='0' x2='160' y2='200'/><line x1='180' y1='0' x2='180' y2='200'/></g><g opacity='0.25'><circle cx='100' cy='30' r='35' stroke='%23ff0080' stroke-width='2' fill='none' opacity='0.6'/><circle cx='100' cy='30' r='30' stroke='%23bc13fe' stroke-width='1.5' fill='none' opacity='0.5'/><circle cx='100' cy='30' r='25' stroke='%236b00b8' stroke-width='1' fill='none' opacity='0.5'/><path d='M100,30 L100,60' stroke='%23ff00ff' stroke-width='1.5' opacity='0.4'/><path d='M85,30 L115,30' stroke='%23ff00ff' stroke-width='1.5' opacity='0.4'/></g><g opacity='0.2'><polygon points='50,160 60,180 40,180' fill='%23ff0080'/><polygon points='150,170 160,190 140,190' fill='%23bc13fe'/><rect x='25' y='90' width='8' height='8' fill='%236b00b8'/><rect x='165' y='110' width='8' height='8' fill='%23ff0080'/></g></svg>\")",border:"#ff0080",acc:"#bc13fe","ring-color":"#ff0080","label-fg":"#ffaaff","label-bg":"rgba(26,8,51,0.92)","field-bg":"rgba(26,8,51,0.94)","field-fg":"#ff66ff","field-border":"#bc13fe","section-bg":"rgba(45,16,72,0.85)","section-fg":"#ffaaff","section-border":"#ff0080","submenu-bg":"rgba(26,8,51,0.96)","submenu-border":"#bc13fe","scroll-thumb":"#ff0080","scroll-track":"rgba(10,0,21,0.6)","chip-bg":"rgba(188,19,254,0.15)","chip-fg":"#ff66ff","handle-bg":"linear-gradient(135deg, #ff0080 0%, #bc13fe 50%, #6b00b8 100%)","menu-bg":"rgba(26,8,51,0.96)","menu-fg":"#ffaaff","profile-bg":"rgba(188,19,254,0.12)","hover-bg":"rgba(255,0,128,0.20)","text-shadow":"0 0 8px rgba(255,170,255,0.6), 0 0 3px rgba(255,0,128,0.5)"},stealth:{"text-shadow":"0 0 8px rgba(0,255,255,0.6), 0 0 3px rgba(255,0,128,0.4)"},stealth:{bg:"#111418",border:"#3a4a5a",acc:"#7fa0bb","ring-color":"#6b8aa3","label-fg":"#cdd3da","label-bg":"rgba(15,18,22,0.85)","field-bg":"#15191e","field-fg":"#cdd3da","field-border":"#3a4a5a","section-bg":"#12161a","section-fg":"#cdd3da","section-border":"#4d5a66","submenu-bg":"#0f1317","submenu-border":"#3a4a5a","scroll-thumb":"#7fa0bb","scroll-track":"#0f1317","chip-bg":"rgba(127,160,187,0.10)","chip-fg":"#b8c9d9","handle-bg":"linear-gradient(135deg, rgba(107,138,163,0.3) 0%, rgba(90,110,130,0.2) 100%)","menu-bg":"#12161a","menu-fg":"#cdd3da","profile-bg":"rgba(107,138,163,0.08)","hover-bg":"rgba(127,160,187,0.14)","text-shadow":"none"},light:{bg:"linear-gradient(135deg, #ffffff 0%, #fafafa 40%, #f5f5f5 100%),\n            url(\"data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='100' height='100' viewBox='0 0 100 100'><g opacity='0.06'><circle cx='20' cy='20' r='1.5' fill='%23d0d0d0'/><circle cx='80' cy='30' r='1' fill='%23d0d0d0'/><circle cx='50' cy='50' r='1.2' fill='%23d0d0d0'/><circle cx='30' cy='70' r='0.8' fill='%23d0d0d0'/><circle cx='75' cy='85' r='1.3' fill='%23d0d0d0'/></g><g opacity='0.04'><path d='M0,25 Q25,22 50,25 T100,25' stroke='%23e6e6e6' stroke-width='0.5' fill='none'/><path d='M0,75 Q25,72 50,75 T100,75' stroke='%23e6e6e6' stroke-width='0.5' fill='none'/></g></svg>\")",border:"#dedede",acc:"#7a7a7a","ring-color":"#bfbfbf","label-fg":"#4a4a4a","label-bg":"rgba(255,255,255,0.96)","field-bg":"#ffffff","field-fg":"#3a3a3a","field-border":"#dedede","section-bg":"rgba(248,248,248,0.95)","section-fg":"#3f3f3f","section-border":"#e6e6e6","submenu-bg":"rgba(252,252,252,0.98)","submenu-border":"#e2e2e2","scroll-thumb":"#cfcfcf","scroll-track":"#f3f3f3","chip-bg":"rgba(0,0,0,0.05)","chip-fg":"#4a4a4a","handle-bg":"linear-gradient(135deg, #f7f7f7 0%, #ffffff 50%, #f2f2f2 100%)","menu-bg":"rgba(252,252,252,0.98)","menu-fg":"#373737","profile-bg":"rgba(0,0,0,0.04)","hover-bg":"rgba(0,0,0,0.08)","text-shadow":"none"},midnight:{bg:"radial-gradient(circle at 35% 30%, #0b1230 0%, #050a1d 70%, #030612 100%)",border:"#2a3555",acc:"#7cb7ff","ring-color":"#4d74b8","label-fg":"#dcecff","label-bg":"rgba(30,44,78,0.55)","field-bg":"#0f1b33","field-fg":"#d7e6ff","field-border":"#2f4774","section-bg":"#0d172b","section-fg":"#dce6f5","section-border":"#3d527c","submenu-bg":"#0b1426","submenu-border":"#2a3f64","menu-fg":"#dce6f5","scroll-thumb":"#4d74b8","scroll-track":"#0b1426","handle-bg":"linear-gradient(135deg,#25406b,#132342)","menu-bg":"rgba(12,22,40,0.95)","profile-bg":"rgba(10,20,35,0.5)","chip-bg":"rgba(124,183,255,0.12)","chip-fg":"#cfe4ff","hover-bg":"rgba(124,183,255,0.16)","text-shadow":"0 1px 2px rgba(0,0,0,0.6)"},crt:{bg:"#050a02 repeating-linear-gradient(to bottom, rgba(0,255,120,0.05) 0 2px, transparent 2px 4px)",border:"#1d3f1d",acc:"#33ff99","ring-color":"#33ff33","label-fg":"#b6ffb6","label-bg":"rgba(51,255,153,0.12)","field-bg":"#0b1a0b","field-fg":"#c8ffd0","field-border":"#236b35","section-bg":"#091608","section-fg":"#d6ffd9","section-border":"#2f8b44","submenu-bg":"#081306","submenu-border":"#236b35","scroll-thumb":"#33ff99","scroll-track":"rgba(5,12,7,0.8)","handle-bg":"linear-gradient(135deg,#0f3d1f,#081e10)","menu-bg":"rgba(8,19,6,0.94)","menu-fg":"#d6ffd9","profile-bg":"rgba(10,20,15,0.5)","chip-bg":"rgba(51,255,153,0.12)","chip-fg":"#b6ffb6","hover-bg":"rgba(51,255,153,0.18)","text-shadow":"0 0 4px rgba(51,255,153,0.5), 0 0 2px rgba(51,255,153,0.4)"}};function ho(e){let t=document.getElementById("theme-style");t||(t=document.createElement("style"),t.id="theme-style",document.head.appendChild(t)),t.dataset.init||(t.textContent=mo+function(e){let t="";for(const[n,o]of Object.entries(e)){t+=`:root[data-theme="${n}"] {`;for(const[e,n]of Object.entries(o))t+=`\n  --${e}: ${n};`;t+="\n}\n"}return t}(go),t.dataset.init="1");try{document.documentElement.setAttribute("data-theme",e)}catch(e){}}let bo=!1;function xo(){bo||(bo=!0,requestAnimationFrame(()=>{bo=!1,function(){try{const e=document.getElementById("skinBox");if(!e)return;const t=e.querySelectorAll(".circle-slot");for(let e=0;e<t.length;e++){const n=t[e];n.classList.contains("favorite")||n.style.removeProperty("--ring-color")}}catch(e){}}()}))}const vo=document.createElement("style");function wo(e){try{if(!e||!go[e])return;const t=(fe||[])[ye];if(!t)return;t.theme=e,xe(),be()}catch(e){}}function ko(){try{const e=function(){try{const e=(fe||[])[ye]||null,t=e&&"string"==typeof e.theme?e.theme:"";return t&&go[t]?t:""}catch(e){return""}}()||Object.keys(go)[0];Co=e,ho(e),xo(),Io()}catch(e){}}vo.id="retro-font-style",vo.textContent="\n    #skinBox,\n    .profile-dropdown,\n    .gotaio-profile-menu,\n    .gotaio-profile-menu-option,\n    .skin-name,\n    .gotaio-hotkeys-modal,\n    .gotaio-profile-menu-group,\n    .gotaio-profile-menu-bottom {\n      font-family: 'VT323', 'Press Start 2P', monospace !important;\n      letter-spacing: 0.5px;\n    }\n  ",document.head.appendChild(vo);let Co="";ko(),xo();const Eo=document.createElement("button");Eo.innerHTML='<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true"><path d="M13.5 21a2.5 2.5 0 0 1 0-5H17a3 3 0 0 0 0-6h-1.5a7.5 7.5 0 1 0-7.4 9"/><circle cx="6.5" cy="12.5" r="1.2"/><circle cx="9.5" cy="8.5" r="1.2"/><circle cx="14.5" cy="7.5" r="1.2"/><circle cx="17.5" cy="11" r="1.2"/></svg>',Eo.title="Switch Theme",Eo.style.marginLeft="6px",Eo.style.width="30px",Eo.style.height="28px",Eo.style.display="inline-flex",Eo.style.alignItems="center",Eo.style.justifyContent="center",Eo.style.border="1px solid rgba(255,255,255,0.12)",Eo.style.borderRadius="8px",Eo.style.background="transparent",Eo.style.color="var(--acc, #4caf50)";const _o=document.createElement("div");_o.style.position="absolute",_o.style.top="32px",_o.style.right="0",_o.style.background="rgba(40,40,40,0.6)",_o.style.backdropFilter="blur(10px)",_o.style.webkitBackdropFilter="blur(10px)",_o.style.color="white",_o.style.border="1px solid rgba(255,255,255,0.12)",_o.style.borderRadius="10px",_o.style.boxShadow="0 12px 26px rgba(0,0,0,0.32)",_o.style.padding="6px 0",_o.style.display="none",_o.style.fontSize="12px",_o.style.zIndex="10001";const So=Object.keys(go),Lo=Object.fromEntries(Object.entries(go).map(([e,t])=>[e,t.acc||"#4caf50"]));function Ao(e,t){const n=/^#?([\da-f]{2})([\da-f]{2})([\da-f]{2})$/i.exec(e);if(!n)return`rgba(0,0,0,${t||1})`;return`rgba(${parseInt(n[1],16)},${parseInt(n[2],16)},${parseInt(n[3],16)},${null==t?1:t})`}function Io(){Array.from(_o.children).forEach((e,t)=>{So[t]===Co?e.setAttribute("data-active","1"):e.removeAttribute("data-active")})}So.forEach(e=>{const t=document.createElement("div");t.className="theme-option",t.textContent=e.charAt(0).toUpperCase()+e.slice(1);const n=Lo[e]||"#4caf50";t.style.setProperty("--acc-fg",n),t.style.setProperty("--acc-bg",Ao(n,.12)),t.style.setProperty("--acc-bg-active",Ao(n,.18)),t.addEventListener("click",()=>{Co=e,wo(e),ho(e),xo(),Io(),_o.style.display="none",To()}),_o.appendChild(t)}),Me&&We?(Me.appendChild(_o),We.parentNode.insertBefore(Eo,We.nextSibling)):console.error("profileSelector or editProfileButton not found!");let Mo=null;function To(){Mo&&(window.removeEventListener("keydown",Mo,!0),Mo=null)}window.addEventListener("mousedown",e=>{_o.contains(e.target)||e.target===Eo||(_o.style.display="none",To())}),Eo.addEventListener("click",e=>{const t="block"!==_o.style.display;_o.style.display=t?"block":"none",t?(Io(),Mo||(Mo=function(e){const t=e.key||e.code;"Escape"!==t&&"Esc"!==t||(e.stopPropagation(),"function"==typeof e.stopImmediatePropagation&&e.stopImmediatePropagation(),e.preventDefault(),_o.style.display="none",To())},window.addEventListener("keydown",Mo,!0))):To(),e.stopPropagation()});let Bo=0;Eo.addEventListener("wheel",e=>{e.preventDefault(),e.stopPropagation();if(Date.now()-Bo<180)return;if(!So||!So.length)return;let t=So.indexOf(Co);if(-1===t&&(t=0),e.deltaY>0)t=(t+1)%So.length;else{if(!(e.deltaY<0))return;t=(t-1+So.length)%So.length}const n=So[t];n!==Co&&(Co=n,wo(Co),ho(Co),xo(),"block"===_o.style.display&&Io(),Bo=Date.now())},{passive:!1}),function(){const e=document.getElementById("skinBox")||window.box;if(!e)return;e.style.willChange="transform",e.style.backfaceVisibility="hidden",e.style.transform="translateZ(0)";let t=!1,n=[];function o(){e&&null!==e.offsetParent&&"none"!==e.style.display?t||(t=!0,"function"==typeof window._enableGalleryUI&&window._enableGalleryUI()):t&&(t=!1,n.forEach(e=>{try{e()}catch(e){}}),n=[],"function"==typeof window._disableGalleryUI&&window._disableGalleryUI())}const r=new MutationObserver(o);e&&(r.observe(e,{attributes:!0,attributeFilter:["style","class"]}),b(()=>{try{r.disconnect()}catch(e){}}));const i=setInterval(o,1200);b(()=>{try{clearInterval(i)}catch(e){}}),o(),window._enableGalleryUI=function(){},window._disableGalleryUI=function(){}}(),function(){let e=0;const t=setInterval(()=>{const t=document.getElementById("main");if(t&&"none"!==t.style.display&&e<25){try{I()}catch(e){}try{uo&&uo()}catch(e){}e++}try{wn()}catch(e){}},1800);b(()=>{try{clearInterval(t)}catch(e){}})}()}();
